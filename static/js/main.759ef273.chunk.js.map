{"version":3,"sources":["cards.tsx","assets.ts","goals.tsx","utils.ts","Game.tsx","icons.tsx","actions.tsx","combiner.ts","Board.tsx","Title.tsx","avatars.ts","Lobby.tsx","App.tsx","reportWebVitals.js","index.tsx"],"names":["CARDS","name","desc","effect_type","illust","effect","G","ctx","player","out","has_fruit","entities","push","includes","filter","x","score","undefined","find","discard","c","idx","players","indexOf","upper_idx","lower_idx","upper_player","lower_player","survive_bonus","public_goal_bonus","fruit_bonus","super_fruit","other_players","p","top_card","deck","move","flipped","flip_card","hand","has_tempura","len","length","Math","floor","card","log_msg","slice","map","skip_idx","AVATARS","goal_illust","score_based_on_fruit","fruit_idx","num_fruit","fruit","fruit_num","GOALS","stackable","aggressive_goal","target_idx","goal_bonus","protective_goal","player_idx","protect_target","eliminate_target","greedy_goal","fruits","e","kinds_of_fruits","Set","size","target_cards","num_archives","goal","is_goal","check_requirements","requirements","self","is_achieved","reduce","acc","val","new_acc","cnt","gamelogs","unshift","console","log","PUBLIC_GOALS","is_public","map_object","fn","obj","new_obj","k","PRNG","seed","this","i","charCodeAt","sin","result","random","arr","randRange","clone","srcIndex","dstIndex","shuffled","Array","randIndex","deck1","deck2","splice","init_round","num_places","should_finished","phase","round","_","times","rng","shuffle","init_deck","init_player","finished","previous_action","goals","public_goals","g","init_goals","previous_actions","preset_ai_behaviour","ai_behaviour","init_draft","init_ai_behaviour","BEHAVIOURS","aggressive","protective","topdown","greedy","protective_growth","topdown_growth","greedy_growth","choice","get_next_idx","current_idx","next_idx","place","from_idx","card_idx","direction","from_player","ai_moves","ai_players","ai","card_weights","weight","sorted_by_score","sort","a","b","top","danger","contain_target_cards","deck_card","public_fruit","to_disturb","j","another_player","disturb_direction","sorted_weights","actions","change_hands_or_enter_action_phase","hands","next_action","active_player_idx","num_moves","enter_action_phase","placed","active_player","shield_idx","proceed","skipped","all_finished","enter_place_phase","flip","flip_action","INVALID_MOVE","skipper","skipper_idx","archive","archive_idx","execute","execute_action","added","add_fruits","msg","CSPR","setup","setup_player","host","numPlayers","f1","f2","moves","setup_scenario","avatars","add_avatars","set_ai_players","num_ai","set_ai_behaviours","behaviours","add_action","action","carry_actions","ai_act","minPlayers","maxPlayers","turn","activePlayers","ActivePlayers","ALL","plugins","fnWrap","args","fruit_style","height","width","FRUITS","src","style","shield_icon","skip_icon","init_state","board","dream_count","get_operations","S","hand_selected","names","get_place_operations","flip_actions","execute_actions","ACTIONS","select_hand","change_hand_selected","clear_state","change_board","enter_dream","COMBINED","add_place_action","TopPanel","props","className","onClick","checkGoal","addAI","gameCount","DeckArea","cardNum","PlayArea","Card","playedCard","CardAreas","Avatar","border","selected","display","InfoLine","color","content","PlayerInfo","info","Player","playerInfo","Central","InfoPanel","handleClick","Controller","move1","operations","autoMove","useEffect","operation","setTimeout","combined","CardContainer","CardRow","cards","handleCardClick","get_player_info","entity","get_entity_icon","get_position","diff","GameBoard","list","indexes","process_player","alert","ceil","Goal","goal_illust_src","process_public_goal","fruits_lookup","A","B","C","split","char","BOARDS","GoalBoard","FinalBoard","Board","useState","setS","produce","board_props","parseInt","playerID","Date","TitleScreen","titleImg","title","dadiao","href","API","LobbyAvatar","borderColor","is_player","avatar","Room","get_avatar","locked","pid","sum","rand","fetch_rooms","setter","api","fetch","then","res","json","L","rooms","send_post_req","data","method","headers","body","JSON","stringify","onOperate","get_room_operation","room","player_id","player_contained","room_id","leave_room","enter_room","Lobby","uuidv4","setL","interval","setInterval","exit_lobby","clearInterval","window","addEventListener","removeEventListener","player_room","enter_game","flatMap","changer","max_players","direct_enter","SERVER","SocketIO","server","SingleClient","Client","game","debug","introduce_gameplay","Title","CSPRLobby","App","scene","matchID","game_instance","finish_game","game_data","prompt","Scene","GameInstance","multiplayer","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"gQAIaA,EAAiB,CAC5B,CACEC,KAAM,eACNC,KAAM,eACNC,YAAa,aACbC,OAAQ,oGACRC,OALF,SAKSC,EAAGC,EAAKC,GACbC,EAAID,KAGR,CACEP,KAAM,eACNC,KAAM,4EACNC,YAAa,aACbO,WAAW,EACXN,OAAQ,qGACRC,OANF,SAMSC,EAAGC,EAAKC,GACbA,EAAOG,SAASC,KAAK,YAGzB,CACEX,KAAM,eACNC,KAAM,gKACNC,YAAa,SACbO,WAAW,EACXN,OAAQ,qGACRC,OANF,SAMSC,EAAGC,EAAKC,GAETA,EAAOG,SAASE,SAAS,SAC3BL,EAAOG,SAAWH,EAAOG,SAASG,QAAO,SAAAC,GAAC,MAAW,SAANA,KAC/CP,EAAOQ,OAAS,GAGhBR,EAAOG,SAASC,KAAK,UAI7B,CACIX,KAAM,2BACNC,KAAM,kHAENC,YAAa,UACbC,OAAQ,0GACRC,OANJ,SAMWC,EAAGC,EAAKC,GACTA,EAAOQ,OAAS,EAAIR,EAAOQ,OAAS,EAClCR,EAAOQ,OAAS,IAI5B,CACIf,KAAM,eACNC,KAAM,kHAENC,YAAa,UACbC,OAAQ,sGACRC,OANJ,SAMWC,EAAGC,EAAKC,GACTA,EAAOQ,OAAS,EAAIR,EAAOQ,OAAS,EAClCR,EAAOQ,OAAS,IAI5B,CACIf,KAAM,eACNC,KAAM,kHAENC,YAAa,UACbC,OAAQ,iiCACRC,OANJ,SAMWC,EAAGC,EAAKC,GACTA,EAAOQ,OAAS,EAAIR,EAAOQ,OAAS,EAClCR,EAAOQ,OAAS,IAI5B,CACIf,KAAM,eACNC,KAAM,4EACNQ,WAAW,EACXP,YAAa,SACbC,OAAQ,mGACRC,OANJ,SAMWC,EAAGC,EAAKC,QAECS,IADFT,EAAOG,SAASO,MAAK,SAAAH,GAAC,MAAgB,iBAALA,OAE3CP,EAAOQ,OAAS,KAKxB,CACIf,KAAM,eACNC,KAAM,yDAENC,YAAa,UACbC,OAAQ,wHACRC,OANJ,SAMWC,EAAGC,EAAKC,GACbA,EAAOG,SAAW,KAIxB,CACIV,KAAM,eACNC,KAAM,4HACNQ,WAAW,EACXP,YAAa,SACbC,OAAQ,qGACRC,OANJ,SAMWC,EAAGC,EAAKC,QAGIS,IADFT,EAAOW,QAAQD,MAAK,SAAAE,GAAC,MAAgB,iBAAXA,EAAEnB,MAA4B,6BAAXmB,EAAEnB,UAE5DO,EAAOQ,OAAS,KAKtB,CACEf,KAAM,qBACNC,KAAM,sGACNC,YAAa,SACbC,OAAQ,wGACRC,OALF,SAKSC,EAAGC,EAAKC,GACb,IAAIa,EAAMf,EAAEgB,QAAQC,QAAQf,GACxBgB,GAAaH,EAAM,GAAK,EACxBI,GAAaJ,EAAM,GAAK,EACxBK,EAAepB,EAAEgB,QAAQE,GACzBG,EAAerB,EAAEgB,QAAQG,GACxBC,EAAajB,MAChBiB,EAAaV,OAAS,GAEnBW,EAAalB,MAChBkB,EAAaX,OAAS,KAI5B,CACEf,KAAM,eACNC,KAAM,oGACNC,YAAa,SACbC,OAAQ,qGACRM,WAAW,EACXL,OANF,SAMSC,EAAGC,EAAKC,GACbA,EAAOoB,eAAiB,IAG5B,CACE3B,KAAM,eACNC,KAAM,2DACNC,YAAa,SACbC,OAAQ,0GACRM,WAAW,EACXL,OANF,SAMSC,EAAGC,EAAKC,GACbF,EAAEuB,mBAAqB,IAe3B,CACE5B,KAAM,eACNC,KAAM,mIACNC,YAAa,SACbO,WAAW,EACXN,OAAQ,oGACRC,OANF,SAMSC,EAAGC,EAAKC,GACbA,EAAOsB,aAAe,IAI1B,CACE7B,KAAM,qBACNC,KAAM,gEAEN6B,YAAa,EACb3B,OAAQ,oGACRC,OANF,SAMSC,EAAGC,EAAKC,GAKbA,EAAOQ,OAAS,IAGtB,CACIf,KAAM,eACNC,KAAM,0DAENE,OAAQ,mGACR2B,YAAa,EACb1B,OANJ,SAMWC,EAAGC,EAAKC,GAKbA,EAAOQ,OAAS,IAGtB,CACIf,KAAM,eACNC,KAAM,0DAENE,OAAQ,yGACR2B,YAAa,EACb1B,OANJ,SAMWC,EAAGC,EAAKC,GAKbA,EAAOQ,OAAS,IAMpB,CACEf,KAAM,2BACNC,KAAM,kQACNE,OAAQ,8GACRC,OAJF,SAISC,EAAGC,EAAKC,GACb,IADqB,EACjBwB,EAAgB1B,EAAEgB,QAAQR,QAAO,SAAAC,GAAC,OAAIA,GAAKP,IAAWO,EAAEN,OADvC,cAEPuB,GAFO,IAErB,2BAA6B,CAAC,IAArBC,EAAoB,QAEvBC,EAAWD,EAAEE,KAAK,GAClBD,GAA6B,gBAAjBA,EAASjC,OACvBmC,EAAKH,EAAEE,KAAMF,EAAEd,SACfX,EAAOQ,OAAS,IAPC,iCAYzB,CACEf,KAAM,2BACNC,KAAM,kQACNE,OAAQ,sGACRC,OAJF,SAISC,EAAGC,EAAKC,GACb,IADqB,EACjBwB,EAAgB1B,EAAEgB,QAAQR,QAAO,SAAAC,GAAC,OAAIA,GAAKP,IAAWO,EAAEN,OADvC,cAEPuB,GAFO,IAErB,2BAA6B,CAAC,IAArBC,EAAoB,QACvBI,EAAUC,EAAUL,GACpBI,GAA2B,gBAAhBA,EAAQpC,OACrBQ,EAAIwB,GACJzB,EAAOQ,OAAS,IANC,iCAWzB,CACEf,KAAM,2BACNC,KAAM,gEACNE,OAAQ,6GACRD,YAAa,aACbE,OALF,SAKSC,EAAGC,EAAKC,GACb,IADqB,EACjBwB,EAAgB1B,EAAEgB,QAAQR,QAAO,SAAAC,GAAC,OAAIA,GAAKP,IAAWO,EAAEN,OADvC,cAEPuB,GAFO,IAErB,2BAA6B,CAAC,IAArBC,EAAoB,QAC3BG,EAAKH,EAAEE,KAAMF,EAAEM,OAHI,iCAOzB,CACEtC,KAAM,eACNC,KAAM,8CACNQ,WAAW,EACXP,YAAa,aACbC,OAAQ,2GACRC,OANF,SAMSC,EAAGC,EAAKC,GACbA,EAAOG,SAASC,KAAK,UAG3B,CACIX,KAAM,eACNC,KAAM,4BACNQ,WAAW,EACXP,YAAa,aACbC,OAAQ,2GACRC,OANJ,SAMWC,EAAGC,EAAKC,GACb4B,EAAK5B,EAAO2B,KAAM3B,EAAO+B,QAG/B,CACItC,KAAM,qBACNC,KAAM,4BACNQ,WAAW,EACXP,YAAa,aACbC,OAAQ,sGACRC,OANJ,SAMWC,EAAGC,EAAKC,GACb4B,EAAK5B,EAAO2B,KAAM3B,EAAO+B,MACzBH,EAAK5B,EAAO2B,KAAM3B,EAAO+B,QAI/B,CACItC,KAAM,qBACNC,KAAM,qIACNQ,WAAW,EACXP,YAAa,SACbC,OAAQ,q2CACRC,OANJ,SAMWC,EAAGC,EAAKC,IACc,IAAvBA,EAAOgC,YACThC,EAAOQ,OAAS,GAGhBR,EAAOQ,OAAS,EAChBR,EAAOgC,aAAc,KAK7B,CACIvC,KAAM,eACNC,KAAM,+FACNQ,WAAW,EACXP,YAAa,SACbC,OAAQ,igDACRC,OANJ,SAMWC,EAAGC,EAAKC,GACb,IAAIiC,EAAMjC,EAAOW,QAAQuB,OACzBlC,EAAOQ,OAAS2B,KAAKC,MAAMH,EAAM,KAIvC,CACIxC,KAAM,qBAENC,KAAM,8FACNQ,WAAW,EACXP,YAAa,SACbC,OAAQ,qGACRC,OAPJ,SAOWC,EAAGC,EAAKC,GAabA,EAAOQ,OAASV,EAAEgB,QAAQR,QAAO,SAAAmB,GAAC,OAAIA,EAAExB,OAAKiC,OAAS,EAAG,EAAI,IAGnE,CACIzC,KAAM,eACNC,KAAM,iHACNQ,WAAW,EACXP,YAAa,UACbC,OAAQ,kGACRC,OANJ,SAMWC,EAAGC,EAAKC,QAEAS,GADDT,EAAOG,SAASO,MAAK,SAAAH,GAAC,MAAgB,iBAALA,KAE3CP,EAAOQ,OAAS,EAGhBR,EAAOQ,OAAS,IAKxB,CACIf,KAAM,eACNC,KAAM,wFACNQ,WAAW,EACXP,YAAa,SACbC,OAAQ,wGACRC,OANJ,SAMWC,EAAGC,EAAKC,GACTA,EAAO+B,KAAKG,OAAS,IACvBlC,EAAOQ,OAAS,KASxB,CACIf,KAAM,eACNC,KAAM,yFACNQ,WAAW,EACXN,OAAQ,4GACRC,OALJ,SAKWC,EAAGC,EAAKC,GACb,IAAIqC,EAAOT,EAAK5B,EAAO2B,KAAM3B,EAAOW,cACxBF,GAAR4B,QAAoC5B,GAAf4B,EAAKxC,SAC5ByC,EAAQxC,EAAGC,EAAK,uDAAWsC,EAAK5C,KAAhB,oBAChB4C,EAAKxC,OAAOC,EAAGC,EAAKC,GACpBqC,EAAKxC,OAAOC,EAAGC,EAAKC,MAI1B,CACEP,KAAM,eACNC,KAAM,+IACNQ,WAAW,EACXP,YAAa,aACbC,OAAQ,oGACRC,OANF,SAMSC,EAAGC,EAAKC,GACb,IAAIqC,EAAOrC,EAAO2B,KAAK,GACvB,QAAYlB,GAAR4B,EAAmB,CAErB,GADAC,EAAQxC,EAAGC,EAAK,yEAAcsC,EAAK5C,SAClB,gBAAb4C,EAAK5C,KAKP,OAJAmC,EAAK5B,EAAO2B,KAAM3B,EAAOW,SACzBX,EAAOQ,OAAS,KAQxB,CACEf,KAAM,eACNC,KAAM,iHACNC,YAAa,aACbC,OAAQ,iGACRC,OALF,SAKSC,EAAGC,EAAKC,GAWTA,EAAOQ,OAAS,EAClBP,EAAID,GAGJA,EAAOQ,OAAS,IAKtB,CACEf,KAAM,eACNC,KAAM,0DACNC,YAAa,UACbC,OAAQ,qGACRC,OALF,SAKSC,EAAGC,EAAKC,GACbA,EAAO2B,KAAP,sBAAkB7B,EAAE6B,KAAKY,MAAM,EAAE,IAAjC,YAAwCvC,EAAO2B,OAC/C7B,EAAE6B,KAAO7B,EAAE6B,KAAKY,MAAM,KAI1B,CACE9C,KAAM,eACNC,KAAM,oDACNC,YAAa,aACbO,WAAW,EACXN,OAAQ,2HACRC,OANF,SAMSC,EAAGC,EAAKC,GAKb,GAFgBA,EAAO2B,KAAKY,MAAM,EAAE,GAEtBC,KAAI,SAACH,GAAD,OAAiBA,EAAK5C,QAAMY,SAAS,iBACjDL,EAAOG,SAASE,SAAS,QAAS,CACpC,IAAIoC,EAAWzC,EAAOG,SAASY,QAAQ,QACvCf,EAAOG,SAASsC,GAAY,YAOpC,CACEhD,KAAM,eACNC,KAAM,4EACNC,YAAa,SACbC,OAAQ,2GACRM,WAAW,EACXL,OANF,SAMSC,EAAGC,EAAKC,QAEAS,GADDT,EAAOG,SAASO,MAAK,SAAAH,GAAC,MAAgB,iBAALA,OAE3CP,EAAOQ,OAAS,MCreXkC,EAAU,CACvB,4CACA,4CACA,4CACA,4CACA,4CACA,4CACA,4CACA,4CACA,4CACA,6CAGaC,EAAc,sGCP3B,SAASC,EAAqB5C,EAAiB6C,GAC7C,IAAIC,EAAY9C,EAAOG,SAASG,QAAO,SAAAC,GAAC,MAAkB,iBAALA,GAAmBA,EAAEwC,OAASF,KAAaX,OAC5FY,GAAa,EACf9C,EAAOQ,OAAS,EAEI,GAAbsC,EACP9C,EAAOQ,OAAS,EAQI,GAAbsC,IACP9C,EAAOQ,OAAS,GAqBb,IAsQiBwC,EAAmBxC,EAF9ByC,EApQqB,CAEhC,CACExD,KAAM,yCACNC,KAAM,kFACNwD,WAAW,EACXC,gBAAiB,EACjBtD,OALF,SAKSC,EAAGC,EAAKC,GACb,IACIoD,GADatD,EAAEgB,QAAQC,QAAQf,GACJ,GAAK,EAGlB,GAFLF,EAAEgB,QAAQsC,GAEZnD,MACTD,EAAOQ,OAAS,EAAIR,EAAOqD,cAInC,CACI5D,KAAM,yCACNC,KAAM,kFACNwD,WAAW,EACXC,gBAAiB,EACjBtD,OALJ,SAKWC,EAAGC,EAAKC,GACb,IACIoD,GADatD,EAAEgB,QAAQC,QAAQf,GACJ,GAAK,EAGlB,GAFLF,EAAEgB,QAAQsC,GAEZnD,MACTD,EAAOQ,OAAS,EAAIR,EAAOqD,cAKnC,CACI5D,KAAM,yCACNC,KAAM,wFACNyD,gBAAiB,EACjBG,gBAAiB,EAEjBzD,OANJ,SAMWC,EAAGC,EAAKC,GACb,IAAIuD,EAAazD,EAAEgB,QAAQC,QAAQf,GAC/BwD,EAAiB1D,EAAEgB,SAASyC,EAAa,GAAK,GAC9CE,EAAmB3D,EAAEgB,SAASyC,EAAa,GAAK,IAEzB,IAAvBC,EAAevD,MACjBD,EAAOQ,OAAS,IAGW,IAAzBiD,EAAiBxD,MACnBD,EAAOQ,OAAS,KAwEtB,CACEf,KAAM,mCAENC,KAAM,yFACNgE,YAAa,EACb7D,OALF,SAKSC,EAAGC,EAAKC,GACb4C,EAAqB5C,EAAQ,KAGnC,CACIP,KAAM,6BAENC,KAAM,mFACNgE,YAAa,EACb7D,OALJ,SAKWC,EAAGC,EAAKC,GACb4C,EAAqB5C,EAAQ,KAGnC,CACIP,KAAM,mCAENC,KAAM,mFACNgE,YAAa,EACb7D,OALJ,SAKWC,EAAGC,EAAKC,GACb4C,EAAqB5C,EAAQ,KAanC,CACIP,KAAM,yCACNC,KAAM,uEACNG,OAHJ,SAGWC,EAAGC,EAAKC,GACb,IAAI2D,EAAS3D,EAAOG,SAASG,QAAO,SAAAsD,GAAC,MAAkB,kBAANA,KAC7CC,EAAkB,IAAIC,IAAIH,GAC9B3D,EAAOQ,OAAgC,EAAvBqD,EAAgBE,OAGpC,CACEtE,KAAM,yCACNC,KAAM,yFACNG,OAHF,SAGSC,EAAGC,EAAKC,GACb,IAAI2D,EAAS3D,EAAOG,SAASG,QAAO,SAAAsD,GAAC,MAAkB,kBAANA,KAEjD5D,EAAOQ,OAASmD,EAAOzB,QAAU,EAAG,EAAI,IAG5C,CACEzC,KAAM,6BACNC,KAAM,yFACNsE,aAAc,CAAC,eAAM,sBACrBnE,OAJF,SAISC,EAAGC,EAAKC,GACb,IAAIiE,EAAejE,EAAO+B,KAAKG,OAC/BlC,EAAOQ,OAAwB,EAAfyD,KA8ESzB,KArR/B,SAAsB0B,GACpB,OAAO,2BACFA,GADL,IAEEC,SAAS,EACTvE,OAAQ+C,OAkSNyB,EAAqB,SAACC,EAAwB7D,GAAzB,OAA2C,SAACV,EAAUC,EAAUC,EAAiBsE,GACtGA,IAASA,EAAKC,eACHvE,EAAOG,SAASqE,QAAO,SAACC,EAAKC,GACxC,GAAkB,iBAAPA,EAAiB,CAC1B,IAAIC,EAAO,YAAOF,GAElB,OADAE,EAAQD,EAAI3B,QAAU,EACf4B,EAGP,OAAOF,IAER,CAAC,EAAE,EAAE,IACWjC,KAAI,SAACoC,EAAK/D,GAAN,OAAe+D,EAAMP,EAAaxD,IAAS,KAC/CR,UAAS,KAG1BL,EAAOQ,OAASA,EAChB8D,EAAKC,aAAc,EACnBzE,EAAE+E,SAASC,QAAQ,iBACnBC,QAAQC,IAAI,eAAMV,EAAK5E,KAAM4E,EAAKC,iBAuG3BU,EA9F4B,CACvC,CACExF,KAAM,oCACNC,KAAM,MACNG,OAAQuE,EAAmB,CAAC,EAAE,EAAE,GAAI,GACpCV,YAAa,GAEf,CACEjE,KAAM,oCACNC,KAAM,MACNG,OAAQuE,EAAmB,CAAC,EAAE,EAAE,GAAI,GACpCV,YAAa,GAEf,CACEjE,KAAM,oCACNC,KAAM,MACNG,OAAQuE,EAAmB,CAAC,EAAE,EAAE,GAAI,GACpCV,YAAa,GAEf,CACEjE,KAAM,oCACNC,KAAM,KACNG,OAAQuE,EAAmB,CAAC,EAAE,EAAE,GAAI,GACpCV,YAAa,GAEf,CACEjE,KAAM,oCACNC,KAAM,KACNG,OAAQuE,EAAmB,CAAC,EAAE,EAAE,GAAI,GACpCV,YAAa,GAEf,CACEjE,KAAM,oCACNC,KAAM,KACNG,OAAQuE,EAAmB,CAAC,EAAE,EAAE,GAAI,GACpCV,YAAa,GAwBf,CACEjE,KAAM,oCACNC,KAAM,MACNgE,aAAc,EACd7D,QA1GoBmD,EA0GG,EA1GgBxC,EA0Gb,EA1G+B,SAACV,EAAUC,EAAUC,EAAiBsE,GAC7FA,IAASA,EAAKC,aACJvE,EAAOG,SAASqE,QAAO,SAACC,EAAIC,GAAL,MAA2B,iBAAPA,EAAkBD,EAAI,EAAGA,IAAM,IAAMzB,IAE1FhD,EAAOQ,OAASA,EAAQV,EAAEuB,kBAC1BiD,EAAKC,aAAc,EACnBzE,EAAE+E,SAASC,QAAQ,iBACnBC,QAAQC,IAAI,eAAMV,EAAK5E,KAAM4E,EAAKC,kBAkIK/B,KAxZ7C,SAA6B0B,GAC3B,OAAO,2BACFA,GADL,IAEEC,SAAS,EACTe,WAAW,EACXtF,ODvB8B,8G,cEb3B,SAASuF,EAAgBC,EAAiCC,GAC/D,IAAIC,EAA4B,GAEhC,IAAK,IAAIC,KAAKF,EACZC,EAAQC,GAAKH,EAAGC,EAAIE,GAAIA,GAG1B,OAAOD,EAuBF,IAAME,EAAb,WAIE,WAAYC,EAAuBf,GAGjC,GAHgD,yBAHlDe,UAGiD,OAFjDf,SAEiD,EAC/CgB,KAAKD,KAAOA,GAAQ,OAEThF,GAAPiE,EAEF,GADAgB,KAAKhB,IAAM,EACQ,iBAARe,EACT,IAAK,IAAIE,EAAE,EAAGA,EAAEF,EAAKvD,OAAQyD,IAC3BD,KAAKhB,KAAOe,EAAKG,WAAWD,QAI9BD,KAAKhB,IAAMe,OAOfC,KAAKhB,IAAMA,EAtBf,qDA2BI,IAAInE,EAA2B,IAAvB4B,KAAK0D,IAAIH,KAAKhB,OAClBoB,EAASvF,EAAI4B,KAAKC,MAAM7B,GAE5B,OADAmF,KAAKhB,KAAO,EACLoB,IA9BX,gCAiCYvF,GACR,OAAO4B,KAAKC,MAAM7B,EAAImF,KAAKK,YAlC/B,6BAqCSC,GACL,IAAI/D,EAAM+D,EAAI9D,OACd,OAAO8D,EAAIN,KAAKO,UAAUhE,MAvC9B,8BA0CUN,GAMN,IALA,IAAIuE,EAAQvE,EAAKY,MAAM,GACnB4D,EAAWxE,EAAKO,OAChBkE,EAAW,EACXC,EAAW,IAAIC,MAAMH,GAElBA,GAAU,CACf,IAAII,EAAaJ,EAAWT,KAAKK,SAAY,EAC7CM,EAASD,KAAcF,EAAMK,GAC7BL,EAAMK,GAAaL,IAAQC,GAG7B,OAAOE,MAtDX,KCdO,SAASzE,EAAK4E,EAAgBC,GAEnC,IAAIpE,EAAOmE,EAAME,OAAO,EAAG,GAAG,GAC9B,OAAIrE,GACFoE,EAAM3B,QAAQzC,GACPA,QAGP,EA4EJ,IAwCMsE,EAAmB,SAAC7G,EAAGC,GAE3BD,EAAE8G,WAAa,EAFoB,oBAKrB9G,EAAEgB,SALmB,IAKnC,2BAAyB,SACjBN,OAAS,KACbV,EAAE+G,iBAAkB,EACpB9B,QAAQC,IAAI,kBAAmBlF,EAAEgB,QAAQ0B,KAAI,SAAAf,GAAC,OAAIA,EAAEjB,YARrB,8BAanCV,EAAEgH,MAAQ,QACVhH,EAAEiH,OAAS,EACXjH,EAAE6B,KA/HJ,SAAmB7B,EAASC,GAE1B,IAF6C,EA4BzC4B,EA1BS,sBACRqF,IAAEC,MAAM,GAAG,iBAAM,mBADT,YAERD,IAAEC,MAAM,GAAG,iBAAM,mBAFT,YAGRD,IAAEC,MAAM,GAAG,iBAAM,mBAHT,YASRD,IAAEC,MAAM,GAAG,iBAAM,mBATT,YAURD,IAAEC,MAAM,GAAG,iBAAM,yBAVT,YAWRD,IAAEC,MAAM,GAAG,iBAAM,mBAXT,YAYRD,IAAEC,MAAM,GAAG,iBAAM,mBAZT,YAaRD,IAAEC,MAAM,GAAG,iBAAM,mBAbT,YAcRD,IAAEC,MAAM,GAAG,iBAAM,yBAdT,YAgBRD,IAAEC,MAAM,GAAG,iBAAM,yBAhBT,YAiBRD,IAAEC,MAAM,GAAG,iBAAM,+BAjBT,YAkBRD,IAAEC,MAAM,GAAG,iBAAM,+BAlBT,YAmBRD,IAAEC,MAAM,GAAG,iBAAM,mBAnBT,YAoBRD,IAAEC,MAAM,GAAG,iBAAM,mBApBT,YAsBRD,IAAEC,MAAM,GAAG,iBAAM,yBAtBT,YAuBRD,IAAEC,MAAM,GAAG,iBAAM,mBAvBT,YAwBRD,IAAEC,MAAM,GAAG,iBAAM,oBAEDzE,KAAI,SAAA/C,GAAI,OAAID,EAAMkB,MAAK,SAAAH,GAAC,OAAIA,EAAEd,MAAQA,QAAOa,QAAO,SAAAC,GAAC,YAASE,GAALF,KAAgBiC,KAAI,SAAAjC,GAAC,sBAASA,MA5B/D,cA6B5BoB,GA7B4B,IA6B7C,2BAAuB,CAAC,IAAfU,EAAc,QACjBA,EAAKnC,YACPmC,EAAKU,MAAQjD,EAAEoH,IAAIjB,UAAU,KA/BY,8BAkC7C,OAAOnG,EAAEoH,IAAIC,QAAQxF,GA6FZyF,CAAUtH,GACnBA,EAAEuH,aAAevH,EAAEuH,YAAc,GAAK,EACtCvH,EAAEuB,kBAAoB,EAjBa,oBAoBhBvB,EAAEgB,SApBc,IAoBnC,2BAA8B,CAAC,IAAtBd,EAAqB,QAC5BA,EAAO2B,KAAO,GACd3B,EAAO+B,KAAO,GACd/B,EAAOW,QAAU,GACjBX,EAAOG,SAAW,CAAC,QACnBH,EAAOC,KAAM,EACbD,EAAOsH,UAAW,EAClBtH,EAAOuH,iBAAmB,EAC1BvH,EAAOsB,YAAc,EACrBtB,EAAOqD,WAAa,EACpBrD,EAAOoB,cAAgB,EACvBpB,EAAOgC,aAAc,GA/BY,+BAdZ,SAAClC,EAAGC,GAI3B,IAHA,IAAIyH,EAAQ1H,EAAEoH,IAAIC,QAAN,sBAAkBlE,GAAlB,YAA4BA,EAAM3C,QAAO,SAAAC,GAAC,OAAIA,EAAE2C,gBAGnDyC,EAAE,EAAGA,EAAE7F,EAAEgB,QAAQoB,OAAQyD,IACnB7F,EAAEgB,QAAQ6E,GAEhB6B,MAAQA,EAAMjF,MAAMoD,EAAGA,EAAE,GAIlC7F,EAAE2H,aAAe3H,EAAEoH,IAAIC,QAAQlC,EAAazC,KAAI,SAAAkF,GAAC,kCAAOA,GAAP,IAAUnD,aAAa,QAAUhC,MAAM,EADjE,GAsCvBoF,CAAW7H,GA1EY,SAACA,EAAGC,GAAQ,oBAEhBD,EAAEgB,SAFc,IAEnC,2BAA8B,CAAC,IAAtBd,EAAqB,QAE5BA,EAAO+B,KAAOjC,EAAE6B,KAAKY,MAAM,EADX,GAEhBzC,EAAE6B,KAAO7B,EAAE6B,KAAKY,MAFA,GAIhBvC,EAAO4H,iBAAmB,GAEtB5H,EAAO6H,sBACT7H,EAAO8H,aAAe9H,EAAO6H,sBAVE,+BA2EnCE,CAAWjI,IAsCN,IAaMkI,EAA0B,SAAClI,EAAGC,GA2DzC,IA1DA,IAAMkI,EAA2B,CAwB/B,CACEC,WAAY,EACZC,WAAY,EACZC,QAAS,EACTC,OAAQ,EACRC,kBAAmB,EACnBC,eAAgB,EAChBC,cAAe,GAIjB,CACEN,WAAY,EACZC,WAAY,EACZC,QAAS,EACTC,OAAQ,EACRC,kBAAmB,EACnBC,eAAgB,EAChBC,cAAe,GAIjB,CACEN,WAAY,EACZC,WAAY,EACZC,QAAS,EACTC,OAAQ,EACRC,kBAAmB,EACnBC,eAAgB,EAChBC,cAAe,IAKV7C,EAAE,EAAGA,EAAE,EAAGA,IACjB7F,EAAEgB,QAAQ6E,GAAGkC,oBAAsB/H,EAAEoH,IAAIuB,OAAOR,IAgCpD,SAASS,EAAa5H,EAAoB6H,GACxC,IAAIC,GAAYD,EAAc,GAAM7H,EAAQoB,OAC5C,OAAIpB,EAAQ8H,GAAUtB,UAAYxG,EAAQ8H,GAAU3I,IAC3CyI,EAAa5H,EAAS8H,GAGtBA,EAIX,IAAMC,EAAc,SAAC/I,EAAGC,EAAK+I,EAAkBC,EAAkBC,GAC/D,IAAIC,EAAcnJ,EAAEgB,QAAQgI,GACxBzG,EAAO4G,EAAYlH,KAAKgH,GAC5BE,EAAYlH,KAAOkH,EAAYlH,KAAKzB,QAAO,SAAAC,GAAC,OAAKA,GAAK8B,KAEtCvC,EAAEgB,SAASgI,EAAWE,GAAalJ,EAAEgB,QAAQoB,QACnDP,KAAKmD,QAAQzC,GAEvB4G,EAAY1B,gBAAkByB,GAG1BE,EAAiB,SAACpJ,EAAGC,GAAS,IAAD,gBACjBD,EAAEqJ,YADe,IACjC,2BAA8B,CAQ5B,IAR6B,IAAtBtI,EAAqB,QAMxBuI,EAAKtJ,EAAEgB,QAAQD,GACfwI,EAA8B,GACzB1D,EAAE,EAAGA,EAAEyD,EAAGrH,KAAKG,OAAQyD,IAC9B0D,EAAajJ,KAAK,CAChBkJ,OAAQ,EACRN,UAAW,KAGf,IAAIO,EAAkB,YAAIzJ,EAAEgB,SAAS0I,MAAK,SAACC,EAAEC,GAAH,OAASA,EAAElJ,MAAQiJ,EAAEjJ,SAC3DmJ,EAAMJ,EAAgB,GAGtBI,GAAOP,IAETO,EAAMJ,EAAgB,IAGpBzJ,EAAEiH,OAAS,IAETwC,EAAgBhH,MAAM,EAAE,GAAGlC,SAAS+I,GACtCA,EAAGtB,aAAaM,SAAWgB,EAAGvB,qBAAuB,CAACO,QAAS,IAAIA,QAAWgB,EAAGtB,aAAaS,eAG9Fa,EAAGtB,aAAaO,QAAUe,EAAGvB,qBAAuB,CAACQ,OAAQ,IAAIA,OAAUe,EAAGtB,aAAaU,eAI/F,IAjC4B,EAiCxBoB,EAAS,EAjCe,cAkCd9J,EAAEgB,SAlCY,IAkC5B,2BAAyB,CAAC,IAAjBW,EAAgB,QACnBA,EAAE8F,kBAAqBzH,EAAEgB,QAAQC,QAAQU,GAAGA,EAAE8F,iBAAmB,GAAK1G,IACxE+I,GAAU,IApCc,gCAuCb,IAAXA,IACFR,EAAGtB,aAAaO,QAAUe,EAAGtB,aAAaQ,kBAC1Cc,EAAGtB,aAAaK,YAAciB,EAAGtB,aAAaQ,mBAzCpB,oBA6CXc,EAAG5B,OA7CQ,IA6C5B,2BAA2B,CAAC,IAAnBtD,EAAkB,QAGzB,GAAIA,EAAKf,gBACP,IAAK,IAAIwC,EAAE,EAAGA,EAAEyD,EAAGrH,KAAKG,OAAQyD,IAAK,CACnC,IAAItD,EAAO+G,EAAGrH,KAAK4D,GACf2D,EAASD,EAAa1D,GACD,eAArBtD,EAAK1C,cACP2J,EAAOA,QAAUF,EAAGtB,aAAaI,WAAakB,EAAGtB,aAAaO,OAC9DiB,EAAON,UAAU5I,KAAK8D,EAAKf,sBACE1C,IAAzByD,EAAKZ,iBACPgG,EAAON,UAAU5I,KAAK8D,EAAKZ,kBAOnC,QAAyB7C,IAArByD,EAAKR,YACP,IAAK,IAAIiC,EAAE,EAAGA,EAAEyD,EAAGrH,KAAKG,OAAQyD,IAAK,CACnC,IAAItD,EAAO+G,EAAGrH,KAAK4D,GACf2D,EAASD,EAAa1D,GACtBtD,EAAKU,QAAUmB,EAAKR,aAAerB,EAAKd,cAAgB2C,EAAKR,cAC/D4F,EAAOA,QAAUF,EAAGtB,aAAaO,OAC7BhG,EAAKd,cAAgB2C,EAAKR,cAAe4F,EAAOA,QAAmC,EAAzBF,EAAGtB,aAAaO,QAC9EiB,EAAON,UAAU5I,KAAK,IAM5B,GAAI8D,EAAKF,aAAc,CACrB,IADqB,EACjB6F,GAAuB,EADN,cAECT,EAAGzH,MAFJ,IAErB,2BAA+B,CAAC,IAAvBmI,EAAsB,QACzB5F,EAAKF,aAAa3D,SAASyJ,EAAUrK,QACvCoK,GAAuB,IAJN,gCAOrB,IAA6B,IAAzBA,EACF,IAAK,IAAIlE,EAAE,EAAGA,EAAEyD,EAAGrH,KAAKG,OAAQyD,IAAK,CACnC,IAAItD,EAAO+G,EAAGrH,KAAK4D,GACf2D,EAASD,EAAa1D,GACtBzB,EAAKF,aAAa3D,SAASgC,EAAK5C,QAClC6J,EAAOA,QAAmC,EAAzBF,EAAGtB,aAAaO,OACjCiB,EAAON,UAAU5I,KAAK,KAQ9B,IADA,IAAI2J,EAAejK,EAAE2H,aAAa,GAAG/D,YAC5BiC,EAAE,EAAGA,EAAEyD,EAAGrH,KAAKG,OAAQyD,IAAK,CACnC,IAAItD,EAAO+G,EAAGrH,KAAK4D,GACf2D,EAASD,EAAa1D,GACtBtD,EAAKU,QAAUgH,GAAgB1H,EAAKd,cAAgBwI,IACtDT,EAAOA,QAAUF,EAAGtB,aAAaO,OAC7BhG,EAAKd,cAAgBwI,IACvBT,EAAOA,QAAmC,EAAzBF,EAAGtB,aAAaO,QAEnCiB,EAAON,UAAU5I,KAAK,SAECK,GAApB4B,EAAKd,cAA+C,GAAjBwI,IACtCT,EAAOA,QAAmC,EAAzBF,EAAGtB,aAAaO,OACjCiB,EAAON,UAAU5I,KAAK,MA7GA,gCAmH5B,IAAK,IAAIuF,EAAE,EAAGA,EAAEyD,EAAGrH,KAAKG,OAAQyD,IAAK,CACnC,IAAItD,EAAO+G,EAAGrH,KAAK4D,GACf2D,EAASD,EAAa1D,GACF,UAApBtD,EAAK1C,cACP2J,EAAOA,QAAUF,EAAGtB,aAAaO,OAChB,sBAAbhG,EAAK5C,KACP6J,EAAON,UAAU5I,KAAK,GAGtBkJ,EAAON,UAAU5I,KAAKN,EAAEoH,IAAIuB,OAAO,CAAC,EAAE,MAM5C,IAAK,IAAI9C,EAAE,EAAGA,EAAEyD,EAAGrH,KAAKG,OAAQyD,IAAK,CACnC,IAAItD,EAAO+G,EAAGrH,KAAK4D,GACf2D,EAASD,EAAa1D,GACF,cAApBtD,EAAK1C,cACP2J,EAAOA,QAAUF,EAAGtB,aAAaK,WAChB,4BAAb9F,EAAK5C,KACP6J,EAAON,UAAU5I,KAAKN,EAAEoH,IAAIuB,OAAO,CAAC,EAAE,EAAE,KAGxCa,EAAON,UAAU5I,KAAK,IAM5B,IAAK,IAAIuF,EAAE,EAAGA,EAAEyD,EAAGrH,KAAKG,OAAQyD,IAAK,CACnC,IAAItD,EAAO+G,EAAGrH,KAAK4D,GACf2D,EAASD,EAAa1D,GACF,WAApBtD,EAAK1C,aAAgD,cAApB0C,EAAK1C,cACxC2J,EAAOA,QAAUF,EAAGtB,aAAaM,QACjCkB,EAAON,UAAU5I,MAAM,EAAIN,EAAEgB,QAAQC,QAAQ4I,GAAO9I,GAAK,IAK7D,IAAImJ,EAAa,CAAC,EAAE,EAAE,EAAE,GACxBA,EAAWnJ,IAAQ,GACnB,IAAK,IAAI8E,EAAE,EAAGA,EAAE7F,EAAEgB,QAAQoB,OAAQyD,IAChC,CAAa7F,EAAEgB,QAAQ6E,GACvB,IADA,IACSsE,EAAE,EAAGA,EAAEnK,EAAEgB,QAAQoB,OAAQ+H,IAChC,GAAItE,GAAKsE,EAAG,CACV,IADU,EACNC,EAAiBpK,EAAEgB,QAAQmJ,GADrB,cAEkBC,EAAetC,kBAFjC,IAEV,2BAA6D,EACtDqC,EADsD,SAC/B,GAAKtE,IAC/BqE,EAAWrE,IAAM,IAJX,kCAUhB,IAA8B,GAA1BqE,EAAWjJ,QAAQ,GAErB,IADA,IAAIoJ,GAAqB,GAAMH,EAAWjJ,QAAQ,GAAK,GAAK,EAAKF,GAAO,EAC/D8E,EAAE,EAAGA,EAAEyD,EAAGrH,KAAKG,OAAQyD,IAAK,CACnC,IAAItD,EAAO+G,EAAGrH,KAAK4D,GACf2D,GAASD,EAAa1D,GACF,WAApBtD,EAAK1C,aAAgD,cAApB0C,EAAK1C,cACxC2J,GAAOA,QAAUF,EAAGtB,aAAaI,aAAe,EAAEkB,EAAGrH,KAAKG,QAAQ,GAClEoH,GAAON,UAAU5I,KAAK+J,IAM5B,IAAIC,GAAc,UAAOf,GACzBe,GAAeZ,MAAK,SAACC,EAAEC,GAAH,OAAOA,EAAEJ,OAASG,EAAEH,UACxC,IAAIP,GAAWM,EAAatI,QAAQqJ,GAAe,IAC/CpB,GAAY,EACZoB,GAAe,GAAGpB,UAAU9G,OAAS,IACvC8G,GAAYlJ,EAAEoH,IAAIuB,OAAO2B,GAAe,GAAGpB,YAe7ClJ,EAAEuK,QAAQjK,KAAK,CACb0I,SAAUjI,EACVkI,YACAC,gBA/M6B,kCAoO7BsB,EAA2C,SAACxK,EAAGC,GACnD,IAAIwK,EAAQzK,EAAEgB,QAAQ0B,KAAI,SAAAxC,GAAM,OAAIA,EAAO+B,QACvCE,EAAMsI,EAAMrI,OAOhB,GAA0B,GANDqI,EAAM,GAAGrI,QAnBH,SAACpC,EAAGC,GACnCD,EAAEgH,MAAQ,SADiC,oBAGxBhH,EAAEgB,SAHsB,IAG3C,2BAA8B,CAAC,IAAtBd,EAAqB,QAE5BA,EAAO2B,KAAO7B,EAAEoH,IAAIC,QAAQnH,EAAO2B,MACnC3B,EAAO2B,KAAP,sBAAkB3B,EAAO2B,MAAzB,YAAkC3B,EAAOwH,SANA,8BAU3C1H,EAAE0K,YAAc,OAChB1K,EAAE2K,kBAAoB3K,EAAEuH,YACxBvH,EAAE4K,UAAY,EAeZC,CAAmB7K,OAGhB,CAEHyK,EAAK,CAAIA,EAAMtI,EAAI,IAAd,mBAAqBsI,EAAMhI,MAAM,EAAGN,EAAI,KAC7C,IAAK,IAAI0D,EAAE,EAAGA,EAAE1D,EAAK0D,IACnB7F,EAAEgB,QAAQ6E,GAAG5D,KAAOwI,EAAM5E,GAlB6B,oBAsBzC7F,EAAEgB,SAtBuC,IAsB3D,IAAI,EAAJ,qBAA6B,SACpB8J,QAAS,GAvByC,gCAyDtD,SAAS9I,EAAU+I,GACxB,IAAIxI,EAAOwI,EAAclJ,KAAK,GAK9B,YAJYlB,GAAR4B,IACFwI,EAAclJ,KAAOkJ,EAAclJ,KAAKY,MAAM,GAC9CsI,EAAclK,QAAQmE,QAAQzC,IAEzBA,EAGF,SAASpC,EAAID,GAClB,IAAI8K,EAAa9K,EAAOG,SAASqC,KAAI,SAACjC,EAAEM,GAAH,MAAiB,UAALN,EAAgBM,OAAMJ,KAAWH,QAAO,SAAAC,GAAC,YAASE,GAALF,KAAgB,QAE5FE,GAAdqK,EACF9K,EAAOG,SAAWH,EAAOG,SAASG,QAAO,SAACC,EAAEM,GAAH,OAAYA,GAAOiK,MAI5D9K,EAAOC,KAAM,EACbD,EAAOsH,UAAW,GA6BtB,IAIMyD,EAAgB,SAACjL,EAAGC,EAAKiL,GAE7B,GADAlL,EAAE4K,WAAa,EACM,WAAjB5K,EAAE0K,aAA4BQ,EAGhC,GApXJ,SAAsBlL,GAEpB,YAAyBW,GADDX,EAAEgB,QAAQJ,MAAK,SAAAH,GAAC,QAAMA,EAAE+G,UAAY/G,EAAEN,QAmXxDgL,CAAanL,IATW,SAACA,EAAGC,GAClC4G,EAAW7G,GASPoL,CAAkBpL,OAEf,CACH,IAAI8I,EAAWF,EAAa5I,EAAEgB,QAAShB,EAAE2K,mBACzC3K,EAAE2K,kBAAoB7B,EACtB9I,EAAE0K,YAAc,YAKlB1K,EAAE0K,YAAc,WAIdW,EAAa,SAACrL,EAAGC,EAAKwD,EAAoB6H,GAE9C,GAAqB,QAAjBtL,EAAE0K,aAAyB1K,EAAE2K,mBAAqBlH,EA0CpD,OAAO8H,IAzCP,IAAIR,EAAgB/K,EAAEgB,QAAQhB,EAAE2K,mBAC5BO,GAAU,EACVM,EAAUT,EAAc1K,SAASO,MAAK,SAAAH,GAAC,MAAS,QAALA,KAE/C,GAAmB,QAAf6K,QAAoC3K,GAAX6K,EAAsB,CACjD,IAAIC,EAAcV,EAAc1K,SAASY,QAAQuK,GACjDxJ,EAAU+I,GACVA,EAAc1K,SAASuG,OAAO6E,EAAa,GAC3CP,GAAU,EACV1I,EAAQxC,EAAGC,EAAJ,4BAE0B,GAA7B8K,EAAclJ,KAAKO,SACrB2I,EAAcvD,UAAW,QAKxB,GAA2B,iBAAhB8D,GAA4B,gBAAiBA,EAAa,CACxE,IAAII,EAAUX,EAAc9I,KAAKqJ,EAAYK,aAC7C,QAAehL,GAAX+K,EAKF,OAAOH,IAJPR,EAAc9I,KAAO8I,EAAc9I,KAAKzB,QAAO,SAAAC,GAAC,OAAIA,GAAKiL,KACzDX,EAAclK,QAAQmE,QAAQ0G,QAShC1J,EAAU+I,QAEuBpK,IAA7BoK,EAAclK,QAAQ,IACxB2B,EAAQxC,EAAGC,EAAJ,uBAAe8K,EAAclK,QAAQ,GAAGlB,OAInDsL,EAAQjL,EAAGC,EAAKiL,IAQdU,EAAgB,SAAC5L,EAAGC,EAAKwD,EAAoBoI,GACjD,GAAIpI,GAAczD,EAAE2K,kBA+ClB,OAAOY,IA9CP,IAAIrL,EAASF,EAAEgB,QAAQhB,EAAE2K,mBACrBpI,EAAOrC,EAAOW,QAAQ,GAE1B,GAAsB,SAAlBgL,EAA2B,CAE7B,QAAmBlL,IAAf4B,EAAKU,YAA4CtC,IAArB4B,EAAKd,YAanC,OAAO8J,IAXP,IAAIO,EAAQ,CAAC,EAAE,EAAE,QACEnL,IAAf4B,EAAKU,QACP6I,EAAMvJ,EAAKU,OAAS,QAEGtC,IAArB4B,EAAKd,cACPqK,EAAMvJ,EAAKd,aAAe,GA7c7B,SAAoBzB,EAASC,EAASC,EAAiB2D,GAC5D,IAAK,IAAIgC,EAAE,EAAGA,EAAE,EAAGA,IACjB,IAAK,IAAIsE,EAAE,EAAGA,EAAEtG,EAAOgC,GAAIsE,IACzBjK,EAAOG,SAASC,KAAK,CAAC2C,MAAO4C,IAC7B3F,EAAOQ,OAASR,EAAOsB,YAJmD,oBAO7DxB,EAAE2H,cAP2D,yBAOrEvD,EAPqE,QAQ3Ee,EAAavE,MAAK,SAAAH,GAAC,OAAIA,EAAEb,MAAQwE,EAAKxE,QAAgBG,OAAOC,EAAGC,EAAKC,EAAQkE,IADhF,2BAAkC,IAP4C,+BA+cxE2H,CAAW/L,EAAGC,EAAKC,EAAQ4L,GAC3BtJ,EAAQxC,EAAGC,EAAJ,iBAAcsC,EAAK5C,KAAnB,mCAST4C,GAAQA,EAAK8B,QAAQlB,EAAMzD,GAAOkB,MAAK,SAAAH,GAAC,OAAIA,EAAEd,MAAQ4C,EAAK5C,SAEtDI,QAAUwC,EAAKxC,OAAOC,EAAGC,EAAKC,EAAQqC,GAC3CC,EAAQxC,EAAGC,EAAJ,uBAAesC,EAAK5C,OACV,gBAAb4C,EAAK5C,MACP6C,EAAQxC,EAAGC,EAAJ,6BAAgBC,EAAO2B,KAAKY,MAAM,EAAE,GAAGC,KAAI,SAAA5B,GAAC,OAAIA,EAAEnB,UAM7DO,EAAOsH,SAAYtH,EAAOC,KAA8B,GAAtBD,EAAO2B,KAAKO,OAGnB,IAAvBlC,EAAO2B,KAAKO,SACdlC,EAAOQ,OAASR,EAAOoB,cACvBpB,EAAOoB,cAAgB,GAGzB2J,EAAQjL,IAqECwC,EAAgB,SAACxC,EAAGC,EAAK+L,GACpChM,EAAE+E,SAASC,QAAQgH,IAGRC,EAAO,CAClBC,MA3qBF,SAAejM,GACb,IAAMmH,EAAM,IAAI1B,EAAK,QACf1F,EAAW,CACf6B,KAAM,GACNb,QAASkG,IAAEC,MA3KK,GA2Kc,kBAtHlC,SAAsBC,GAgCpB,MA/BmB,CACjB1G,MAAO,EACPuB,KAAM,GACNJ,KAAM,GACNhB,QAAS,GACT6G,MAAO,GAEPrH,SAAU,CAAC,QAEXoH,iBAAkB,EAClBK,iBAAkB,GAElBN,UAAU,EACVrH,KAAK,EACLqB,YAAa,EACb+B,WAAY,EACZjC,cAAe,EAIf0G,aAAc,CACZI,WAAYhB,EAAIjB,UAAU,IAC1BkC,WAAYjB,EAAIjB,UAAU,IAC1BoC,OAAQnB,EAAIjB,UAAU,IACtBmC,QAASlB,EAAIjB,UAAU,IACvBuC,cAAetB,EAAIjB,UAAU,GAC7BqC,kBAAmBpB,EAAIjB,UAAU,GACjCsC,eAAgBrB,EAAIjB,UAAU,KA0FEgG,CAAa/E,MAC/CO,aAAc,GACdP,MACAmD,QAAS,GACTtD,OAAQ,EACRM,YAAa,EACboD,kBAAmB,EACnBD,YAAa,QAEb1D,MAAO,QAEPoF,KAAM,EACN/C,WAAY,CAAC,EAAE,EAAE,EAAE,GAAG5G,MAAMxC,EAAIoM,YAChCtH,SAAU,GACV+B,WAAY,EACZ8D,UAAW,EACXrJ,kBAAmB,EAEnBwF,iBAAiB,EAEjBuF,GAAI,iBAAM,MACVC,GAAI,iBAAM,OAMZ,OAHAtH,QAAQC,IAAR,+BAAoCjF,EAAIoM,WAAxC,YAAsDrM,EAAEqJ,aAGjDrJ,GA6oBPwM,MAAO,CACLC,eA3oBgC,SAACzM,EAAGC,EAAK0F,GAC3C3F,EAAEoH,IAAM,IAAI1B,EAAKC,GAlGO,SAAC3F,EAAGC,GAK5B,IAJA,IAAIkC,EAAMnC,EAAEgB,QAAQoB,OAGhBsK,EAAU1M,EAAEoH,IAAIC,QAAQzE,GAASH,MAAM,EAAGN,GACrC0D,EAAE,EAAGA,EAAE1D,EAAK0D,IACnB7F,EAAEgB,QAAQ6E,GAAG/F,OAAS4M,EAAQ7G,GA6FhC8G,CAAY3M,GACZkI,EAAkBlI,EAAGC,GACrB4G,EAAW7G,IAwoBT4M,eApoBgC,SAAC5M,EAAGC,EAAK4M,GAC3C7M,EAAEqJ,WAAa,CAAC,EAAE,EAAE,EAAE,GAAG5G,OAAOoK,GAChC5H,QAAQC,IAAI,iBAAkBlF,EAAEqJ,aAmoB9ByD,kBAhkBmC,SAAC9M,EAAGC,EAAK8M,GAC9C,IAAK,IAAIlH,EAAE,EAAGA,EAAE,EAAGA,IACjB7F,EAAEgB,QAAQ6E,GAAGkC,oBAAsBgF,EAAWlH,IA+jB9CmH,WAtQqB,SAAChN,EAAGC,EAAKgN,QAClBtM,GAAVsM,IACFjN,EAAEuK,QAAQjK,KAAK2M,GACfjN,EAAEgB,QAAQiM,EAAOjE,UAAU8B,QAAS,EAGrBmC,EAAOjE,UACNhJ,EAAEoM,MAChBhD,EAASpJ,IAMTA,EAAEuK,QAAQnI,QAAUpC,EAAEgB,QAAQoB,QAzBR,SAACpC,EAAGC,GAAS,IAAD,gBACnBD,EAAEuK,SADiB,IACtC,2BAA8B,CAAC,IAAtB0C,EAAqB,QAC5BlE,EAAM/I,EAAGC,EAAKgN,EAAOjE,SAAUiE,EAAOhE,SAAUgE,EAAO/D,WACvDlJ,EAAEgB,QAAQiM,EAAOjE,UAAUlB,iBAAkBxH,KAAK2M,EAAO/D,YAHrB,8BAKtClJ,EAAEuK,QAAU,GACZvK,EAAE8G,YAAc,EAEhB0D,EAAmCxK,GAkBjCkN,CAAclN,IAwPdqL,OACAO,UACAxC,WACA+D,OA5EiB,SAACnN,EAAGC,EAAK+I,GAC5B,IAAIhJ,EAAEqJ,WAAW9I,SAASP,EAAE2K,oBAAuB3K,EAAEoM,MAAQpD,EAyD3D,OAAOuC,IAxDP,IAAIjC,EAAKtJ,EAAEgB,QAAQhB,EAAE2K,mBACrB,GAAqB,QAAjB3K,EAAE0K,YAAuB,CAG3B,IAAIY,EAA0B,OAG9B,GAAIhC,EAAGrH,KAAKG,OAAS,EAAG,CACtB,IAAIsJ,EAAUpC,EAAGrH,KAAK,GACK,cAAvByJ,EAAQ7L,aAAsD,WAAvB6L,EAAQ7L,cAA+ByJ,EAAG5B,MAAM,GAAGxD,cAAgB,IAAI3D,SAAS,kBACzH+K,EAAc,CAACK,YAAa,IAK3BrC,EAAGjJ,SAASE,SAAS,SACzB+I,EAAGzH,KAAKO,OAAS,GACjBkH,EAAGzH,KAAKO,OAAS,GACjBkH,EAAG5B,MAAM,GAAGxD,cAAgB,CAAC,iBAC7BoF,EAAGtB,aAAaK,WAAaiB,EAAGtB,aAAaO,SAC5Ce,EAAGjJ,SAASE,SAAS,YAErB+K,EAAc,QAGhBD,EAAKrL,EAAGC,EAAKD,EAAE2K,kBAAmBW,OAG/B,IAAqB,WAAjBtL,EAAE0K,YAwBT,OAAOa,IArBP,IAAIM,EAAgC,UAG/BvC,EAAGtB,aAAaO,OAASe,EAAGtB,aAAaK,YAC3C,sBAAIrI,EAAE2H,aAAanH,QAAO,SAAAoH,GAAC,OAAKA,EAAEnD,eAAa/B,KAAI,SAAAkF,GAAC,OAAIA,EAAEhE,gBAA1D,CAAwE0F,EAAG5B,MAAM,GAAG9D,cAAapD,QAAO,SAAAoH,GAAC,YAASjH,GAALiH,KAAgBrH,SAAS+I,EAAGzI,QAAQ,GAAGoC,SAErJ4I,EAAiB,SAGO,gBAAtBvC,EAAGzI,QAAQ,GAAGlB,MAAwE,GAAxD2J,EAAGjJ,SAASG,QAAO,SAAAC,GAAC,MAAgB,iBAALA,KAAe2B,SAE9EyJ,EAAiB,cAGelL,IAA9B2I,EAAGzI,QAAQ,GAAGY,cAChBoK,EAAiB,SAGnBD,EAAQ5L,EAAGC,EAAKD,EAAE2K,kBAAmBkB,KA0BvCrJ,WAEF4K,WAAY,EACZC,WAAY,EACZC,KAAM,CACJC,cAAeC,IAAcC,KAE/BC,QAAS,CACP,CACE/N,KAAM,MACNgO,OAAQ,SAACrI,GAAD,OAAY,SAACtF,EAASC,GAA4B,IAAD,uBAAf2N,EAAe,iCAAfA,EAAe,kBAEvD,OADA5N,EAAIsF,EAAE,WAAF,8BAAOtF,GAAP,IAAUoH,IAAK,IAAI1B,EAAK,OAAQ1F,EAAEoH,IAAIxC,OAAO3E,GAA7C,OAAqD2N,S,QC/2B3DC,G,MAAc,CAClBC,OAAQ,OACRC,MAAO,UAGIC,EAAqB,CAChC,oGACA,mGACA,0GACAtL,KAAI,SAAAuL,GAAG,OAAI,qBAAKA,IAAKA,EAAKC,MAAOL,OAEtBM,EAAc,qBAAKF,IAAI,qGAAqGC,MAAOL,IAEnIO,EAAY,qBAAKH,IAAI,2GAA2GC,MAAOL,IChB7I,SAASQ,IACd,MAAO,CACLC,MAAO,YACP7K,WAAY,EACZyB,IAAK,GACLqJ,YAAa,GAuCV,SAASC,EAAexO,EAAUyO,GACvC,IAAIvO,EAASF,EAAEgB,QAAQyN,EAAEhL,YACzB,GAAe,SAAXzD,EAAEgH,MACJ,OAAK9G,EAAO4K,aAA6BnK,GAAnB8N,EAAEC,cAIf,GAjCb,SAA8B1F,EAAkBC,GAC9C,IACI0F,EAAQ,CAAC,eAAM,eAAM,eAAM,gBAE/B,MAHiB,CAAC,EAAG,EAAG,EAAG,GAGTjM,KAAI,SAACwG,EAAWnI,GAAZ,MAAqB,CACzCpB,KAAMgP,EAAM5N,GACZkM,OAAQ,mBACRW,KAAM,CAAC5E,EAAUC,EAAUC,OAuBlB0F,CAAqBH,EAAEhL,WAAYgL,EAAEC,eAO9C,GAAI1O,EAAE2K,mBAAqB8D,EAAEhL,WAAY,CACvC,GAAIgL,EAAEhL,YAAczD,EAAEoM,MAAQpM,EAAEqJ,WAAW9I,SAASP,EAAE2K,mBACpD,MAAO,CACL,CACEhL,KAAM,eACNsN,OAAQ,SACRW,KAAM,CAACa,EAAEhL,cAIf,GAAqB,QAAjBzD,EAAE0K,YAAuB,CAC3B,IAAImE,EAA6B,CAC/B,CAAClP,KAAM,eAAMsN,OAAQ,OAAQW,KAAM,CAACa,EAAEhL,WAAY,UAQpD,OANIvD,EAAOG,SAASE,SAAS,SAC3BsO,EAAavO,KAAK,CAACX,KAAM,eAAMsN,OAAQ,OAAQW,KAAM,CAACa,EAAEhL,WAAY,UAEjEvD,EAAO+B,KAAKG,OAAS,QAA0BzB,GAAnB8N,EAAEC,eACjCG,EAAa7J,QAAQ,CAACrF,KAAM,2BAAQsN,OAAQ,OAAQW,KAAM,CAACa,EAAEhL,WAAY,CAACkI,YAAa8C,EAAEC,kBAEpFG,EAGP,IAAIC,EAAgC,CAClC,CAACnP,KAAM,eAAMsN,OAAQ,UAAWW,KAAM,CAACa,EAAEhL,WAAY,aAEnD7B,EAAW1B,EAAOW,QAAQ,GAI9B,YAHuBF,IAAnBiB,EAASqB,YAAgDtC,IAAzBiB,EAASH,aAC3CqN,EAAgBxO,KAAK,CAACX,KAAM,2BAAQsN,OAAQ,UAAWW,KAAM,CAACa,EAAEhL,WAAY,WAEvEqL,EAIT,OAAIL,EAAEhL,YAAczD,EAAEoM,MAAQpM,EAAEqJ,WAAW9I,SAASP,EAAE2K,mBAC7C,CACL,CACEhL,KAAM,eACNsN,OAAQ,SACRW,KAAM,CAACa,EAAEhL,cAKN,GAMf,IAiBMjB,EAAkB,SAACiM,EAAGzC,GAC1ByC,EAAEvJ,IAAM8G,GAOG+C,EAAkC,CAC7CC,YA1B0B,SAACP,EAAG1N,EAAab,IAhGR,SAACuO,EAAG1N,GACnC0N,EAAEC,eAAiB3N,EACrB0N,EAAEC,mBAAgB/N,EAGlB8N,EAAEC,cAAgB3N,EA4FpBkO,CAAqBR,EAAG1N,GACxB,IAAIwB,EAAOrC,EAAO+B,KAAKlB,GAClBb,EAAO4K,QACVtI,EAAQiM,EAAG,iCAAOlM,EAAK5C,KAAZ,KAAoB4C,EAAK3C,UAuBtCsP,YAnB0B,SAACT,GAC3BA,EAAEC,mBAAgB/N,GAmBlBwO,aAf2B,SAACV,EAAGH,GAC/BG,EAAEH,MAAQA,GAeV9L,UACA4M,YAT0B,SAACX,GAC3BA,EAAEF,aAAe,ICnGNc,EAA2C,CACtDC,iBA7BuC,SAAC9C,EAAOjC,EAASvB,EAAkBC,EAAkBC,GAC5FsD,EAAMQ,WAAW,CAAChE,WAAUC,WAAUC,cACtCqB,EAAQ2E,eA4BR/B,OAzB6B,SAACX,EAAOjC,EAASvB,GAC9CwD,EAAMW,OAAOnE,IAyBbqC,KAjB2B,SAACmB,EAAOjC,EAAS9G,EAAoB6H,GAChEkB,EAAMnB,KAAK5H,EAAY6H,IAiBvBM,QAb8B,SAACY,EAAOjC,EAAS9G,EAAoBoI,GACnEW,EAAMZ,QAAQnI,EAAYoI,IAa1BzC,SAxB+B,SAACoD,EAAOjC,EAASvB,GAChDwD,EAAMpD,SAASJ,GACfwD,EAAMQ,eCGR,SAASuC,GAASC,GAChB,OAAO,sBAAKC,UAAU,YAAf,UACL,wBAAQA,UAAU,oBAAoBC,QAASF,EAAMG,UAArD,sCACA,qBAAKD,QAASF,EAAMI,MAApB,SAA4BJ,EAAMK,eAItC,SAASC,GAASN,GAChB,OAAO,qBAAKC,UAAU,YAAf,SACL,qBAAKA,UAAU,WAAf,SACGD,EAAMO,YAKb,SAASC,GAASR,GAChB,OAAO,qBAAKC,UAAU,YAAf,SACL,cAACQ,GAAD,eAAUT,EAAMU,eAIpB,SAASC,GAAUX,GAGjB,OAAO,sBAAKC,UAAU,aAAf,UACL,cAACK,GAAD,CAAUC,QAASP,EAAMO,UACzB,cAACC,GAAD,CAAUE,WAAYV,EAAMU,gBAIhC,SAASE,GAAOZ,GACd,OAAO,sBAAKC,UAAU,SAASvB,MAAO,CAACmC,OAAQb,EAAMc,SAAU,oBAAqBd,EAAMrP,IAAK,yBAAoBQ,GAA5G,UACL,qBAAKsN,IAAKuB,EAAM1P,OAAQ2P,UAAU,eAClC,qBAAKxB,IAAI,+GAA+GwB,UAAU,YAAYvB,MAAO,CAACqC,QAASf,EAAM1E,YAAQnK,EAAY,aAI7L,SAAS6P,GAAShB,GAChB,OAAO,qBAAKC,UAAU,YAAYvB,MAAO,CAACuC,MAAuB,sBAAfjB,EAAMkB,QAAgB,eAAU/P,GAA3E,SACJ6O,EAAMkB,UAWX,SAASC,GAAWnB,GAClB,OAAO,sBAAKC,UAAU,cAAf,UACL,cAACW,GAAD,CAAQtQ,OAAQ0P,EAAM1P,OAAQwQ,SAAUd,EAAMc,SAAUnQ,IAAKqP,EAAMrP,IAAK2K,OAAQ0E,EAAM1E,SACtF,cAAC0F,GAAD,CAAUE,QAAO,UAAKlB,EAAM7P,KAAX,YAAmB6P,EAAM9O,MAAzB,aACjB,cAAC8P,GAAD,CAAUE,QAASlB,EAAMoB,UAI7B,SAASC,GAAOrB,GACd,OAAO,sBAAKC,UAAU,SAAf,UACL,cAACU,GAAD,CAAWJ,QAASP,EAAMsB,WAAWjP,KAAKO,OAAQ8N,WAAYV,EAAMsB,WAAWjQ,QAAQ,KACvF,cAAC8P,GAAD,eAAgBnB,EAAMsB,gBAI1B,SAASC,GAAQvB,GACf,OAAO,qBAAKC,UAAU,UAAf,SACJD,EAAMxO,QAAQ0B,KAAI,SAAAxC,GAAM,OAEvB,aADF,CACG2Q,GAAD,CAAQC,WAAY5Q,SAK1B,SAAS8Q,GAAUxB,GAGjB,OAAO,qBAAKC,UAAU,aAAaC,QAASF,EAAMyB,YAA3C,SACJzB,EAAMtK,MAIX,SAASgM,GAAW1B,GAElB,IAAI2B,EAAQ3B,EAAM4B,WAAW,GACzBC,EAAWF,GAAwB,gBAAdA,EAAMxR,KAC/B2R,qBAAU,WACR,GAAgB,GAAZD,EAAJ,CACE,IAAIE,EAAY/B,EAAM4B,WAAW,GACjCnM,QAAQC,IAAR,6BAAkCsK,EAAMxP,EAAE2K,kBAA1C,YAA+D6E,EAAMxP,EAAE0K,cACvE8G,YAAW,WAAK,IAAD,GACb,EAAAhC,EAAMiC,UAASF,EAAUtE,QAAzB,oBAAqCsE,EAAU3D,MAAQ,OACtD,QAKJ,CAAC4B,EAAMxP,EAAE2K,kBAAmB6E,EAAMxP,EAAE0K,YAAa8E,EAAMxP,EAAE4K,YAE5D,IAAIwG,EAAcC,EAAW,GAAK7B,EAAM4B,WAExC,OAAO,qBAAK3B,UAAU,aAAf,SACJ2B,EAAW1O,KAAI,SAAA6O,GAAS,OACvB,wBAAQ9B,UAAU,oBAAoBC,QAAS,wBAAM,EAAAF,EAAMiC,UAASF,EAAUtE,QAAzB,oBAAqCsE,EAAU3D,MAAQ,MAA5G,SAAmH2D,EAAU5R,YAKnI,SAASsQ,GAAKT,GACZ,OAAO,sBAAKC,UAAU,OAAf,UACL,qBAAKA,UAAU,mBAAf,SACE,qBAAKA,UAAU,SAASxB,IAAKuB,EAAM1P,WAErC,qBAAK2P,UAAU,aAAavB,MAAO,CAACqC,aAAwB5P,GAAf6O,EAAMvM,WAAoBtC,EAAU,QAAjF,cAA2GA,GAAf6O,EAAMvM,MAAqB+K,EAAOwB,EAAMvM,OAAS,QAIjJ,SAASyO,GAAclC,GACrB,OAAO,qBACLC,UAAY,iBACZvB,MAAS,CAACmC,OAA+B,GAAvBb,EAAMjN,KAAK+N,SAAkB,yBAAoB3P,GACnE+O,QAAWF,EAAMyB,YAHZ,SAKL,cAAChB,GAAD,eAAUT,EAAMjN,SAIpB,SAASoP,GAAQnC,GACf,OAAO,qBAAKC,UAAU,WAAf,SACJD,EAAMoC,MAAMlP,KAAI,SAACH,EAAMxB,GAAP,OAAe,cAAC2Q,GAAD,CAAenP,KAAMA,EAAM0O,YAAazB,EAAMqC,gBAAgB9Q,UAgBlG,SAAS+Q,GAAgB5R,EAAiBF,EAAUyO,GAClD,MAAe,SAAXzO,EAAEgH,OAC2B,GAA3B9G,EAAOuH,iBACSzH,EAAEgB,QAAQC,QAAQf,GAAUA,EAAOuH,iBAAmB,GACtDgH,EAAEhL,YAAwC,GAA1BvD,EAAOuH,gBAChC,qBAGA,CAAC,2BAAQ,2BAAQ,2BAAQ,4BAASvH,EAAOuH,iBAI3C,2BAILvH,EAAOsH,SACLtH,EAAOC,IACF,qBAGA,qBAIFD,EAAOG,SAASqC,KAAI,SAAAqP,GAAM,OHtKhC,SAAyBA,GAC9B,MAAqB,iBAAVA,EACF/D,EAAO+D,EAAO9O,OAEJ,UAAV8O,EACA5D,EAGAC,EG8JgC4D,CAAgBD,MAK3D,SAASE,GAAalR,EAAa0C,GACjC,IAAIyO,EAAOnR,EAAM0C,EACjB,OAAIyO,EAAO,EACF,EAAIA,EAGJA,EAaX,SAASC,GAAU3C,GACjB,IAzDsBf,EL/IG2D,EAAWC,EKiNpC,OAAO,sBAAK5C,UAAU,QAAf,UACL,cAACsB,GAAD,CACE/P,SLnNqBoR,EKmNF5C,EAAMxP,EAAEgB,QAAQ0B,KAAI,SAACxC,EAAQa,GAAT,OArB7C,SAAwBb,EAAiBa,EAAaf,EAAUyO,GAC9D,OAAO,2BACFvO,GADL,IAEEP,KAAM,CAAC,eAAM,eAAM,eAAM,gBAAMsS,GAAalR,EAAK0N,EAAEhL,aACnDmN,KAAMkB,GAAgB5R,EAAQF,EAAGyO,GACjC6B,SAAsB,UAAXtQ,EAAEgH,OAAuBjG,GAAOf,EAAE2K,oBAgBa2H,CAAepS,EAAQa,EAAKyO,EAAMxP,EAAGwP,EAAMf,MLnNnE4D,EKmNwE,EAAE7C,EAAMf,EAAEhL,WAAW,GAAG,GAAG+L,EAAMf,EAAEhL,WAAW,GAAG,GAAG+L,EAAMf,EAAEhL,WAAW,GAAG,EAAE+L,EAAMf,EAAEhL,YLlNzL4O,EAAQ3P,KAAI,SAAA3B,GAAG,OAAIqR,EAAKrR,SKoN7B,cAACiQ,GAAD,CAAW9L,IAAuB,SAAjBsK,EAAMxP,EAAEgH,MAAmBwI,EAAMf,EAAEvJ,IAAMsK,EAAMxP,EAAE+E,SAAS,GAAIkM,YAAa,kBAAMsB,MAAM/C,EAAMxP,EAAE+E,aAIhH,cAACmM,GAAD,CACEE,WAAc5C,EAAegB,EAAMxP,EAAGwP,EAAMf,GAC5CgD,SAAYjC,EAAMiC,SAClBzR,EAAKwP,EAAMxP,IAEb,cAAC2R,GAAD,CACEC,MAASpC,EAAMxP,EAAEgB,QAAQwO,EAAMf,EAAEhL,YAAYxB,KAAKS,KAhFhC+L,EAgFmDe,EAAMf,EA/ExE,SAAClM,EAAMxB,GAAP,mBAAC,eACHwB,GADE,IAEL+N,SAAU7B,EAAEC,eAAiB3N,OA8E3B8Q,gBAAmB,SAAA9Q,GAAG,OAAI,kBAAMyO,EAAMjF,QAAQyE,YAAYjO,EAAKyO,EAAMxP,EAAEgB,QAAQwO,EAAMf,EAAEhL,iBAEzF,cAAC8L,GAAD,CAAUM,UAAS,UAAK,2BAAOxN,KAAKC,MAAMkN,EAAMxP,EAAEiH,MAAM,KAArC,OAA2CuI,EAAMxP,EAAEiH,MAAQ,EAAI,EAA/D,UAAqE0I,UAAW,kBAAIH,EAAMjF,QAAQ4E,aAAa,cAAcS,MA1BnI,WACb,IAAIrB,EAAciB,EAAMf,EAAEF,YAAc,EACpCA,EAAc,GAAK,IACrBgE,MAAM,oCACN/C,EAAMhD,MAAMI,eAAevK,KAAKmQ,KAAKjE,EAAc,KAErDiB,EAAMjF,QAAQ6E,oBAwBlB,SAASqD,GAAKjD,GACZ,IAAI3M,EAAuC,GAAxB2M,EAAMpL,KAAKgB,UAAoB,yGAAyGsN,EAI3J,OAHIlD,EAAM1P,SACR+C,EAAc2M,EAAM1P,QAEf,sBAAK2P,UAAU,OAAf,UACL,qBAAKA,UAAU,wBAAwBvB,MAAO,CAACmC,OAASb,EAAMc,SAAU,yBAAoB3P,GAA5F,SACE,qBAAK8O,UAAU,cAAcxB,IAAKpL,MAEpC,qBAAK4M,UAAU,sBAAf,SAEE,sBAAKA,UAAU,YAAf,UACGD,EAAMpL,KAAKzE,KAAK,uBAChB6P,EAAMpL,KAAKxE,aAMpB,SAAS+S,GAAoB/S,GAC3B,IAAIgT,EAAoC,CAACC,EAAE7E,EAAO,GAAI8E,EAAE9E,EAAO,GAAI+E,EAAE/E,EAAO,IAC5E,OAAQpO,EAAgBoT,MAAM,IAAItQ,KAAI,SAAAuQ,GAAI,OAAIL,EAAcK,GAAML,EAAcK,GAAMA,KA0BxF,IAAMC,GAA0D,CAC9Df,aACAgB,UAzBF,SAAmB3D,GAGjB,OAAO,sBAAKC,UAAU,QAAf,UACL,sBAAKA,UAAU,kBAAf,UACGD,EAAMxP,EAAE2H,aAAanH,QAAO,SAAA4D,GAAI,OAAKA,EAAKK,eAAa/B,KAAI,SAAA0B,GAAI,OAAI,cAACqO,GAAD,CAAMrO,KAAM,CAACzE,KAAMyE,EAAKzE,KAAMC,KAAK+S,GAAoBvO,EAAKxE,MAAOwF,UAAUhB,EAAKgB,gBACrJoK,EAAMxP,EAAEgB,QAAQwO,EAAMf,EAAEhL,YAAYiE,MAAMhF,KAAI,SAAA0B,GAAI,OAAI,cAACqO,GAAD,CAAMrO,KAAM,CAACzE,KAAMyE,EAAKzE,KAAMC,KAAKwE,EAAKxE,KAAMwF,UAAUhB,EAAKgB,mBAEtH,wBAAQqK,UAAU,iBAAiBC,QAAS,kBAAMF,EAAMjF,QAAQ4E,aAAa,cAA7E,8BAkBFiE,WAdF,SAAoB5D,GAClB,OAAO,qBAAKC,UAAU,QAAf,SACL,qBAAKA,UAAU,kBAAf,SAGGD,EAAMxP,EAAEgB,QAAQ0B,KAAI,SAAAf,GAAC,sBAASA,MAAK+H,MAAK,SAACC,EAAEC,GAAH,OAAOA,EAAElJ,MAAMiJ,EAAEjJ,SAAOgC,KAAI,SAACxC,EAAQa,GAAT,OAAiB,cAAC0R,GAAD,CAAMrO,KAAM,CAACzE,KAAK,GAAD,OAAKoB,EAAI,EAAT,UAAenB,KAAK,GAAD,OAAKM,EAAOQ,MAAZ,WAAuBZ,OAAQI,EAAOJ,OAAQwQ,SAAUpQ,EAAOJ,QAAU0P,EAAMxP,EAAEgB,QAAQwO,EAAMf,EAAEhL,YAAY3D,kBAYtO,SAASuT,GAAM7D,GAA6B,IAAD,EAChC8D,mBAAiBjF,GADe,mBAC3CI,EAD2C,KACxC8E,EADwC,KAE5ChJ,EAAUlF,GACZ,SAAA4H,GAAM,OAAI,sCAAIW,EAAJ,yBAAIA,EAAJ,uBAAoB2F,EAAKC,aAAQ,SAAA/E,GAAC,OAAIxB,EAAM,WAAN,GAAOwB,GAAP,OAAab,WAC7DmB,GAEE0C,EAAWpM,GACb,SAAA4H,GAAM,OAAI,sCAAIW,EAAJ,yBAAIA,EAAJ,uBAAoBX,EAAM,WAAN,GAAOuC,EAAMhD,MAAOjC,GAApB,OAAgCqD,OAC9DyB,GAEGrP,EAAiBwP,EAAjBxP,EAAGC,EAAcuP,EAAdvP,IAAKuM,EAASgD,EAAThD,MACTiH,EAA0B,CAC5BzT,IAAGC,MAAKuM,QAAOiC,IAAGlE,UAASkH,YA0D7B,OAxCAH,qBAAU,WACO,SAAXtR,EAAEgH,OAA2C,GAAvBhH,EAAEqJ,WAAWjH,QACrCmI,EAAQ4E,aAAa,eAEtB,CAACnP,EAAEgH,QAENsK,qBAAU,WACRiC,EAAK,2BAAI9E,GAAL,IAAQhL,WAAYiQ,SAASlE,EAAMmE,UAAY,QACnD1O,QAAQC,IAAR,eAAgBsK,IAChBvK,QAAQC,IAAR,4BAAiCsK,EAAMmE,YACzBnE,EAAMmE,UAAYnE,EAAMxP,EAAEoM,KAAO,SACbzL,GAAlB6O,EAAMmE,YACpB1O,QAAQC,IAAI,oBACZsK,EAAMhD,MAAMC,eAAemH,WAE5B,IAKHtC,qBAAU,YACJ9B,EAAMxP,EAAEiH,OAAS,SAAkDtG,GAA5C6O,EAAMxP,EAAEgB,QAAQJ,MAAK,SAAAH,GAAC,OAAIA,EAAEC,OAAS,QAC9D6J,EAAQ4E,aAAa,gBAEtB,CAACK,EAAMxP,EAAEiH,QAEZqK,qBAAU,WACRrM,QAAQC,IAAI,cAAesK,EAAMxP,EAAE8G,YACF,GAA7B0I,EAAMxP,EAAEqJ,WAAWjH,QAAgC,SAAjBoN,EAAMxP,EAAEgH,QAC5C/B,QAAQC,IAAI,oBACZsM,YAAW,WACTC,EAASrI,WACTnE,QAAQC,IAAI,YACX,QAEJ,CAACsK,EAAMxP,EAAEqJ,WAAYmG,EAAMxP,EAAE8G,cAEeoM,GAAOzE,EAAEH,QAAU6D,IAGrDsB,G,UCpWFI,GAAc,SAACrE,GAAD,OACzB,qBAAKC,UAAU,QAAf,SACA,sBAAKA,UAAU,cAAf,UACE,qBAAKA,UAAU,sBAAf,SACE,qBAAKA,UAAU,YAAYxB,IAAKuB,EAAMsE,aAExC,oBAAIrE,UAAU,QAAd,SAAwBD,EAAMuE,QAC9B,sBAAK7F,MAAO,CAACqC,QAAUf,EAAMwE,YAAQrT,EAAY,QAAjD,2BACM,mBAAGsT,KAAK,8CAA8CxE,UAAU,UAAhE,yCAELD,EAAM4B,WAAW1O,KAAI,SAAA6O,GAAS,OAAI,iCAAM,wBAAQ9B,UAAU,8BAA8BC,QAAS6B,EAAUxR,OAAnE,SAA4EwR,EAAU5R,OAAc,mC,SCnBpIiD,I,MACb,CAAC,CAAC,eAAM,0EACR,CAAC,qBAAO,mFACR,CAAC,SAAK,iEACN,CAAC,eAAM,0EACP,CAAC,mCAAW,2GACZ,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,2BAAQ,4FACT,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,SAAK,iEACN,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,2BAAQ,4FACT,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,IAAK,yDACN,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,UAAW,+DACZ,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,SAAK,iEACN,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,SAAK,iEACN,CAAC,SAAK,iEACN,CAAC,SAAK,iEACN,CAAC,eAAM,0EACP,CAAC,SAAK,iEACN,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,2BAAQ,4FACT,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,SAAK,iEACN,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,SAAK,iEACN,CAAC,2BAAQ,4FACT,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,SAAK,iEACN,CAAC,qBAAO,mFACR,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,qBAAO,mFACR,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,2BAAQ,4FACT,CAAC,2BAAQ,4FACT,CAAC,2BAAQ,4FACT,CAAC,2BAAQ,4FACT,CAAC,qBAAO,mFACR,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,SAAK,iEACN,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,2BAAQ,4FACT,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,SAAK,iEACN,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,2BAAQ,4FACT,CAAC,qBAAO,mFACR,CAAC,qBAAO,mFACR,CAAC,2BAAQ,4FACT,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,SAAK,iEACN,CAAC,eAAM,0EACP,CAAC,2BAAQ,4FACT,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,2BAAQ,4FACT,CAAC,qBAAO,mFACR,CAAC,eAAM,0EACP,CAAC,eAAM,0EACP,CAAC,2BAAQ,4FACT,CAAC,qBAAO,mFACR,CAAC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","file":"static/js/main.759ef273.chunk.js","sourcesContent":["import React from 'react';\nimport { ICard } from './types';\nimport { move, out, log_msg, add_fruits, flip_card } from './Game';\n\nexport const CARDS: ICard[] = [\n  {\n    name: \"炸弹\",\n    desc: \"嘣！\",\n    effect_type: \"aggressive\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/emojidex/112/bomb_1f4a3.png\",\n    effect(G, ctx, player) {\n      out(player);\n    },\n  },\n  {\n    name: \"护甲\",\n    desc: \"放入持续区，可抵挡1次出局\",\n    effect_type: \"protective\",\n    has_fruit: true,\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/259/shield_1f6e1.png\",\n    effect(G, ctx, player) {\n      player.entities.push(\"shield\");\n    },\n  },\n  {\n    name: \"吉他\",\n    desc: \"如果你的鞋子未使用，则横置鞋子，获得2分，否则重置鞋子\",\n    effect_type: \"greedy\",\n    has_fruit: true,\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/322/guitar_1f3b8.png\",\n    effect(G, ctx, player) {\n      // player.score += 1;\n      if (player.entities.includes(\"skip\")) {\n        player.entities = player.entities.filter(x => (x !== \"skip\"));\n        player.score += 2;\n      }\n      else {\n        player.entities.push(\"skip\");\n      }\n    },\n  },\n{\n    name: \"美味佳肴\",\n    desc: \"如果你至少有6分，则失去1分，否则获得1分\",\n    // has_fruit: true,\n    effect_type: \"topdown\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/282/pile-of-poo_1f4a9.png\",\n    effect(G, ctx, player) {\n      if (player.score >= 6) {player.score -= 1;}\n      else {player.score += 1;}\n    },\n  },\n\n{\n    name: \"搋子\",\n    desc: \"如果你至少有6分，则失去2分，否则获得2分\",\n    // has_fruit: true,\n    effect_type: \"topdown\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/322/plunger_1faa0.png\",\n    effect(G, ctx, player) {\n      if (player.score >= 6) {player.score -= 2;}\n      else {player.score += 2;}\n    },\n  },\n\n{\n    name: \"三屎\",\n    desc: \"如果你至少有6分，则失去2分，否则获得2分\",\n    // has_fruit: true,\n    effect_type: \"topdown\",\n    illust: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAMAAABiM0N1AAAAwFBMVEVHcEzQJTt8iZO+GTHdLkS+GTHdLkTdLkS+GTFmdX/dLkS+GTHM1t3M1t1mdX/M1t3dNErM1t3TJz7M1t2+GTFmdX9mdX/XKkDdLkTM1t2+GTHM1t1mdX9mdX/M1t2+GTHM1t3M1t2Zpq7ZU2bdLkRmdX9mdX/dLkTM1t1mdX/dLkS+GTGZqrV0g42Xp7GGlaCzvsaPnqiAjpjVgpFtfIfOx8+jr7fGHjbSl6S/ytHRJjzaTWC5xMvXbX3Pt8B8jJdXLlKbAAAAKHRSTlMAEBBAQIKAv8LCj+PDn4Dv+YUgQK9rQDBwUGwwn68gUN9ggI/f7zDPwwvGZwAAActJREFUeF7t19eSgjAUgGEQEQR7WV3X7S2h2svW93+rRYzECGbkJN7s+N/7jXNISFDO3KVC+6nWLYgqN80KWmCMy0LSdbWOEPrCm26FlLgJjrsCKXfNB0Ra421DAPNYQbQxJhVy/5k62s/HpG6+p1RlFDLq3ONuV9BhiwR6hTC0ECe9nTibKspqhvGJQ1KLxWK/VHpGma0xbXjkp5ZhGA1n1082NMK0MgF69Kfppii7AO8VM6rlcPpkgfRypEvy3eG1ShPMRqPbrcR1GnMe5M8o1HK4faNjRcDYC4hUUxSLD604kO95XphAL3xozoHCCAp2UI/vNCiQ3rKBF+WTbdvnQ59HoRGeeZsmZEVagFkTyI+hkEAGH5pyoN8YGotDk38K0RlJfmrS1pG0lS2+12TvfmnvI3lvyChDxjtb2iki8Vyj6a7rLpfLj20O4KRNICYzOfvrOc/+Dgtp4NuIyTg2/H5kM5AOv7G5TBr4DqmyEPxWq7Ejgt+zWciE3/x1FgJ+i6Qh+NdRh4Xg32smC8G/IO0UBMxlssGO6rKBIe0A0mRBA1lQBw5JmnaLAOLP3xSYEXf3wxvsO6oi0L1NGFsnDpzSowY95Rxd+gM9kbO827m8HwAAAABJRU5ErkJggg==\",\n    effect(G, ctx, player) {\n      if (player.score >= 6) {player.score -= 3;}\n      else {player.score += 3;}\n    },\n  },\n\n{\n    name: \"猴子\",\n    desc: \"如果你没有水果，则获得3分\",\n    has_fruit: true,\n    effect_type: \"greedy\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/322/fish_1f41f.png\",\n    effect(G, ctx, player) {\n      let fruit = player.entities.find(x => typeof x == \"object\");\n      if (fruit === undefined) {\n        player.score += 3;\n      }\n    },\n  },\n\n{\n    name: \"裸奔\",\n    desc: \"弃掉持续区的所有牌\",\n    // has_fruit: true,\n    effect_type: \"topdown\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/263/man-running_1f3c3-200d-2642-fe0f.png\",\n    effect(G, ctx, player) {\n      player.entities = [];\n    },\n  },\n\n{\n    name: \"马桶\",\n    desc: \"如果你的弃牌堆中，有炸弹或粪便，则获得2分\",\n    has_fruit: true,\n    effect_type: \"greedy\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/322/toilet_1f6bd.png\",\n    effect(G, ctx, player) {\n      // player.entities = [];\n      let bad_card = player.discard.find(c => (c.name === \"炸弹\" || c.name === \"美味佳肴\"));\n      if (bad_card !== undefined) {\n        player.score += 2;\n      }\n    },\n  },\n\n  {\n    name: \"送温暖\",\n    desc: \"你的上家和下家获得1分(如果存活的话)\",\n    effect_type: \"greedy\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/271/pot-of-food_1f372.png\",\n    effect(G, ctx, player) {\n      let idx = G.players.indexOf(player);\n      let upper_idx = (idx + 1) % 4;\n      let lower_idx = (idx + 3) % 4;\n      let upper_player = G.players[upper_idx];\n      let lower_player = G.players[lower_idx];\n      if (!upper_player.out) {\n        upper_player.score += 1;\n      }\n      if (!lower_player.out) {\n        lower_player.score += 1;\n      }\n    }\n  },\n  {\n    name: \"乌龟\",\n    desc: \"本回合如果你存活到最后，则获得2分\",\n    effect_type: \"greedy\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/322/turtle_1f422.png\",\n    has_fruit: true,\n    effect(G, ctx, player) {\n      player.survive_bonus += 2;\n    }\n  },\n  {\n    name: \"闪电\",\n    desc: \"本回合公共目标分值+2\",\n    effect_type: \"greedy\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/322/high-voltage_26a1.png\",\n    has_fruit: false,\n    effect(G, ctx, player) {\n      G.public_goal_bonus += 2;\n    }\n  },\n\n  // {\n  //   name: \"礼物\",\n  //   desc: \"如果你因为炸弹出局，获得2分\",\n  //   effect_type: \"greedy\",\n  //   has_fruit: true,\n  //   illust: \"\",\n  //   effect(G, ctx, player) {\n  //     player.entities.push(\"gift\");\n  //   }\n  // },\n\n  {\n    name: \"披萨\",\n    desc: \"本回合剩余时间内，你每获得1个水果，就获得1分\",\n    effect_type: \"greedy\",\n    has_fruit: true,\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/322/pizza_1f355.png\",\n    effect(G, ctx, player) {\n      player.fruit_bonus += 1;\n    }\n  },\n\n  {\n    name: \"西红柿\",\n    desc: \"将2个西红柿放入持续区\",\n    // effect_type: \"greedy\",\n    super_fruit: 0,\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/263/tomato_1f345.png\",\n    effect(G, ctx, player) {\n      // for (let i=0; i<2; i++){\n        // player.entities.push({fruit: 0});\n        // add_fruits(G, ctx, player, [2,0,0]);\n      // }\n      player.score += 1;\n    }\n  },\n{\n    name: \"柠檬\",\n    desc: \"将2个柠檬放入持续区\",\n    // effect_type: \"greedy\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/263/lemon_1f34b.png\",\n    super_fruit: 1,\n    effect(G, ctx, player) {\n      // for (let i=0; i<2; i++){\n        // player.entities.push({fruit: 1});\n        // add_fruits(G, ctx, player, [0,2,0]);\n      // }\n      player.score += 1;\n    }\n  },\n{\n    name: \"苹果\",\n    desc: \"将2个苹果放入持续区\",\n    // effect_type: \"greedy\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/263/green-apple_1f34f.png\",\n    super_fruit: 2,\n    effect(G, ctx, player) {\n      // for (let i=0; i<2; i++){\n      //   player.entities.push({fruit: 2});\n      // }\n      // add_fruits(G, ctx, player, [0,0,2]);\n      player.score += 1;\n    }\n  },\n\n\n\n  {\n    name: \"集体拆弹\",\n    desc: \"所有其他玩家查看牌库顶的1张牌，如果是炸弹则弃掉，然后每有1个弃掉炸弹的玩家，你就获得2分\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/271/cityscape-at-dusk_1f306.png\",\n    effect(G, ctx, player) {\n      let other_players = G.players.filter(x => x != player && !x.out);\n      for (let p of other_players) {\n        // let flipped = flip_card(p);\n        let top_card = p.deck[0];\n        if (top_card && top_card.name == \"炸弹\") {\n          move(p.deck, p.discard);\n          player.score += 2;\n        }\n      }\n    }\n  },\n  {\n    name: \"集体引爆\",\n    desc: \"所有其他玩家弃掉牌库顶的1张牌，弃掉炸弹的玩家出局，然后每有1个因此出局的玩家，就失去2分\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/271/collision_1f4a5.png\",\n    effect(G, ctx, player) {\n      let other_players = G.players.filter(x => x != player && !x.out);\n      for (let p of other_players) {\n        let flipped = flip_card(p);\n        if (flipped && flipped.name == \"炸弹\") {\n          out(p);\n          player.score -= 2;\n        }\n      }\n    }\n  },\n  {\n    name: \"集体存档\",\n    desc: \"所有其他玩家存档1张牌\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/271/night-with-stars_1f303.png\",\n    effect_type: \"protective\",\n    effect(G, ctx, player) {\n      let other_players = G.players.filter(x => x != player && !x.out);\n      for (let p of other_players) {\n        move(p.deck, p.hand);\n      }\n    }\n  },\n  {\n    name: \"鞋子\",\n    desc: \"获得1次跳过机会\",\n    has_fruit: true,\n    effect_type: \"protective\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/259/running-shoe_1f45f.png\",\n    effect(G, ctx, player) {\n      player.entities.push(\"skip\");\n    }\n  },\n{\n    name: \"存档\",\n    desc: \"存档1张牌\",\n    has_fruit: true,\n    effect_type: \"protective\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/whatsapp/273/floppy-disk_1f4be.png\",\n    effect(G, ctx, player) {\n      move(player.deck, player.hand);\n    },\n  },\n{\n    name: \"大存档\",\n    desc: \"存档2张牌\",\n    has_fruit: true,\n    effect_type: \"protective\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/322/package_1f4e6.png\",\n    effect(G, ctx, player) {\n      move(player.deck, player.hand);\n      move(player.deck, player.hand);\n    },\n  },\n\n{\n    name: \"天妇罗\",\n    desc: \"如果这是你本回合第1/2/3次执行此效果，则获得1/3/5分\",\n    has_fruit: true,\n    effect_type: \"greedy\",\n    illust: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAMAAABiM0N1AAAAvVBMVEVHcEz/rDP/rDP/rDP+qC3/rDP/rDP/rDL/rDP+qS//g5v/g5v/rDP/rDP/qzH/g5v/rDP2kxD/g5v/rDP8fJT/g5v7e5L3c4r9fZX1kQ3/g5v/g5v8oyf/g5v/g5v/g5vsXXL0kAzqWW7/hZf2lBH1kQ3/mWPqWW79qC3qWW7qWW71kg/0kAz/rDP0kAz+qi/3mBb9pir2lRL6nyD8oiX5mxv/g5vqWW7/k3HuYHXza4H8fZT/qDz/iov/oFNjMuL6AAAALXRSTlMAgCAwEO+fv0Bgv0CPz3CA3yCvr3AwEPwg75tgUO9Q3+97QM9A188w36/Pv5837ex5AAACvElEQVR4XqWX53qiQBRAAUVqsRuNqWX7DNWa7L7/Yy0wuoFpd2DPL03kfHduA7QrC8/zbrT/ZRnd7QmuG0We19dz87CncafRrbfsKnL3Au7cTXS/UA9oD/Ayje5V8uftVfjiDyDRQkn0G6Gxb4A5gjmiipEtDWml5CHMZFF9fXxX8hB0WUd+P63epQlqEsjSPj8cTmeh7A9qYTpi0fOh5sRXfSAKX9iUjxfRngtiGAniIZ7TGTgaZHommhVQNNj0owpG2gGIQ8iKDucV3EcsbJdzBO4mmnvePJo+iEMyh7SIWmzTeXMHeZuX4/ED8ZjRovtmKLfsYnSQgC1tur3u7A21wADTN+Zwy/nUdadzSgOa0ietK37MFa2HnU0/C54Idw9psuaYctwjpCdccETY0TrzxpoSjN/kAlsfWRW+Y3xWDuO07YlxyURsGYxM9Mk4vKZhjXFMnawkFGkMi5kpnah+YZwxAeWWwKMjDuN63W+r6xqeDNdmrmY4Q3yq4kxwSdzyJOVXm+cJEJKYKlHSqFhWiO5zJB6hCVekV1FSsMuEzQ+LOSCiBFGw2baRlGCCa5jxZUSBXBRbRLSDRA4CKIgoo0UDSjRGEAkxpZTI5mcIDimXi0YIhogSuWiMYHa8JOWv7ZFHSPlsrVru8CtdM5iY6aQ0ozeSjlTI2mWL67NqLSwlUUJETQ1e9xHlDVFch5cUVn9RTERJkhflR7+/iNovfUQ7Th8ZvZLNdvaYsxxhOLPms9sRJiW5li6Rbc8UBRrFUHlCCqpmNIFiqjMq1Qyh4hJJgYA0Q81TALcicEXGCcdjUs0IhUQGnXjYg7H4Qk1GNAnpIPDtdmgK4ylNyS6GXrTU70iC2ejTAvALMlw54JW9l8nUNRDHVNAMNQUMCzhUSDQK2GKVFQ60LhihZTKOkW5r/TDsf4Bx/AWDNjng5jqHSQAAAABJRU5ErkJggg==\",\n    effect(G, ctx, player) {\n      if (player.has_tempura === true) {\n        player.score += 3;\n      }\n      else {\n        player.score += 1;\n        player.has_tempura = true;\n      }\n    },\n  },\n\n{\n    name: \"汉堡\",\n    desc: \"你的弃牌堆中每有2张牌，就获得1分\",\n    has_fruit: true,\n    effect_type: \"greedy\",\n    illust: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAMAAABiM0N1AAAAvVBMVEVHcEzcoX/ZnoLZnoLZnoLZnoLal37JkHPZnoLZnoLHp3TZnoLdLkT/zE3/zE1mIRPdLkRmIRN3slWNtlR3slV3slWndE3ZnoJ3slWqblBmIRN/PCXdLkS9gGfcYF/TlnvaQ0+RkVHxx025v1GCtFX/zE3wyaHFTkjhro2XuVOhYilvKxf53K721qnou5fdpYfXi3bTxFD/6LaQTzCdXUi9V0m8gTTbf3Hps0SahU+EolPGjDfRmTunvFK3YErYlgAPAAAAF3RSTlMAX++PeKdHGL/fM89Axq+/70Cfx2Bw770Z5hUAAANJSURBVHhe1ZjXmpswEEbBdHtbsklE7+69bS3v/1iRV4gxCBkMXy5yLvVZR/8IZnds4d+jqbKk6yhH1yVZ1a6U9GWlhyrpKXK/sUUy0EUMqYFLk8FyySVrNZoeR7Ae7RaTQo2XVCLVsJ4dZlm6LpEXRyeCyYIeDix3J8p6XePEgU2LdVG0OHlGCOCHkoqnr8pXtFyusJzJLJU9CmwawX0wsJkVJg8wwcdP+BrIzGYSEZf1hFbEyyyCR+txPSu8haTjZu5BA+rcs9ECzuaiU49KTqk6e0Ieew0qBMrOHrEi0NdG0mDLkm0N0mI1kFuS81vdrSoeGmqATN5Fmoj78vD/IuzWZ2+lgdoxgRqMbxFqyejsQbQVQaMgvgj6m7sKpa0YEb+/+avrVW6Fy+b3N38VMODx8/ubvwoo0Grc/q5fhWYboI4MoPu7AN1/43fz+DdU5Iab9pogdEHkun7QUuO7bkGEVS1SbU4aEGkP7jeh/3yFbPPsh2TfAx0nflsuEIa+7z9jNtW7MfgDYegCf/rE89M0wdQCyzR/EQ8mGrfVjCMTg019kxAd22iOkUnQBO3RzHh7/QqvkYRfr3Rr+ohLu4sT0wSZdWxQ5fhovb6ZlHQ7vMOi2+FwaxZ5iyLLssYnzjafwMtRZJaIh8PbU6IhNk3TdJokyWdqNub781Mz/YyHRNTHkYCkTgDlnHErCpgfzuzjahN44vfZ/AfpENu25+Ca5tmn5RSwkmSWlyfHxmQ9YmPAFX+bpqfocXKuISsp8VALQSDcE1PuipNtTHOneT66tN1u48xCuScezaKiYo2Qj2aAVWKhWNlYE8yJJHe9nKu2aVYo3O7eLjAP5Gxgg0iMi+FjNrdLWNnI1kPIsRmcpwrXy6zqkwj16BARYBPL/h0UUBLjCWCIABO/RCiJ9YAIc7CrmT/FWEOfEsOBGWvWnsNTzWgYBsdDhOK/fm9vX8WeatCgPNZsLKepxbE2l8eawDrUypyDFZSmCM7I5nmHvVPhc5z9wfNQGaP+21rg5QSIiwhfszqhCxSt08w20ISuJvCASWnrUYgHUI02GkMVWMSr6xuIzX456vQrkiZKer1El0RNaEBflWVF15l4hq4rsqz2hf+Cv/n/ttGvGGfQAAAAAElFTkSuQmCC\",\n    effect(G, ctx, player) {\n      let len = player.discard.length;\n      player.score += Math.floor(len / 2);\n    },\n  },\n\n{\n    name: \"照相机\",\n    // desc: \"获得1分，场上每有1个已出局的玩家，就再得1分\",\n    desc: \"如果场上有已出局的玩家，获得2分\",\n    has_fruit: true,\n    effect_type: \"greedy\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/322/camera_1f4f7.png\",\n    effect(G, ctx, player) {\n      // let idx = G.players.indexOf(player);\n      // let upper_idx = (idx + 1) % 4;\n      // let lower_idx = (idx + 3) % 4;\n      // let upper_player = G.players[upper_idx];\n      // let lower_player = G.players[lower_idx];\n      // if (upper_player.out === true) {\n      //   player.score += 2;\n      // }\n      // if (lower_player.out === true) {\n      //   player.score += 2;\n      // }\n      // player.score += 1 + G.players.filter(p => p.out).length;\n      player.score += G.players.filter(p => p.out).length > 0? 2 : 0;\n    },\n  },\n{\n    name: \"苍蝇\",\n    desc: \"如果你拥有水果，则失去3分，否则获得1分\",\n    has_fruit: false,\n    effect_type: \"topdown\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/322/fly_1fab0.png\",\n    effect(G, ctx, player) {\n      let fruit = player.entities.find(x => typeof x == \"object\");\n      if (fruit != undefined) {\n        player.score -= 2;\n      }\n      else {\n        player.score += 1;\n      }\n    },\n  },\n\n{\n    name: \"上传\",\n    desc: \"如果你的存档中有牌，则获得2分\",\n    has_fruit: true,\n    effect_type: \"greedy\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/282/cloud_2601-fe0f.png\",\n    effect(G, ctx, player) {\n      if (player.hand.length > 0) {\n        player.score += 2;\n      }\n      // else {\n        // move(player.deck, player.hand);\n        // move(player.deck, player.hand);\n      // }\n    },\n  },\n\n{\n    name: \"加速\",\n    desc: \"弃掉牌堆顶的1张牌，并执行其2次\",\n    has_fruit: true,\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/271/racing-car_1f3ce-fe0f.png\",\n    effect(G, ctx, player) {\n      let card = move(player.deck, player.discard);\n      if (card != undefined && card.effect != undefined) {\n        log_msg(G, ctx, <span>执行了 {card.name} 两次</span>);\n        card.effect(G, ctx, player);\n        card.effect(G, ctx, player);\n      }\n    },\n  },\n  {\n    name: \"拆弹\",\n    desc: \"查看牌堆顶的1张牌，如果是炸弹，将其弃掉并获得2分\",\n    has_fruit: true,\n    effect_type: \"protective\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/263/wrench_1f527.png\",\n    effect(G, ctx, player) {\n      let card = player.deck[0];\n      if (card != undefined) {\n        log_msg(G, ctx, <span>使用拆弹翻开 {card.name}</span>);\n        if (card.name == \"炸弹\") {\n          move(player.deck, player.discard);\n          player.score += 2;\n        }\n        else {\n          return;\n        }\n      }\n    }\n  },\n  {\n    name: \"引爆\",\n    desc: \"如果你至少有6分，直接出局，否则获得1分\",\n    effect_type: \"aggressive\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/271/fire_1f525.png\",\n    effect(G, ctx, player) {\n      // let discarded = G.deck.slice(0, 2);\n      // player.deck = player.deck.slice(2);\n      // player.discard = [...discarded, ...player.discard];\n      // // log_msg(G, ctx, <span>因为引爆弃掉了 {discarded.map(x => <span>{x.name} </span>)}</span>);\n      // if (discarded.map(x => x.name).includes(\"炸弹\")) {\n      //   out(player);\n      // }\n      // else {\n      //   player.score += 2;\n      // }\n      if (player.score >= 6) {\n        out(player);\n      }\n      else {\n        player.score += 1;\n      }\n    }\n  },\n\n  {\n    name: \"机会\",\n    desc: \"将2张山牌放到牌库顶\",\n    effect_type: \"topdown\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/271/game-die_1f3b2.png\",\n    effect(G, ctx, player) {\n      player.deck = [...G.deck.slice(0,2), ...player.deck];\n      G.deck = G.deck.slice(2);\n    }\n  },\n\n  {\n    name: \"观星\",\n    desc: \"查看牌库顶的2张牌\",\n    effect_type: \"protective\",\n    has_fruit: true,\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/282/magnifying-glass-tilted-left_1f50d.png\",\n    effect(G, ctx, player) {\n      // player.deck = [...G.deck.slice(0,2), ...player.deck];\n      // G.deck = G.deck.slice(2);\n      let top_cards = player.deck.slice(0,2);\n      // if (G.ai_players.includes(G.players.indexOf(player))) {\n      if (top_cards.map((card: ICard) => card.name).includes(\"炸弹\")) {\n        if (player.entities.includes(\"skip\")) {\n          let skip_idx = player.entities.indexOf(\"skip\");\n          player.entities[skip_idx] = \"shield\";\n        }\n      }\n      // }\n  }\n},\n\n  {\n    name: \"果汁\",\n    desc: \"如果你拥有水果，则获得2分\",\n    effect_type: \"greedy\",\n    illust: \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/271/cup-with-straw_1f964.png\",\n    has_fruit: true,\n    effect(G, ctx, player) {\n      let fruit = player.entities.find(x => typeof x == \"object\");\n      if (fruit != undefined) {\n        player.score += 2;\n      }\n    }\n  },\n\n];","export const AVATARS = [\n\"https://s1.ax1x.com/2020/11/08/BI5SKA.png\",\n\"https://s1.ax1x.com/2020/11/08/BI5pDI.png\",\n\"https://s1.ax1x.com/2020/11/08/BI4xvd.png\",\n\"https://s1.ax1x.com/2020/11/08/BI4j8e.png\",\n\"https://s1.ax1x.com/2020/11/08/BI4vgH.png\",\n\"https://s1.ax1x.com/2020/11/08/BI59bt.png\",\n\"https://s1.ax1x.com/2020/11/08/BI5PVP.png\",\n\"https://s1.ax1x.com/2020/11/08/BI5iUf.png\",\n\"https://s1.ax1x.com/2020/11/08/BI5F58.png\",\n\"https://s1.ax1x.com/2020/11/08/BI5APS.png\",\n];\n\nexport const goal_illust = \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/263/beer-mug_1f37a.png\";\n\nexport const public_goal_illust = \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/263/green-salad_1f957.png\";","import { Ctx } from 'boardgame.io';\nimport React from 'react';\nimport { goal_illust, public_goal_illust } from './assets';\nimport { FRUITS } from './icons';\nimport { ICard, IGame, IPlayer } from './types';\n\nfunction score_based_on_fruit(player: IPlayer, fruit_idx: number) {\n  let num_fruit = player.entities.filter(x => ((typeof x == \"object\") && (x.fruit == fruit_idx))).length;\n  if (num_fruit >= 4) {\n    player.score += 7;\n  }\n  else if (num_fruit == 3) {\n    player.score += 5;\n  }\n  // else if (num_fruit == 2) {\n  //   player.score += 2;\n  // }\n  // else {\n  //   return;\n  // }\n  else if (num_fruit == 2) {\n    player.score += 3;\n  }\n}\n\nfunction process_goal(goal: ICard): ICard {\n  return {\n    ...goal,\n    is_goal: true,\n    illust: goal_illust,\n  };\n}\n\nfunction process_public_goal(goal: ICard): ICard {\n  return {\n    ...goal,\n    is_goal: true,\n    is_public: true,\n    illust: public_goal_illust,\n  };\n}\n\nexport const goals_raw: ICard[] = [\n  // HACK: add personal goal bonus to every goal\n  {\n    name: \"目标: 击杀上家\",\n    desc: \"如果上家已经出局，则获得3分\",\n    stackable: true,\n    aggressive_goal: 3,\n    effect(G, ctx, player) {\n      let player_idx = G.players.indexOf(player);\n      let target_idx = (player_idx + 3) % 4;\n      let target = G.players[target_idx];\n\n      if (target.out == true) {\n        player.score += 3 + player.goal_bonus;\n      }\n    }\n  },\n{\n    name: \"目标: 击杀下家\",\n    desc: \"如果下家已经出局，则获得3分\",\n    stackable: true,\n    aggressive_goal: 1,\n    effect(G, ctx, player) {\n      let player_idx = G.players.indexOf(player);\n      let target_idx = (player_idx + 1) % 4;\n      let target = G.players[target_idx];\n\n      if (target.out == true) {\n        player.score += 3 + player.goal_bonus;\n      }\n    }\n  },\n\n{\n    name: \"目标: 搞左搞右\",\n    desc: \"上家和下家每有一个出局的得2分\",\n    aggressive_goal: 1,\n    protective_goal: 3,\n    // stackable: true,\n    effect(G, ctx, player) {\n      let player_idx = G.players.indexOf(player);\n      let protect_target = G.players[(player_idx + 3) % 4];\n      let eliminate_target = G.players[(player_idx + 1) % 4];\n\n      if (protect_target.out === true) {\n        player.score += 2;\n      }\n\n      if (eliminate_target.out === true) {\n        player.score += 2;\n      }\n      // if (protect_target.out === true && eliminate_target.out === true) {\n        // player.score += 5 + player.goal_bonus;\n      // }\n      // let num_out_players = G.players.filter(p => p.out).length;\n      // player.score += 2 * num_out_players;\n    }\n  },\n\n// {\n//     name: \"目标: 全场乱搞\",\n//     desc: \"每有1个已出局的玩家就获得2分\",\n//     aggressive_goal: 1,\n//     // stackable: true,\n//     effect(G, ctx, player) {\n//       let player_idx = G.players.indexOf(player);\n//       // let protect_target = G.players[(player_idx + 3) % 4];\n//       // let eliminate_target = G.players[(player_idx + 1) % 4];\n\n//       // if (protect_target.out === true && eliminate_target.out === true) {\n//         // player.score += 5 + player.goal_bonus;\n//       // }\n//       let num_out_players = G.players.filter(p => p.out).length;\n//       player.score += 2 * num_out_players;\n//     }\n//   },\n// {\n//     name: \"目标: 保下搞上\",\n//     desc: \"如果下家依然存活且上家被击杀，则获得5分\",\n//     aggressive_goal: 3,\n//     // protective_goal: 1,\n//     effect(G, ctx, player) {\n//       let player_idx = G.players.indexOf(player);\n//       let protect_target = G.players[(player_idx + 1) % 4];\n//       let eliminate_target = G.players[(player_idx + 3) % 4];\n\n//       if (protect_target.out != true && eliminate_target.out == true) {\n//         player.score += 5;\n//       }\n//     }\n//   },\n  // {\n  //   name: \"目标: 保护下家\",\n  //   desc: \"如果下家依然存活，则获得2分，否则失去1分\",\n  //   effect(G, ctx, player) {\n  //     let player_idx = G.players.indexOf(player);\n  //     let target_idx = (player_idx + 1) % 4;\n  //     let target = G.players[target_idx];\n  //     if (target.out != true) {\n  //       player.score += 2;\n  //     }\n  //     else {\n  //       player.score -= 1;\n  //     }\n  //   }\n  // },\n  // {\n  //   name: \"目标: 保护上家\",\n  //   desc: \"如果上家依然存活，则获得2分，否则失去1分\",\n  //   effect(G, ctx, player) {\n  //     let player_idx = G.players.indexOf(player);\n  //     let target_idx = (player_idx + 3) % 4;\n  //     let target = G.players[target_idx];\n  //     if (target.out != true) {\n  //       player.score += 2;\n  //     }\n  //     else {\n  //       player.score -= 1;\n  //     }\n  //   }\n  // },\n  {\n    name: \"目标: 西红柿\",\n    // desc: <span>如果你拥有2/3/4个{FRUITS[0]}，则获得2/4/7分</span>,\n    desc: \"如果你拥有2个西红柿，则获得3分\",\n    greedy_goal: 0,\n    effect(G, ctx, player) {\n      score_based_on_fruit(player, 0);\n    }\n  },\n{\n    name: \"目标: 柠檬\",\n    // desc: <span>如果你拥有2/3/4个{FRUITS[1]}，则获得2/4/7分</span>,\n    desc: \"如果你拥有2个柠檬，则获得3分\",\n    greedy_goal: 1,\n    effect(G, ctx, player) {\n      score_based_on_fruit(player, 1);\n    }\n  },\n{\n    name: \"目标: 青苹果\",\n    // desc: <span>如果你拥有2/3/4个{FRUITS[2]}，则获得2/4/7分</span>,\n    desc: \"如果你拥有2个苹果，则获得3分\",\n    greedy_goal: 2,\n    effect(G, ctx, player) {\n      score_based_on_fruit(player, 2);\n    }\n  },\n  // {\n  //   name: \"目标: 多种水果\",\n  //   desc: \"如果你拥有3种不同的水果，则获得5分\",\n  //   effect(G, ctx, player) {\n  //     let fruits = player.entities.filter(e => (typeof e === \"object\"));\n  //     let kinds_of_fruits = new Set(fruits);\n  //     if (kinds_of_fruits.size == 3) {\n  //       player.score += 5;\n  //   }}\n  // },\n{\n    name: \"目标: 多种水果\",\n    desc: \"你每有1种水果，就获得2分\",\n    effect(G, ctx, player) {\n      let fruits = player.entities.filter(e => (typeof e === \"object\"));\n      let kinds_of_fruits = new Set(fruits);\n      player.score += kinds_of_fruits.size * 2;\n    }\n  },\n  {\n    name: \"目标: 多个水果\",\n    desc: \"如果你至少有3个水果，则获得4分\",\n    effect(G, ctx, player) {\n      let fruits = player.entities.filter(e => (typeof e === \"object\"));\n      // let kinds_of_fruits = new Set(fruits);\n      player.score += fruits.length >= 3? 4 : 0;\n    }\n  },\n  {\n    name: \"目标: 存档\",\n    desc: \"你的存档中每有1张牌，就获得2分\",\n    target_cards: [\"存档\", \"大存档\"],\n    effect(G, ctx, player) {\n      let num_archives = player.hand.length;\n      player.score += num_archives * 2;\n      // if (num_archives > 0) player.score += player.goal_bonus;\n      // if (num_archives == 1) {\n      //   player.score += 2;\n      // }\n      // else if (num_archives >= 2) {\n      //   player.score += 5;\n      // }\n      // else {\n      //   return;\n      // }\n    }\n  },\n  // {\n  //   name: \"目标: 美味佳肴\",\n  //   desc: \"如果你的弃牌堆中有带\\\"美味佳肴\\\"的牌，就获得3分\",\n  //   target_cards: [\"美味佳肴\"],\n  //   effect(G, ctx, player) {\n  //     // let card = player.discard.find(x => [\"引爆\", \"美味佳肴\"].includes(x.name));\n  //     let card_num = player.discard.filter(x => [\"美味佳肴\", \"炸弹屎\", \"三重屎\"].includes(x.name)).length;\n  //     // if (card != undefined) {\n  //       // player.score += 3;\n  //     // }\n  //     // player.score += card_num * 2;\n  //     if (card_num >= 1) {\n  //       player.score += 3 * card_num + player.goal_bonus;\n  //     }\n  //   }\n  // },\n  // {\n  //   name: \"目标: 机会\",\n  //   desc: \"如果你的弃牌堆中有\\\"机会\\\"，则获得2分\",\n  //   effect(G, ctx, player) {\n  //     let card = player.discard.find(x => x.name == \"机会\");\n  //     if (card != undefined) {\n  //       player.score += 2;\n  //     }\n  //   }\n  // },\n  // {\n  //   name: \"目标: 险中求胜\",\n  //   desc: \"你的弃牌堆中每有1个\\\"炸弹\\\"，就获得2分\",\n  //   target_cards: [\"护甲\", \"观星\"],\n  //   effect(G, ctx, player) {\n  //     let booms = player.discard.filter(x => x.name == \"炸弹\");\n  //     player.score += 2 * booms.length;\n  //   }\n  // },\n  // {\n  //   name: \"目标: 领导力\",\n  //   desc: \"如果你的弃牌堆中有1张\\\"集体存档\\\"或\\\"送温暖\\\"，就获得3分\",\n  //   target_cards: [\"集体存档\", \"送温暖\"],\n  //   effect(G, ctx, player) {\n  //     let leader_num = player.discard.filter(x => [\"集体存档\", \"送温暖\"].includes(x.name)).length;\n  //     // if (leader != undefined) {\n  //       // player.score += 3;\n  //     // }\n  //     // player.score += leader_num * 2;\n  //     if (leader_num >= 1) {\n  //       player.score += 3;\n  //     }\n  //   }\n  // },\n  \n  // {\n  //   name: \"目标: 飞鞋\",\n  //   desc: \"如果你至少拥有2个\\\"鞋子\\\"，则获得2分\",\n  //   target_card: \"鞋子\",\n  //   effect(G, ctx, player) {\n  //     let shoes = player.entities.filter(x => x == \"skip\");\n  //     if (shoes.length >= 2) {\n  //       player.score += 2;\n  //     }\n  //   }\n  // }\n  // ,\n];\n\nexport const GOALS = goals_raw.map(process_goal);\n\nconst check_fruitnum = (fruit_num: number, score: number) => (G: IGame, ctx: Ctx, player: IPlayer, self?: ICard) => {\n  if (self && !self.is_achieved) { \n    let agari = player.entities.reduce((acc,val)=>((typeof val == \"object\")?(acc+1):acc), 0) >= fruit_num;\n    if (agari) {\n      player.score += score + G.public_goal_bonus;\n      self.is_achieved = true;\n      G.gamelogs.unshift(\"和牌!\");\n      console.log(\"和牌\", self.desc, self.is_achieved);\n    }\n  }\n  else {\n    return;\n  }\n}\n\nconst check_requirements = (requirements: number[], score: number) => (G: IGame, ctx: Ctx, player: IPlayer, self?: ICard) => {\n  if (self && !self.is_achieved) {\n    let fruits = player.entities.reduce((acc, val) => {\n      if (typeof val == \"object\") {\n        let new_acc = [...acc];\n        new_acc[val.fruit] += 1;\n        return new_acc;\n      }\n      else {\n        return acc;\n      }\n    }, [0,0,0]);\n    let diffs = fruits.map((cnt, idx) => (cnt - requirements[idx]) >= 0);\n    let agari = !diffs.includes(false);\n    // console.log(`D:${diffs}, F:${fruits}, A:${agari}`);\n    if (agari) {\n      player.score += score;\n      self.is_achieved = true;\n      G.gamelogs.unshift(\"和牌!\");\n      console.log(\"和牌\", self.desc, self.is_achieved);\n    }\n  }\n  else {\n    // console.log(\"Already achieved\");\n    return;\n  }\n}\n\nexport const public_goals_raw: ICard[] = [\n  {\n    name: \"公共目标(5分)\",\n    desc: \"AAA\",\n    effect: check_requirements([3,0,0], 5),\n    greedy_goal: 0,\n  },\n  {\n    name: \"公共目标(5分)\",\n    desc: \"BBB\",\n    effect: check_requirements([0,3,0], 5),\n    greedy_goal: 1,\n  },\n  {\n    name: \"公共目标(5分)\",\n    desc: \"CCC\",\n    effect: check_requirements([0,0,3], 5),\n    greedy_goal: 2,\n  },\n  {\n    name: \"公共目标(3分)\",\n    desc: \"AA\",\n    effect: check_requirements([2,0,0], 3),\n    greedy_goal: 0,\n  },\n  {\n    name: \"公共目标(3分)\",\n    desc: \"BB\",\n    effect: check_requirements([0,2,0], 3),\n    greedy_goal: 1,\n  },\n  {\n    name: \"公共目标(3分)\",\n    desc: \"CC\",\n    effect: check_requirements([0,0,2], 3),\n    greedy_goal: 2,\n  },\n\n  // {\n  //   name: \"公共目标(5分)\",\n  //   desc: \"ABC\",\n  //   effect: check_requirements([1,1,1], 5),\n  // },\n\n  // {\n  //   name: \"公共目标(2分)\",\n  //   desc: \"AB\",\n  //   effect: check_requirements([1,1,0], 2),\n  // },\n  // {\n  //   name: \"公共目标(2分)\",\n  //   desc: \"BC\",\n  //   effect: check_requirements([0,1,1], 2),\n  // },\n  // {\n  //   name: \"公共目标(2分)\",\n  //   desc: \"AC\",\n  //   effect: check_requirements([1,0,1], 2),\n  // },\n  {\n    name: \"公共目标(4分)\",\n    desc: \"XXX\",\n    greedy_goal: -1,\n    effect: check_fruitnum(3, 4),\n  },\n  // {\n  //   name: \"公共目标(4分)\",\n  //   desc: \"XXXX\",\n  //   effect: check_fruitnum(4, 4),\n  // }\n  // {\n  //   name: \"公共目标(3分)\",\n  //   desc: \"AAB\",\n  //   effect: check_requirements([2,1,0], 3),\n  // },\n  // {\n  //   name: \"公共目标(3分)\",\n  //   desc: \"ACC\",\n  //   effect: check_requirements([1,0,2], 3),\n  // },\n  // {\n  //   name: \"公共目标(3分)\",\n  //   desc: \"BBC\",\n  //   effect: check_requirements([0,2,1], 3),\n  // },\n  // {\n  //   name: \"公共目标(3分)\",\n  //   desc: \"归档区有2张牌\",\n  //   effect(G, ctx, player) {\n\n  //   },\n  // },\n];\n\nexport const PUBLIC_GOALS = public_goals_raw.map(process_public_goal);","import _ from 'lodash';\n\nexport function map_object<a,b>(fn: (arg: a, key?: string) => b, obj: Record<string,a>) {\n  let new_obj: Record<string,b> = {};\n\n  for (let k in obj) {\n    new_obj[k] = fn(obj[k], k);\n  }\n\n  return new_obj;\n}\n\nexport function reorder<a>(list: a[], indexes: number[]): a[] {\n  return indexes.map(idx => list[idx]);\n}\n\nexport function contain_key<a,b>(value: a, key: b) {\n  if (typeof value == \"object\" && key in value) {\n    return true;\n  }\n  else {\n    return false;\n  }\n}\n\nexport function rand(seed: string) {\n  let val = _.sum(seed.split(\"\").map((c, idx) => seed.charCodeAt(idx)));\n  let x = Math.sin(val++) * 10000;\n  return x - Math.floor(x);\n}\n\n\nexport class PRNG {\n  seed: string | number;\n  val: number;\n\n  constructor(seed: string | number, val?: number) {\n    this.seed = seed || 0;\n\n    if (val == undefined) {\n      this.val = 0;\n      if (typeof seed == \"string\"){\n        for (let i=0; i<seed.length; i++) {\n          this.val += seed.charCodeAt(i);\n        }\n      }\n      else {\n        this.val = seed;\n      }\n\n    // this.random = this.random.bind(this);\n    // No need to bind\n    }\n  else {\n    this.val = val;\n  }\n}\n\n  random() {\n    let x = Math.sin(this.val++) * 10000;\n    let result = x - Math.floor(x);\n    this.val += 2; //To ensure this is stable\n    return result;\n  }\n\n  randRange(x: number) {\n    return Math.floor(x * this.random());\n  }\n\n  choice(arr: any[]) {\n    let len = arr.length;\n    return arr[this.randRange(len)];\n  }\n\n  shuffle(deck: any[]) {\n    let clone = deck.slice(0);\n    let srcIndex = deck.length;\n    let dstIndex = 0;\n    let shuffled = new Array(srcIndex);\n\n    while (srcIndex) {\n      let randIndex = (srcIndex * this.random()) | 0;\n      shuffled[dstIndex++] = clone[randIndex];\n      clone[randIndex] = clone[--srcIndex];\n    }\n\n    return shuffled;\n  }\n}","import React, { ReactNode as EL } from 'react';\nimport { ActivePlayers } from 'boardgame.io/core';\nimport _ from 'lodash';\nimport { Ctx, Move as GeneralMove } from 'boardgame.io';\nimport { INVALID_MOVE } from 'boardgame.io/core';\nimport { CARDS } from './cards';\n\nimport { IGame, ICard, IPlayer, IAction, FlipAction, ExecuteAction, ICardWeight, IBehaviour } from './types';\nimport { AVATARS } from './assets';\nimport { GOALS, PUBLIC_GOALS } from './goals';\nimport { PRNG } from './utils';\n\n// No \"turn based\" stuffs are used\n\nconst NUM_PLAYERS = 4;\n\ntype Move = (G: IGame, ctx: Ctx, ...args: any[]) => any;\n\nexport function move(deck1: ICard[], deck2: ICard[]) {\n  // This time, only procedure method, works\n  let card = deck1.splice(0, 1)[0];\n  if (card) {\n    deck2.unshift(card);\n    return card\n  }\n  else {\n    return undefined;\n  }\n}\n\nfunction init_deck(G:IGame, ctx: Ctx): ICard[] {\n  // let deck_data = \"\".split(\" \")\n  let deck_data = [\n    ..._.times(4, () => \"炸弹\"), \n    ..._.times(2, () => \"护甲\"), \n    ..._.times(2, () => \"引爆\"), \n\n    // ..._.times(1, () => \"吉他\"), \n    // ..._.times(1, () => \"上传\"), \n    // ..._.times(3, () => \"天妇罗\"), \n    // ..._.times(2, () => \"乌龟\"), \n    ..._.times(1, () => \"拆弹\"), \n    ..._.times(2, () => \"照相机\"), \n    ..._.times(2, () => \"果汁\"), \n    ..._.times(2, () => \"观星\"),\n    ..._.times(2, () => \"存档\"),\n    ..._.times(1, () => \"大存档\"),\n\n    ..._.times(1, () => \"送温暖\"),\n    ..._.times(2, () => \"集体存档\"),\n    ..._.times(1, () => \"美味佳肴\"), \n    ..._.times(1, () => \"搋子\"), \n    ..._.times(1, () => \"三屎\"),\n\n    ..._.times(1, () => \"西红柿\"),\n    ..._.times(1, () => \"柠檬\"),\n    ..._.times(1, () => \"苹果\"),\n  ];\n  let deck = deck_data.map(name => CARDS.find(x => x.name == name)).filter(x => x != undefined).map(x => ({...x})) as ICard[];\n  for (let card of deck) {\n    if (card.has_fruit) {\n      card.fruit = G.rng.randRange(3);\n    }\n  }\n  return G.rng.shuffle(deck);\n}\n\nfunction setup_player(rng: PRNG): IPlayer {\n  const P: IPlayer = {\n    score: 0,\n    hand: [],\n    deck: [],\n    discard: [],\n    goals: [],\n\n    entities: [\"skip\"],\n\n    previous_action: -1,\n    previous_actions: [],\n\n    finished: false,\n    out: false,\n    fruit_bonus: 0,\n    goal_bonus: 0,\n    survive_bonus: 0,\n\n    // TODO: add goals\n\n    ai_behaviour: {\n      aggressive: rng.randRange(10),\n      protective: rng.randRange(10),\n      greedy: rng.randRange(10),\n      topdown: rng.randRange(10),\n      greedy_growth: rng.randRange(3),\n      protective_growth: rng.randRange(3),\n      topdown_growth: rng.randRange(5),\n    },\n  };\n\n  return P;\n}\n\nconst init_draft: Move = (G, ctx) => {\n  // After all cards are into the deck and deck is shuffled\n  for (let player of G.players) {\n    let num_cards = 6; // PARAM\n    player.hand = G.deck.slice(0, num_cards);\n    G.deck = G.deck.slice(num_cards);\n\n    player.previous_actions = [];\n\n    if (player.preset_ai_behaviour) {\n      player.ai_behaviour = player.preset_ai_behaviour;\n    }\n  }\n\n};\n\nconst add_avatars: Move = (G, ctx) => {\n  let len = G.players.length;\n  // console.log(G.rng);\n  // console.log(G.rng.shuffle);\n  let avatars = G.rng.shuffle(AVATARS).slice(0, len);\n  for (let i=0; i<len; i++) {\n    G.players[i].illust = avatars[i];\n  }\n}\n\nconst init_goals: Move = (G, ctx) => {\n  let goals = G.rng.shuffle([...GOALS, ...GOALS.filter(x => x.stackable)]);\n\n  // Debug is 1, then change to 2\n  for (let i=0; i<G.players.length; i++) {\n    let player = G.players[i];\n    // player.goals = goals.slice(2*i, 2*i+2);\n    player.goals = goals.slice(i, i+1);\n  }\n\n  let num_public_goals = 1; // PARAM\n  G.public_goals = G.rng.shuffle(PUBLIC_GOALS.map(g=>({...g, is_achieved: false}))).slice(0,num_public_goals);\n}\n\nconst init_round: Move = (G, ctx) => {\n  // Reset values\n  G.num_places = 0;\n\n  // Check players' scores\n  for (let p of G.players) {\n    if (p.score >= 12) {\n      G.should_finished = true;\n      console.log(\"Game Finished: \", G.players.map(p => p.score));\n    }\n  }\n\n  // Reset the deck, pass the init player\n  G.phase = \"place\";\n  G.round += 1;\n  G.deck = init_deck(G, ctx);\n  G.init_player = (G.init_player + 1) % 4;\n  G.public_goal_bonus = 0;\n\n  // Reset player data\n  for (let player of G.players) {\n    player.deck = [];\n    player.hand = [];\n    player.discard = [];\n    player.entities = [\"skip\"];\n    player.out = false;\n    player.finished = false;\n    player.previous_action = -1;\n    player.fruit_bonus = 0;\n    player.goal_bonus = 0;\n    player.survive_bonus = 0;\n    player.has_tempura = false;\n  }\n\n  init_goals(G, ctx);\n  init_draft(G, ctx);\n}\n\n// This is just for init\nfunction setup(ctx: Ctx): IGame {\n  const rng = new PRNG(114514);\n  const G: IGame = {\n    deck: [],\n    players: _.times(NUM_PLAYERS, ()=>setup_player(rng)),\n    public_goals: [],\n    rng, \n    actions: [],\n    round: -1,\n    init_player: 0,\n    active_player_idx: 0,\n    next_action: \"place\",\n\n    phase: \"place\",\n\n    host: 0,\n    ai_players: [0,1,2,3].slice(ctx.numPlayers),\n    gamelogs: [],\n    num_places: 0,\n    num_moves: 0,\n    public_goal_bonus: 0,\n\n    should_finished: false,\n\n    f1: () => \"f1\",\n    f2: () => \"f2\",\n  };\n\n  console.log(`How many Players AI: ${ctx.numPlayers} ${G.ai_players}`);\n  \n\n  return G;\n}\n\nexport const setup_scenario: Move = (G, ctx, seed) => {\n  G.rng = new PRNG(seed);\n  add_avatars(G, ctx);\n  init_ai_behaviour(G, ctx);\n  init_round(G, ctx);\n  // G.f2 = () => \"f12\";\n}\n\nexport const set_ai_players: Move = (G, ctx, num_ai) => {\n  G.ai_players = [0,1,2,3].slice(-num_ai);\n  console.log(\"New AI Players\", G.ai_players);\n}\n\nexport const init_ai_behaviour: Move = (G, ctx) => {\n  const BEHAVIOURS: IBehaviour[] = [\n    // Average\n    // {\n    //   aggressive: 5,\n    //   protective: 5,\n    //   topdown: 5,\n    //   greedy: 5,\n    //   protective_growth: 2,\n    //   topdown_growth: 2,\n    //   greedy_growth: 2,\n    // },\n\n    // Average Greedy: Swiss #1 306\n    // {\n    //   aggressive: 5,\n    //   protective: 5,\n    //   topdown: 0,\n    //   greedy: 9,\n    //   protective_growth: 2,\n    //   topdown_growth: 3,\n    //   greedy_growth: 2,\n    // },\n\n    // Greedy Protective: Swiss #1 306_4\n    {\n      aggressive: 0,\n      protective: 6,\n      topdown: 5,\n      greedy: 8,\n      protective_growth: 4,\n      topdown_growth: 0,\n      greedy_growth: 0,\n    },\n\n    // Another Growth: Random #1 306_2\n    {\n      aggressive: 2,\n      protective: 5,\n      topdown: 2,\n      greedy: 9,\n      protective_growth: 0,\n      topdown_growth: 5,\n      greedy_growth: 5,\n    },\n\n    // No Growth: Swiss #1 306_7\n    {\n      aggressive: 6,\n      protective: 7,\n      topdown: 1,\n      greedy: 9,\n      protective_growth: 0,\n      topdown_growth: 0,\n      greedy_growth: 0,\n    },\n    \n    \n  ];\n  for (let i=0; i<4; i++) {\n    G.players[i].preset_ai_behaviour = G.rng.choice(BEHAVIOURS);\n  }\n}\n\nexport const set_ai_behaviours: Move = (G, ctx, behaviours: IBehaviour[]) => {\n  for (let i=0; i<4; i++) {\n    G.players[i].preset_ai_behaviour = behaviours[i];\n  }\n}\n\nexport function add_fruits(G:IGame, ctx:Ctx, player: IPlayer, fruits: number[]) {\n  for (let i=0; i<3; i++) {\n    for (let j=0; j<fruits[i]; j++) {\n      player.entities.push({fruit: i});\n      player.score += player.fruit_bonus;\n    }\n  }\n  for (let goal of G.public_goals) {\n    (PUBLIC_GOALS.find(x => x.desc == goal.desc) as ICard).effect(G, ctx, player, goal);\n  }\n}\n\nfunction all_finished(G: IGame): boolean {\n  let unfinished_player = G.players.find(x => !(x.finished || x.out));\n  if (unfinished_player != undefined) {\n    return false;\n  }\n  else {\n    return true;\n  }\n}\n\nfunction get_next_idx(players: IPlayer[], current_idx: number): number {\n  let next_idx = (current_idx + 1) % (players.length);\n  if (players[next_idx].finished || players[next_idx].out) {\n    return get_next_idx(players, next_idx);\n  }\n  else {\n    return next_idx;\n  }\n}\n\nconst place: Move = (G, ctx, from_idx: number, card_idx: number, direction: number) => {\n  let from_player = G.players[from_idx];\n  let card = from_player.hand[card_idx];\n  from_player.hand = from_player.hand.filter(x => (x != card));\n\n  let to_player = G.players[(from_idx + direction) % G.players.length];\n  to_player.deck.unshift(card);\n\n  from_player.previous_action = direction;\n};\n\nconst ai_moves: Move = (G, ctx) => {\n  for (let idx of G.ai_players) {\n    // AI IMPLEMENT: card_idx and direction\n    // let card_idx = G.rng.randRange(G.players[idx].hand.length);\n    // let direction = G.rng.randRange(G.players.length);\n\n    // Init cards\n    let ai = G.players[idx];\n    let card_weights: ICardWeight[] = [];\n    for (let i=0; i<ai.hand.length; i++) {\n      card_weights.push({\n        weight: 0,\n        direction: [],\n      }); \n    }\n    let sorted_by_score = [...G.players].sort((a,b) => b.score - a.score);\n    let top = sorted_by_score[0];\n\n    // Growth\n    if (top == ai) {\n      // ai.ai_behaviour.topdown = 0;\n      top = sorted_by_score[1];\n    }\n\n    if (G.round >= 3) {\n      // After round 3, goes top down if it is on the top, and go growing if it is on the bottom\n      if (sorted_by_score.slice(0,2).includes(ai)) {\n        ai.ai_behaviour.topdown = (ai.preset_ai_behaviour || {topdown: 0}).topdown +  ai.ai_behaviour.topdown_growth;\n      }\n      else {\n        ai.ai_behaviour.greedy = (ai.preset_ai_behaviour || {greedy: 0}).greedy + (ai.ai_behaviour.greedy_growth);\n      }\n    }\n\n    let danger = 0;\n    for (let p of G.players) {\n      if (p.previous_action && ((G.players.indexOf(p)+p.previous_action) % 4 == idx)) {\n        danger += 1;\n      }\n    }\n    if (danger !== 0) {\n      ai.ai_behaviour.greedy -= ai.ai_behaviour.protective_growth;\n      ai.ai_behaviour.protective += ai.ai_behaviour.protective_growth;\n    }\n\n    // Goals\n    for (let goal of ai.goals) {\n\n      // Aggressive Goal\n      if (goal.aggressive_goal) {\n        for (let i=0; i<ai.hand.length; i++) {\n          let card = ai.hand[i];\n          let weight = card_weights[i];\n          if (card.effect_type === \"aggressive\") {\n            weight.weight += ai.ai_behaviour.aggressive + ai.ai_behaviour.greedy;\n            weight.direction.push(goal.aggressive_goal);\n            if (goal.protective_goal !== undefined) {\n              weight.direction.push(goal.protective_goal);\n            }\n          }\n        }\n      }\n\n      // Greedy Goal\n      if (goal.greedy_goal !== undefined) {\n        for (let i=0; i<ai.hand.length; i++) {\n          let card = ai.hand[i];\n          let weight = card_weights[i];\n          if (card.fruit === goal.greedy_goal || card.super_fruit === goal.greedy_goal) {\n            weight.weight += ai.ai_behaviour.greedy;\n            if (card.super_fruit === goal.greedy_goal) { weight.weight += ai.ai_behaviour.greedy * 2; }\n            weight.direction.push(0);\n          }\n        }\n      }\n\n      // Target Card Goal\n      if (goal.target_cards) {\n        let contain_target_cards = false;\n        for (let deck_card of ai.deck) {\n          if (goal.target_cards.includes(deck_card.name)) {\n            contain_target_cards = true;\n          }\n        }\n        if (contain_target_cards === false) {\n          for (let i=0; i<ai.hand.length; i++) {\n            let card = ai.hand[i];\n            let weight = card_weights[i];\n            if (goal.target_cards.includes(card.name)) {\n              weight.weight += ai.ai_behaviour.greedy * 2;\n              weight.direction.push(0);\n            }\n          }\n        }\n      }\n\n      // Public Goal\n      let public_fruit = G.public_goals[0].greedy_goal;\n      for (let i=0; i<ai.hand.length; i++) {\n        let card = ai.hand[i];\n        let weight = card_weights[i];\n        if (card.fruit === public_fruit || card.super_fruit === public_fruit) {\n          weight.weight += ai.ai_behaviour.greedy;\n          if (card.super_fruit === public_fruit) { \n            weight.weight += ai.ai_behaviour.greedy * 3;\n          }\n          weight.direction.push(0);\n        }\n        if ((card.super_fruit != undefined) && (public_fruit == -1)) {\n          weight.weight += ai.ai_behaviour.greedy * 2;\n          weight.direction.push(0);\n        }\n      }\n    }\n\n    // Greedy\n    for (let i=0; i<ai.hand.length; i++) {\n      let card = ai.hand[i];\n      let weight = card_weights[i];\n      if (card.effect_type == \"greedy\") {\n        weight.weight += ai.ai_behaviour.greedy;\n        if (card.name != \"送温暖\") {\n          weight.direction.push(0);\n        }\n        else {\n          weight.direction.push(G.rng.choice([1,3]));\n        }\n      }\n    }\n\n    // Protective\n    for (let i=0; i<ai.hand.length; i++) {\n      let card = ai.hand[i];\n      let weight = card_weights[i];\n      if (card.effect_type == \"protective\") {\n        weight.weight += ai.ai_behaviour.protective;\n        if (card.name == \"集体存档\") {\n          weight.direction.push(G.rng.choice([1,2,3]));\n        }\n        else {\n          weight.direction.push(0);\n        }\n      }\n    }\n\n    // Topdown\n    for (let i=0; i<ai.hand.length; i++) {\n      let card = ai.hand[i];\n      let weight = card_weights[i];\n      if (card.effect_type == \"topdown\" || card.effect_type == \"aggressive\") {\n        weight.weight += ai.ai_behaviour.topdown;\n        weight.direction.push((4 + G.players.indexOf(top) - idx)%4);\n      }\n    }\n\n    // Disturb\n    let to_disturb = [0,0,0,0];\n    to_disturb[idx] = -99;\n    for (let i=0; i<G.players.length; i++) {\n      let player = G.players[i];\n      for (let j=0; j<G.players.length; j++) {\n        if (i != j) {\n          let another_player = G.players[j];\n          for (let previous_action of another_player.previous_actions) {\n            if ((j + previous_action) % 4 == i) {\n              to_disturb[i] += 1;\n            }\n          }\n        }\n      }\n    }\n    if (to_disturb.indexOf(0) != -1) {\n      let disturb_direction = (4 + ((to_disturb.indexOf(0) + 4) % 4) - idx) % 4;\n      for (let i=0; i<ai.hand.length; i++) {\n        let card = ai.hand[i];\n        let weight = card_weights[i];\n        if (card.effect_type == \"topdown\" || card.effect_type == \"aggressive\") {\n          weight.weight += ai.ai_behaviour.aggressive * ((7-ai.hand.length)/7);\n          weight.direction.push(disturb_direction);\n        }\n      }\n    }\n\n    // Sort the weights and get the right card\n    let sorted_weights = [...card_weights];\n    sorted_weights.sort((a,b)=>b.weight - a.weight);\n    let card_idx = card_weights.indexOf(sorted_weights[0]); // EH: modularize this\n    let direction = 0;\n    if (sorted_weights[0].direction.length > 0) {\n      direction = G.rng.choice(sorted_weights[0].direction);\n    }\n\n    // console.log(\"Weights:\", card_weights);\n    // if (direction == 0 && (ai.hand[card_idx].effect_type == \"aggressive\" || ai.hand[card_idx].effect_type == \"topdown\") && (ai.hand[card_idx].name != \"引爆\")) {\n      // console.log(\"AI is doing something fool\");\n    // }\n\n    // Test the weights\n    // console.log(\"AI's behavior: \", {...ai.ai_behaviour});\n    // console.log(\"Public goal: \", G.public_goals[0].greedy_goal);\n    // console.log(\"Player goal: \", ai.goals[0].name);\n    // console.log(\"Card weights: \", card_weights.map((w, i) => `${ai.hand[i].name} ${w.weight} |`)); \n    // console.log(\"---\");\n\n    G.actions.push({\n      from_idx: idx,\n      card_idx, \n      direction,\n    });\n  }\n};\n\nconst enter_action_phase: Move = (G, ctx) => {\n  G.phase = \"action\";\n\n  for (let player of G.players) {\n    // console.log(\"Deck before:\", player.deck.map(card=>({...card})));\n    player.deck = G.rng.shuffle(player.deck);\n    player.deck = [...player.deck, ...player.goals];\n    // console.log(player.deck);\n  }\n\n  G.next_action = \"flip\";\n  G.active_player_idx = G.init_player;\n  G.num_moves = 0;\n};\n\n\nconst change_hands_or_enter_action_phase: Move = (G, ctx) => {\n  let hands = G.players.map(player => player.hand);\n  let len = hands.length;\n  let num_remained_cards = hands[0].length;\n  // console.log(G.rng);\n  // console.log(\"Shuffle:\", G.rng.shuffle);\n  // console.log(\"F1:\", G.f1);\n  // console.log(\"F2:\", G.f2);\n\n  if (num_remained_cards == 0) {\n    // console.log(\"Time to enter the action phase\");\n    enter_action_phase(G, ctx);\n  }\n\n  else {\n    // console.log(\"Pass hands\");\n    hands = [hands[len-1], ...hands.slice(0, len-1)];\n    for (let i=0; i<len; i++) {\n      G.players[i].hand = hands[i];\n    }\n  }\n\n  for(let player of G.players) {\n    player.placed = false;\n  }\n};\n\nconst carry_actions: Move = (G, ctx) => {\n  for (let action of G.actions) {\n    place(G, ctx, action.from_idx, action.card_idx, action.direction);\n    G.players[action.from_idx].previous_actions!.push(action.direction);\n  }\n  G.actions = [];\n  G.num_places += 1;\n\n  change_hands_or_enter_action_phase(G, ctx);\n};\n\nconst add_action: Move = (G, ctx, action?: IAction) => {\n  if (action != undefined) {\n    G.actions.push(action);\n    G.players[action.from_idx].placed = true;\n\n    // let host move\n    let from_idx = action.from_idx;\n    if (from_idx == G.host) {\n      ai_moves(G, ctx);\n    }\n    // console.log(`Actions length: ${G.actions.length}`);\n  }\n\n  // Check whether it's full\n  if (G.actions.length == G.players.length) {\n    carry_actions(G, ctx);\n  }\n};\n\nexport function flip_card(active_player: IPlayer) {\n  let card = active_player.deck[0];\n  if (card != undefined) {\n    active_player.deck = active_player.deck.slice(1);\n    active_player.discard.unshift(card);\n  }\n  return card;\n}\n\nexport function out(player: IPlayer) {\n  let shield_idx = player.entities.map((x,idx) => (x == \"shield\")? idx : undefined).filter(x => x != undefined)[0];\n  // console.log(\"Find shield:\", shield_idx);\n  if (shield_idx != undefined) {\n    player.entities = player.entities.filter((x,idx) => (idx != shield_idx));\n  }\n  else {\n    // console.log(`Player ${player.score}分 is out`)\n    player.out = true;\n    player.finished = true;\n    // player.score -= player.survive_bonus;\n  }\n}\n\n// const enter_place_phase: Move = (G, ctx) => {\n//   G.phase = \"place\";\n//   // EH: Reconstruct this into reset instead of just copy all setup stuffs\n\n//   G.round += 1;\n//   G.init_player = (G.init_player + 1) % 4;\n\n//   for (let player of G.players) {\n//     G.deck = [...G.deck, ...player.discard, ...player.hand, ...player.deck];\n\n//     player.deck = [];\n//     player.hand = [];\n//     player.discard = [];\n//     player.entities = [\"skip\"];\n//     player.out = false;\n//     player.finished = false;\n//     player.previous_action = undefined;\n//   }\n\n//   G.deck = G.rng.shuffle(G.deck);\n\n//   init_draft(G, ctx);\n// };\n\nconst enter_place_phase: Move = (G, ctx) => {\n  init_round(G, ctx);\n}\n\nconst proceed: Move = (G, ctx, skipped?: boolean) => {\n  G.num_moves += 1;\n  if (G.next_action == \"execute\" || skipped) {\n    // Check whether end the action phase, or pass to the next player\n    // Or say that pass to the next player, and if there's nobody to pass, then enter the action phase\n    if (all_finished(G)) {\n      enter_place_phase(G, ctx);\n    }\n    else {\n      let next_idx = get_next_idx(G.players, G.active_player_idx);\n      G.active_player_idx = next_idx;\n      G.next_action = \"flip\";\n    }\n  }\n\n  else {\n    G.next_action = \"execute\";\n  }\n};\n\nconst flip: Move = (G, ctx, player_idx: number, flip_action: FlipAction) => {\n  // Double check is fine\n  if (G.next_action == \"flip\" && G.active_player_idx == player_idx) {\n    let active_player = G.players[G.active_player_idx];\n    let skipped = false;\n    let skipper = active_player.entities.find(x => x == \"skip\");\n\n    if (flip_action == \"skip\" && skipper != undefined) {\n      let skipper_idx = active_player.entities.indexOf(skipper);\n      flip_card(active_player);\n      active_player.entities.splice(skipper_idx, 1);\n      skipped = true;\n      log_msg(G, ctx, `选择跳过`);\n      // Check finished here as finished is only checked after execute before\n      if (active_player.deck.length == 0) {\n        active_player.finished = true;\n      }\n    }\n\n    // EH: Write this in \"utils\" to make it more haskell-styled\n    else if (typeof(flip_action) == \"object\" && \"archive_idx\" in flip_action) {\n      let archive = active_player.hand[flip_action.archive_idx];\n      if (archive != undefined) {\n        active_player.hand = active_player.hand.filter(x => x != archive);\n        active_player.discard.unshift(archive);\n      }\n      else {\n        return INVALID_MOVE;\n      }\n    }\n\n    // Normal flip goes here\n    else {\n      flip_card(active_player);\n      // console.log(\"翻开牌\", active_player.discard[0].name);\n      if (active_player.discard[0] !== undefined) {\n        log_msg(G, ctx, `翻开 ${active_player.discard[0].name}`);\n      }\n    }\n\n    proceed(G, ctx, skipped);\n    \n  }\n  else {\n    return INVALID_MOVE;\n  }\n};\n\nconst execute: Move = (G, ctx, player_idx: number, execute_action: ExecuteAction) => {\n  if (player_idx == G.active_player_idx) {\n    let player = G.players[G.active_player_idx];\n    let card = player.discard[0];\n    // console.log(`${player_idx} is executing`);\n    if (execute_action == \"fruit\") {\n      // console.log(\"Gonna add fruit\");\n      if (card.fruit !== undefined || card.super_fruit !== undefined) {\n        // player.entities.push({fruit: card.fruit});\n        let added = [0,0,0];\n        if (card.fruit !== undefined) {\n          added[card.fruit] = 1;\n        }\n        if (card.super_fruit !== undefined) {\n          added[card.super_fruit] = 2;\n        }\n        add_fruits(G, ctx, player, added);\n        log_msg(G, ctx, `将 ${card.name} 作为水果`);\n      }\n      else {\n        return INVALID_MOVE;\n      }\n    }\n    else {\n      // console.log(`Just execute ${card.name}`);\n      // Add functions\n      card = (card.is_goal?GOALS:CARDS).find(x => x.name == card.name) as ICard;\n      // console.log({...card});\n      card.effect && card.effect(G, ctx, player, card);\n      log_msg(G, ctx, `执行 ${card.name}`);\n      if (card.name == \"观星\") {\n        log_msg(G, ctx, `观察到 ${player.deck.slice(0,2).map(c => c.name)}`);\n      }\n    }\n\n    // Check finished\n    // EH: move all \"finished\" into a getter function, just check whether is out or deck length is 0, this is the best way to \"finish\"\n    player.finished = (player.out || (player.deck.length == 0));\n\n    // HACK: using procedure method\n    if (player.deck.length === 0) {\n      player.score += player.survive_bonus;\n      player.survive_bonus = 0;\n    }\n\n    proceed(G, ctx);\n  }\n  else {\n    return INVALID_MOVE;\n  }\n};\n\nconst ai_act: Move = (G, ctx, from_idx: number) => {\n  if (G.ai_players.includes(G.active_player_idx) && (G.host == from_idx)) {\n    let ai = G.players[G.active_player_idx];\n    if (G.next_action == \"flip\") {\n      // AI IMPLEMENT: Flip action and execute action\n      // ENH: modularize this part\n      let flip_action: FlipAction = \"flip\";\n\n      // Play archive\n      if (ai.hand.length > 0) {\n        let archive = ai.hand[0];\n        if (archive.effect_type != \"aggressive\" && archive.effect_type != \"topdown\" && (!(ai.goals[0].target_cards || []).includes(\"存档\"))) {\n          flip_action = {archive_idx: 0};\n        }\n      }\n\n      // Skip if protective is more important\n      if ((ai.entities.includes(\"skip\")) && \n      (ai.deck.length > 1) && \n      (ai.deck.length < 5) && \n      (ai.goals[0].target_cards != [\"鞋子\"]) &&\n      (ai.ai_behaviour.protective > ai.ai_behaviour.greedy) && \n      (!ai.entities.includes(\"shield\"))) {\n        // console.log(`It's skip time! Deck len: ${ai.deck.length}`);\n        flip_action = \"skip\";\n      }\n\n      flip(G, ctx, G.active_player_idx, flip_action);\n    }\n\n    else if (G.next_action == \"execute\") {\n      // Execute action\n\n      let execute_action: ExecuteAction = \"execute\";\n      // console.log(`AI Act: Greedy ${ai.ai_behaviour.greedy} Protective ${ai.ai_behaviour.protective}`)\n\n      if ((ai.ai_behaviour.greedy > ai.ai_behaviour.protective) \n      && [...G.public_goals.filter(g => !g.is_achieved).map(g => g.greedy_goal), ai.goals[0].greedy_goal].filter(g => g != undefined).includes(ai.discard[0].fruit)) {\n        // console.log(`It's fruit time! Greedy Goal:${[...G.public_goals.map(g => g.greedy_goal), ai.goals[0].greedy_goal]} Fruit: ${ai.discard[0].fruit}`);\n        execute_action = \"fruit\";\n      }\n\n      if (ai.discard[0].name == \"果汁\" && ai.entities.filter(x => typeof x == \"object\").length == 0) {\n        // console.log(\"It is a juice but AI does not have fruits.\");\n        execute_action = \"fruit\";\n      }\n\n      if (ai.discard[0].super_fruit !== undefined) {\n        execute_action = \"fruit\";\n      }\n\n      execute(G, ctx, G.active_player_idx, execute_action);\n    }\n    else {\n      return INVALID_MOVE;\n    }\n  }\n  else {\n    return INVALID_MOVE;\n  }\n};\n\nexport const log_msg: Move = (G, ctx, msg: string) => {\n  G.gamelogs.unshift(msg);\n}\n\nexport const CSPR = {\n  setup: setup,\n  moves: {\n    setup_scenario,\n    set_ai_players,\n    set_ai_behaviours,\n    add_action,\n    flip,\n    execute,\n    ai_moves,\n    ai_act,\n    log_msg,\n  },\n  minPlayers: 1,\n  maxPlayers: 4,\n  turn: {\n    activePlayers: ActivePlayers.ALL,\n  },\n  plugins: [\n    {\n      name: \"rng\",\n      fnWrap: (fn:any) => (G:IGame, ctx:Ctx, ...args:any[]) => {\n        G = fn({...G, rng: new PRNG(114514, G.rng.val)}, ctx, ...args);\n        return G;\n      }\n    },\n  ],\n};","import React, { ReactNode } from 'react';\nimport { Entity } from './types';\n\n// import './icons.css';\nimport { contain_key } from './utils';\n\nconst fruit_style = {\n  height: \"auto\",\n  width: \"1.0em\",\n};\n\nexport const FRUITS: ReactNode[]= [\n  \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/263/tomato_1f345.png\",\n  \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/263/lemon_1f34b.png\",\n  \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/263/green-apple_1f34f.png\",\n].map(src => <img src={src} style={fruit_style} />);\n\nexport const shield_icon = <img src=\"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/259/shield_1f6e1.png\" style={fruit_style} />;\n\nexport const skip_icon = <img src=\"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/259/running-shoe_1f45f.png\" style={fruit_style} />;\n\nexport function get_entity_icon(entity: Entity): ReactNode {\n  if (typeof entity == \"object\") {\n    return FRUITS[entity.fruit];\n  }\n  else if (entity == \"shield\") {\n    return shield_icon;\n  }\n  else {\n    return skip_icon;\n  }\n}","import React from 'react';\nimport { IState, Action, Phase, IOperation, IGame, ICard, FlipAction, IPlayer } from './types'\n\nexport function init_state(): IState {\n  return {\n    board: \"GoalBoard\",\n    player_idx: 0,\n    log: \"\",\n    dream_count: 0,\n  };\n}\n\nconst change_hand_selected: Action = (S, idx: number) => {\n  if (S.hand_selected == idx) {\n    S.hand_selected = undefined;\n  }\n  else {\n    S.hand_selected = idx;\n  }\n}\n\nfunction get_place_operations(from_idx: number, card_idx: number): IOperation[] {\n  let directions = [0, 1, 3, 2];\n  let names = [\"自己\", \"下家\", \"上家\", \"对家\"];\n\n  return directions.map((direction, idx) => ({\n    name: names[idx],\n    action: \"add_place_action\",\n    args: [from_idx, card_idx, direction],\n  }));\n}\n\n// const change_operations_on_select_hand: Action = (S, should_change: boolean) => {\n//   if (should_change) {\n//     if (S.hand_selected != undefined) {\n//       S.operations = get_place_operations(S.player_idx, S.hand_selected);\n//     }\n//     else {\n//       S.operations = [];\n//     }\n//   }\n//   else {\n//     console.log(\"Should not change\");\n//     return;\n//   }\n// }\n\nexport function get_operations(G: IGame, S: IState): IOperation[] {\n  let player = G.players[S.player_idx];\n  if (G.phase == \"place\") {\n    if (!player.placed && S.hand_selected != undefined) {\n      return get_place_operations(S.player_idx, S.hand_selected);\n    }\n    else {\n      return [];\n    }\n  }\n  else {\n    if (G.active_player_idx == S.player_idx) {\n      if (S.player_idx == G.host && G.ai_players.includes(G.active_player_idx)) {\n        return [\n          {\n            name: \"行动\",\n            action: \"ai_act\",\n            args: [S.player_idx],\n          }\n        ];\n      }\n      if (G.next_action == \"flip\") {\n        let flip_actions: IOperation[] = [\n          {name: \"翻开\", action: \"flip\", args: [S.player_idx, \"flip\"]},\n        ];\n        if (player.entities.includes(\"skip\")) {\n          flip_actions.push({name: \"跳过\", action: \"flip\", args: [S.player_idx, \"skip\"]});\n        }\n        if ((player.hand.length > 0) && (S.hand_selected != undefined)) {\n          flip_actions.unshift({name: \"打出存档\", action: \"flip\", args: [S.player_idx, {archive_idx: S.hand_selected}]});\n        }\n        return flip_actions;\n      }\n      else {\n        let execute_actions: IOperation[] = [\n          {name: \"执行\", action: \"execute\", args: [S.player_idx, \"execute\"]},\n        ];\n        let top_card = player.discard[0];\n        if (top_card.fruit !== undefined || top_card.super_fruit !== undefined) {\n          execute_actions.push({name: \"作为水果\", action: \"execute\", args: [S.player_idx, \"fruit\"]});\n        }\n        return execute_actions;\n      }\n    }\n    else {\n      if (S.player_idx == G.host && G.ai_players.includes(G.active_player_idx)) {\n        return [\n          {\n            name: \"行动\",\n            action: \"ai_act\",\n            args: [S.player_idx],\n          }\n        ];\n      }\n      else {\n        return [];\n      }\n    }\n  }\n}\n\nconst select_hand: Action = (S, idx: number, player: IPlayer) => {\n  change_hand_selected(S, idx);\n  let card = player.hand[idx];\n  if (!player.placed) {\n    log_msg(S, <span>{card.name}: {card.desc}</span>);\n  }\n}\n\nconst clear_state: Action = (S) => {\n  S.hand_selected = undefined;\n  // log_msg(S, \"已扣牌\");\n}\n\nconst change_board: Action = (S, board) => {\n  S.board = board;\n}\n\nconst log_msg: Action = (S, msg) => {\n  S.log = msg;\n}\n\nconst enter_dream: Action = (S) => {\n  S.dream_count += 1;\n}\n\nexport const ACTIONS: Record<string, Action> = {\n  select_hand,\n  clear_state,\n  change_board,\n  log_msg,\n  enter_dream,\n};","import { CombinedAction, Dispatcher, ExecuteAction, FlipAction, IState } from './types';\n\n// EH: Should be able to wait when a value is changed then make move, not only combine those things\nconst add_place_action: CombinedAction = (moves, actions, from_idx: number, card_idx: number, direction: number) => {\n  moves.add_action({from_idx, card_idx, direction});\n  actions.clear_state();\n};\n\nconst ai_act: CombinedAction = (moves, actions, from_idx: number) => {\n  moves.ai_act(from_idx);\n};\n\nconst ai_moves: CombinedAction = (moves, actions, from_idx: number) => {\n  moves.ai_moves(from_idx);\n  moves.add_action();\n};\n\nconst flip: CombinedAction = (moves, actions, player_idx: number, flip_action: FlipAction) => {\n  moves.flip(player_idx, flip_action);\n}\n\n\nconst execute: CombinedAction = (moves, actions, player_idx: number, execute_action: ExecuteAction) => {\n  moves.execute(player_idx, execute_action);\n}\n\n// const select_hand: CombinedAction = (moves, actions, hand_idx: number) => {\n//   actions.select_hand(hand_idx);\n//   moves.show_hand_info(hand_idx);\n// }\n\nexport const COMBINED: Record<string, CombinedAction> = {\n  add_place_action,\n  ai_act,\n  flip,\n  execute,\n  ai_moves,\n  // select_hand,\n};","import React, { ReactNode as EL, FC, useState, useEffect } from 'react';\nimport _ from 'lodash';\nimport { produce } from 'immer';\nimport { AVATARS } from './assets';\n\nimport './Board.css';\n\nimport { ICard, IPlayer, IGame, IState, Action, IOperation, Dispatcher, CombinedAction, BoardProps } from './types';\nimport { FRUITS, get_entity_icon } from './icons';\nimport { Ctx } from 'boardgame.io';\nimport { BoardProps as BGBoardProps } from 'boardgame.io/react';\nimport { CARDS } from './cards';\nimport { ACTIONS, get_operations, init_state } from './actions';\nimport { map_object, reorder } from './utils';\nimport { COMBINED } from './combiner';\nimport { goal_illust as goal_illust_src } from './assets';\n\nfunction TopPanel(props: {gameCount: string|number, checkGoal:()=>void, addAI:()=>void}) {\n  return <div className=\"top-panel\">\n    <button className=\"check-goal-button\" onClick={props.checkGoal} >查看目标</button>\n    <div onClick={props.addAI}>{props.gameCount}</div>\n  </div>;\n}\n\nfunction DeckArea(props: {cardNum: number}) {\n  return <div className=\"deck-area\">\n    <div className=\"card-num\">\n      {props.cardNum}\n    </div>\n  </div>;\n}\n\nfunction PlayArea(props: {playedCard?: ICard}) {\n  return <div className=\"play-area\">\n    <Card {...props.playedCard} />\n  </div>;\n}\n\nfunction CardAreas(props: {cardNum: number, playedCard?: ICard}) {\n  // Both draw pile and discard pile go together,\n  // Also, Card should be 100% and be contained with card containers\n  return <div className=\"card-areas\">\n    <DeckArea cardNum={props.cardNum} />\n    <PlayArea playedCard={props.playedCard} />\n  </div>;\n}\n\nfunction Avatar(props: {illust?: string, selected?: boolean, out?: boolean, placed?: boolean}) {\n  return <div className=\"avatar\" style={{border:(props.selected)?\"3px solid #61dafb\":(props.out)?\"1px solid #f5222d\":undefined}}>\n    <img src={props.illust} className=\"avatar-img\" />\n    <img src=\"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/twitter/259/check-mark-button_2705.png\" className=\"tick-icon\" style={{display: props.placed? undefined : \"none\"}} />\n  </div>;\n}\n\nfunction InfoLine(props: {content: string|EL}) {\n  return <div className=\"info-line\" style={{color: (props.content==\"扣给你\")?\"#61dafb\":undefined}}>\n    {props.content}\n  </div>;\n}\n\n// TODO: Make an adapter to fit those two\nexport interface IPlayerInfo extends IPlayer {\n  selected?: boolean, \n  name: string, \n  info: string | EL[],\n};\n\nfunction PlayerInfo(props: IPlayerInfo) {\n  return <div className=\"player-info\">\n    <Avatar illust={props.illust} selected={props.selected} out={props.out} placed={props.placed} />\n    <InfoLine content={`${props.name}(${props.score}分)`} />\n    <InfoLine content={props.info}/>\n  </div>;\n}\n\nfunction Player(props: {playerInfo: IPlayerInfo}) {\n  return <div className=\"player\">\n    <CardAreas cardNum={props.playerInfo.deck.length} playedCard={props.playerInfo.discard[0]} />\n    <PlayerInfo {...props.playerInfo} />\n  </div>;\n}\n\nfunction Central(props: {players: IPlayerInfo[]}) {\n  return <div className=\"central\">\n    {props.players.map(player => \n    // illust name score info\n      <Player playerInfo={player} />\n    )}\n  </div>;\n}\n\nfunction InfoPanel(props: {log: string, handleClick: () => void}) {\n  // Top panel is only used to display count, all other logs are displayed in info panel\n  // useEffect(()=>console.log(props.log), [props.log]);\n  return <div className=\"info-panel\" onClick={props.handleClick}>\n    {props.log}\n  </div>;\n}\n\nfunction Controller(props: {operations: IOperation[], combined: Record<string, Dispatcher>, autoMove?: boolean, G:IGame}) {\n  // Use this method at first, and props.autoMove is only used when needed\n  let move1 = props.operations[0];\n  let autoMove = move1 && (move1.name == \"行动\");\n  useEffect(() => {\n    if (autoMove == true) {\n      let operation = props.operations[0];\n      console.log(`Ready to auto_move ${props.G.active_player_idx} ${props.G.next_action}`);\n      setTimeout(()=>{\n        props.combined[operation.action](...(operation.args || []));\n      }, 600);\n    }\n    else {\n      return;\n    }\n  }, [props.G.active_player_idx, props.G.next_action, props.G.num_moves]);\n\n  let operations = (autoMove)? [] : props.operations;\n\n  return <div className=\"controller\">\n    {operations.map(operation => \n      <button className=\"controller-button\" onClick={() => props.combined[operation.action](...(operation.args || []))}>{operation.name}</button>\n    )}\n  </div>;\n}\n\nfunction Card(props: Partial<ICard>) {\n  return <div className=\"card\">\n    <div className=\"illust-container\">\n      <img className=\"illust\" src={props.illust} />\n    </div>\n    <div className=\"card-fruit\" style={{display:(props.fruit != undefined)?undefined:\"none\"}}>{(props.fruit != undefined)? FRUITS[props.fruit] : \"\"}</div>\n  </div>;\n}\n\nfunction CardContainer(props: {card: Partial<ICard>, handleClick: ()=>void}) {\n  return <div \n    className = \"card-container\" \n    style = {{border:(props.card.selected == true)?\"3px solid #61dafb\":undefined}}\n    onClick = {props.handleClick}\n  >\n    <Card {...props.card} />\n  </div>;\n}\n\nfunction CardRow(props: {cards: ICard[], handleCardClick: (idx: number)=>()=>void}) {\n  return <div className=\"card-row\">\n    {props.cards.map((card, idx) => <CardContainer card={card} handleClick={props.handleCardClick(idx)} />)}\n  </div>;\n}\n\nfunction Template(props: {}) {\n  return <div className=\"template\">\n  </div>;\n}\n\nfunction hand_processor(S: IState): (card: ICard, idx: number) => ICard {\n  return (card, idx) => ({\n    ...card,\n    selected: S.hand_selected == idx,\n  });\n}\n\nfunction get_player_info(player: IPlayer, G: IGame, S: IState): string | EL[] {\n  if (G.phase == \"place\") {\n    if (player.previous_action != -1) {\n      let target_idx = (G.players.indexOf(player) + player.previous_action) % 4;\n      if (target_idx == S.player_idx && player.previous_action != 0) {\n        return \"扣给你\";\n      }\n      else {\n        return [\"扣给自己\", \"扣给下家\", \"扣给对家\", \"扣给上家\",][player.previous_action];\n      }\n    }\n    else {\n      return \"准备扣牌\";\n    }\n  }\n  else {\n    if (player.finished) {\n      if (player.out) {\n        return \"已出局\";\n      }\n      else {\n        return \"已完成\";\n      }\n    }\n    else {\n      return player.entities.map(entity => get_entity_icon(entity));\n    }\n  }\n}\n\nfunction get_position(idx: number, player_idx: number) {\n  let diff = idx - player_idx;\n  if (diff < 0) {\n    return 4 + diff;\n  }\n  else {\n    return diff;\n  }\n}\n\nfunction process_player(player: IPlayer, idx: number, G: IGame, S: IState): IPlayerInfo {\n  return {\n    ...player,\n    name: [\"玩家\", \"下家\", \"对家\", \"上家\"][get_position(idx, S.player_idx)],\n    info: get_player_info(player, G, S),\n    selected: (G.phase == \"action\") && (idx == G.active_player_idx),\n  };\n}\n\nfunction GameBoard(props: BoardProps){\n  const add_ai = () => {\n    let dream_count = props.S.dream_count + 1;\n    if (dream_count % 3 == 2) {\n      alert(\"增加了一个AI\");\n      props.moves.set_ai_players(Math.ceil(dream_count / 3));\n    }\n    props.actions.enter_dream();\n  }\n\n  return <div className=\"board\">\n    <Central \n      players = {reorder(props.G.players.map((player, idx) => process_player(player, idx, props.G, props.S)), [(props.S.player_idx+2)%4,(props.S.player_idx+3)%4,(props.S.player_idx+1)%4,props.S.player_idx])}\n    />\n    <InfoPanel log={(props.G.phase == \"place\")? props.S.log : props.G.gamelogs[0]} handleClick={() => alert(props.G.gamelogs)} />\n    {/* <InfoPanel log=\"这是一条log\" /> */}\n    {/* <InfoPanel log={props.S.log} /> */}\n    {/* <InfoPanel log={props.G.gamelog} /> */}\n    <Controller \n      operations = {get_operations(props.G, props.S)}\n      combined = {props.combined}\n      G = {props.G}\n    />\n    <CardRow \n      cards = {props.G.players[props.S.player_idx].hand.map(hand_processor(props.S))}  \n      handleCardClick = {idx => () => props.actions.select_hand(idx, props.G.players[props.S.player_idx])}\n    />\n    <TopPanel gameCount={`${\"東南西北\"[Math.floor(props.G.round/4)]}${props.G.round % 4 + 1}局`} checkGoal={()=>props.actions.change_board(\"GoalBoard\")} addAI={add_ai} />\n  </div>;\n}\n\nfunction Goal(props: {goal: Partial<ICard>, illust?: string, selected?: boolean}) {\n  let goal_illust = (props.goal.is_public == true)? \"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/263/green-salad_1f957.png\":goal_illust_src;\n  if (props.illust) {\n    goal_illust = props.illust;\n  }\n  return <div className=\"goal\">\n    <div className=\"goal-illust-container\" style={{border: (props.selected)?\"3px solid #52c41a\":undefined}}>\n      <img className=\"goal-illust\" src={goal_illust} />\n    </div>\n    <div className=\"goal-desc-container\">\n      {/*props.goal.name <br/> props.goal.desc*/}\n      <div className=\"goal-desc\">\n        {props.goal.name}<br/>\n        {props.goal.desc}\n      </div>\n    </div>\n  </div>;\n}\n\nfunction process_public_goal(desc: string|EL): EL {\n  let fruits_lookup: Record<string, EL> = {A:FRUITS[0], B:FRUITS[1], C:FRUITS[2]};\n  return (desc as string).split(\"\").map(char => fruits_lookup[char]?fruits_lookup[char]:char);\n}\n\nfunction GoalBoard(props: BoardProps) {\n  // console.log(\"All publics:\", props.G.public_goals);\n  // console.log(\"Unachieved:\", props.G.public_goals.filter(goal => !goal.is_achieved));\n  return <div className=\"board\">\n    <div className=\"goals-container\">\n      {props.G.public_goals.filter(goal => !goal.is_achieved).map(goal => <Goal goal={{name: goal.name, desc:process_public_goal(goal.desc), is_public:goal.is_public}} />)}\n      {props.G.players[props.S.player_idx].goals.map(goal => <Goal goal={{name: goal.name, desc:goal.desc, is_public:goal.is_public}}/>)}\n    </div>\n    <button className=\"gb-back-button\" onClick={() => props.actions.change_board(\"GameBoard\")} >返回</button>\n  </div>;\n}\n\nfunction FinalBoard(props: BoardProps) {\n  return <div className=\"board\">\n    <div className=\"goals-container\">\n      {/* {props.G.public_goals.filter(goal => !goal.is_achieved).map(goal => <Goal goal={{name: goal.name, desc:process_public_goal(goal.desc), is_public:goal.is_public}} />)} */}\n      {/* {props.G.players[props.S.player_idx].goals.map(goal => <Goal goal={{name: goal.name, desc:goal.desc, is_public:goal.is_public}}/>)} */}\n      {props.G.players.map(p => ({...p})).sort((a,b)=>b.score-a.score).map((player, idx) => <Goal goal={{name: `${idx+1}位`, desc: `${player.score}分`}} illust={player.illust} selected={player.illust == props.G.players[props.S.player_idx].illust} />)}\n    </div>\n    {/* <button className=\"gb-back-button\" onClick={() => props.actions.change_board(\"GameBoard\")} >返回</button> */}\n  </div>;\n}\n\nconst BOARDS: Record<string, (props:BoardProps)=>JSX.Element> = {\n  GameBoard,\n  GoalBoard,\n  FinalBoard,\n};\n\nexport function Board(props: BGBoardProps<IGame>) {\n  let [S, setS] = useState<IState>(init_state);\n  let actions = map_object<Action, Dispatcher>(\n    action => (...args: any[]) => setS(produce(S => action(S, ...args))), \n    ACTIONS,\n  );\n  let combined = map_object<CombinedAction, Dispatcher>(\n    action => (...args: any[]) => action(props.moves, actions, ...args),\n    COMBINED,\n  );\n  let {G, ctx, moves} = props;\n  let board_props: BoardProps = {\n    G, ctx, moves, S, actions, combined,\n  };\n\n  // Show hand info\n  // Don't use useEffect to change the log, a strange bug may happen\n  // useEffect(()=>{\n  //   if (S.hand_selected != undefined) {\n  //     let card = G.players[S.player_idx].hand[S.hand_selected];\n  //     actions.log_msg(`${card.name}: ${card.desc}`);\n  //   }\n  //   else {\n  //     return;\n  //   }\n  // }, [S.hand_selected]);\n\n  // Show game info\n  // useEffect(() => actions.log_msg(G.gamelog), [G.gamelog]);\n\n  useEffect(() => {\n    if (G.phase == \"place\" && G.ai_players.length != 4) {\n      actions.change_board(\"GoalBoard\");\n    }\n  }, [G.phase]);\n\n  useEffect(() => {\n    setS({...S, player_idx: parseInt(props.playerID || \"0\")});\n    console.log({...props});\n    console.log(`The player ID is: ${props.playerID}`);\n    let is_host = props.playerID == props.G.host + \"\";\n    if (is_host || (props.playerID == undefined)) {\n      console.log(\"This guy is host\");\n      props.moves.setup_scenario(Date());\n    }\n  }, []);\n\n  //@ts-ignore\n  // useEffect(() => {if (props.S && props.S.ai_players) props.moves.set_ai_players(props.S.ai_players)}, []);\n\n  useEffect(() => {\n    if (props.G.round >= 12 || props.G.players.find(x => x.score >= 12) != undefined) {\n      actions.change_board(\"FinalBoard\");\n    }\n  }, [props.G.round]);\n\n  useEffect(()=>{\n    console.log(\"Num places:\", props.G.num_places);\n    if (props.G.ai_players.length == 4 && props.G.phase == \"place\") {\n      console.log(\"Auto place cards\");\n      setTimeout(() => {\n        combined.ai_moves();\n        console.log(\"Placed\");\n      }, 1000);\n    }\n  }, [props.G.ai_players, props.G.num_places]);\n\n  let board: (props:BoardProps) => JSX.Element = BOARDS[S.board] || GameBoard;\n  // let board = GoalBoard;\n\n  return board(board_props);\n}\n\n","import React from 'react';\nimport './Board.css';\nimport './Title.css';\n\ninterface ITitleOperation {\n  name: string,\n  effect?: () => void,\n}\n\nexport const TitleScreen = (props: {title: string, operations: ITitleOperation[], titleImg?: string, dadiao?: boolean}) => (\n  <div className=\"board\">\n  <div className=\"title-block\">\n    <div className=\"title-img-container\">\n      <img className=\"title-img\" src={props.titleImg} />\n    </div>\n    <h2 className=\"title\" >{props.title}</h2>\n    <div style={{display: (props.dadiao)?undefined : \"none\"}} >\n      制作: <a href=\"https://space.bilibili.com/8492192/dynamic/\" className=\"title-a\">大雕游戏</a>\n    </div>\n    {props.operations.map(operation => <span><button className=\"title-screen-button primary\" onClick={operation.effect}>{operation.name}</button><br/></span>)}\n  </div>\n  </div>\n);","export const AVATARS = \n[[\"罗宾\", \"http://prts.wiki/images/1/1f/%E5%A4%B4%E5%83%8F_%E7%BD%97%E5%AE%BE.png\"],\n[\"卡夫卡\", \"http://prts.wiki/images/8/8d/%E5%A4%B4%E5%83%8F_%E5%8D%A1%E5%A4%AB%E5%8D%A1.png\"],\n[\"山\", \"http://prts.wiki/images/e/ec/%E5%A4%B4%E5%83%8F_%E5%B1%B1.png\"],\n[\"松果\", \"http://prts.wiki/images/5/5e/%E5%A4%B4%E5%83%8F_%E6%9D%BE%E6%9E%9C.png\"],\n[\"阿米娅(近卫)\", \"http://prts.wiki/images/5/5b/%E5%A4%B4%E5%83%8F_%E9%98%BF%E7%B1%B3%E5%A8%85%28%E8%BF%91%E5%8D%AB%29.png\"],\n[\"迷迭香\", \"http://prts.wiki/images/3/3b/%E5%A4%B4%E5%83%8F_%E8%BF%B7%E8%BF%AD%E9%A6%99.png\"],\n[\"泥岩\", \"http://prts.wiki/images/0/06/%E5%A4%B4%E5%83%8F_%E6%B3%A5%E5%B2%A9.png\"],\n[\"絮雨\", \"http://prts.wiki/images/3/34/%E5%A4%B4%E5%83%8F_%E7%B5%AE%E9%9B%A8.png\"],\n[\"杰克\", \"http://prts.wiki/images/d/d8/%E5%A4%B4%E5%83%8F_%E6%9D%B0%E5%85%8B.png\"],\n[\"瑕光\", \"http://prts.wiki/images/f/f7/%E5%A4%B4%E5%83%8F_%E7%91%95%E5%85%89.png\"],\n[\"奥斯塔\", \"http://prts.wiki/images/4/49/%E5%A4%B4%E5%83%8F_%E5%A5%A5%E6%96%AF%E5%A1%94.png\"],\n[\"鞭刃\", \"http://prts.wiki/images/f/f8/%E5%A4%B4%E5%83%8F_%E9%9E%AD%E5%88%83.png\"],\n[\"泡泡\", \"http://prts.wiki/images/2/28/%E5%A4%B4%E5%83%8F_%E6%B3%A1%E6%B3%A1.png\"],\n[\"史尔特尔\", \"http://prts.wiki/images/e/e1/%E5%A4%B4%E5%83%8F_%E5%8F%B2%E5%B0%94%E7%89%B9%E5%B0%94.png\"],\n[\"四月\", \"http://prts.wiki/images/d/d3/%E5%A4%B4%E5%83%8F_%E5%9B%9B%E6%9C%88.png\"],\n[\"薄绿\", \"http://prts.wiki/images/3/30/%E5%A4%B4%E5%83%8F_%E8%96%84%E7%BB%BF.png\"],\n[\"芳汀\", \"http://prts.wiki/images/6/6a/%E5%A4%B4%E5%83%8F_%E8%8A%B3%E6%B1%80.png\"],\n[\"森蚺\", \"http://prts.wiki/images/7/74/%E5%A4%B4%E5%83%8F_%E6%A3%AE%E8%9A%BA.png\"],\n[\"燧石\", \"http://prts.wiki/images/a/ac/%E5%A4%B4%E5%83%8F_%E7%87%A7%E7%9F%B3.png\"],\n[\"特米米\", \"http://prts.wiki/images/b/b9/%E5%A4%B4%E5%83%8F_%E7%89%B9%E7%B1%B3%E7%B1%B3.png\"],\n[\"酸糖\", \"http://prts.wiki/images/e/e9/%E5%A4%B4%E5%83%8F_%E9%85%B8%E7%B3%96.png\"],\n[\"棘刺\", \"http://prts.wiki/images/2/2a/%E5%A4%B4%E5%83%8F_%E6%A3%98%E5%88%BA.png\"],\n[\"安哲拉\", \"http://prts.wiki/images/3/36/%E5%A4%B4%E5%83%8F_%E5%AE%89%E5%93%B2%E6%8B%89.png\"],\n[\"孑\", \"http://prts.wiki/images/5/54/%E5%A4%B4%E5%83%8F_%E5%AD%91.png\"],\n[\"贾维\", \"http://prts.wiki/images/2/2a/%E5%A4%B4%E5%83%8F_%E8%B4%BE%E7%BB%B4.png\"],\n[\"蜜蜡\", \"http://prts.wiki/images/1/1d/%E5%A4%B4%E5%83%8F_%E8%9C%9C%E8%9C%A1.png\"],\n[\"稀音\", \"http://prts.wiki/images/c/c6/%E5%A4%B4%E5%83%8F_%E7%A8%80%E9%9F%B3.png\"],\n[\"铃兰\", \"http://prts.wiki/images/5/55/%E5%A4%B4%E5%83%8F_%E9%93%83%E5%85%B0.png\"],\n[\"断崖\", \"http://prts.wiki/images/e/ea/%E5%A4%B4%E5%83%8F_%E6%96%AD%E5%B4%96.png\"],\n[\"亚叶\", \"http://prts.wiki/images/b/b5/%E5%A4%B4%E5%83%8F_%E4%BA%9A%E5%8F%B6.png\"],\n[\"卡达\", \"http://prts.wiki/images/4/43/%E5%A4%B4%E5%83%8F_%E5%8D%A1%E8%BE%BE.png\"],\n[\"早露\", \"http://prts.wiki/images/6/63/%E5%A4%B4%E5%83%8F_%E6%97%A9%E9%9C%B2.png\"],\n[\"莱恩哈特\", \"http://prts.wiki/images/0/03/%E5%A4%B4%E5%83%8F_%E8%8E%B1%E6%81%A9%E5%93%88%E7%89%B9.png\"],\n[\"苦艾\", \"http://prts.wiki/images/e/e9/%E5%A4%B4%E5%83%8F_%E8%8B%A6%E8%89%BE.png\"],\n[\"波登可\", \"http://prts.wiki/images/4/43/%E5%A4%B4%E5%83%8F_%E6%B3%A2%E7%99%BB%E5%8F%AF.png\"],\n[\"月禾\", \"http://prts.wiki/images/b/b6/%E5%A4%B4%E5%83%8F_%E6%9C%88%E7%A6%BE.png\"],\n[\"石棉\", \"http://prts.wiki/images/1/18/%E5%A4%B4%E5%83%8F_%E7%9F%B3%E6%A3%89.png\"],\n[\"W\", \"http://prts.wiki/images/d/d6/%E5%A4%B4%E5%83%8F_W.png\"],\n[\"温蒂\", \"http://prts.wiki/images/9/93/%E5%A4%B4%E5%83%8F_%E6%B8%A9%E8%92%82.png\"],\n[\"极境\", \"http://prts.wiki/images/9/97/%E5%A4%B4%E5%83%8F_%E6%9E%81%E5%A2%83.png\"],\n[\"THRM-EX\", \"http://prts.wiki/images/d/d8/%E5%A4%B4%E5%83%8F_THRM-EX.png\"],\n[\"傀影\", \"http://prts.wiki/images/8/83/%E5%A4%B4%E5%83%8F_%E5%82%80%E5%BD%B1.png\"],\n[\"巫恋\", \"http://prts.wiki/images/3/36/%E5%A4%B4%E5%83%8F_%E5%B7%AB%E6%81%8B.png\"],\n[\"铸铁\", \"http://prts.wiki/images/8/84/%E5%A4%B4%E5%83%8F_%E9%93%B8%E9%93%81.png\"],\n[\"刻刀\", \"http://prts.wiki/images/2/2c/%E5%A4%B4%E5%83%8F_%E5%88%BB%E5%88%80.png\"],\n[\"断罪者\", \"http://prts.wiki/images/f/f2/%E5%A4%B4%E5%83%8F_%E6%96%AD%E7%BD%AA%E8%80%85.png\"],\n[\"风笛\", \"http://prts.wiki/images/d/de/%E5%A4%B4%E5%83%8F_%E9%A3%8E%E7%AC%9B.png\"],\n[\"慑砂\", \"http://prts.wiki/images/e/e7/%E5%A4%B4%E5%83%8F_%E6%85%91%E7%A0%82.png\"],\n[\"柏喙\", \"http://prts.wiki/images/2/2f/%E5%A4%B4%E5%83%8F_%E6%9F%8F%E5%96%99.png\"],\n[\"宴\", \"http://prts.wiki/images/f/f4/%E5%A4%B4%E5%83%8F_%E5%AE%B4.png\"],\n[\"清流\", \"http://prts.wiki/images/1/19/%E5%A4%B4%E5%83%8F_%E6%B8%85%E6%B5%81.png\"],\n[\"刻俄柏\", \"http://prts.wiki/images/4/4a/%E5%A4%B4%E5%83%8F_%E5%88%BB%E4%BF%84%E6%9F%8F.png\"],\n[\"惊蛰\", \"http://prts.wiki/images/8/81/%E5%A4%B4%E5%83%8F_%E6%83%8A%E8%9B%B0.png\"],\n[\"年\", \"http://prts.wiki/images/9/9c/%E5%A4%B4%E5%83%8F_%E5%B9%B4.png\"],\n[\"阿\", \"http://prts.wiki/images/3/31/%E5%A4%B4%E5%83%8F_%E9%98%BF.png\"],\n[\"吽\", \"http://prts.wiki/images/4/41/%E5%A4%B4%E5%83%8F_%E5%90%BD.png\"],\n[\"雪雉\", \"http://prts.wiki/images/2/24/%E5%A4%B4%E5%83%8F_%E9%9B%AA%E9%9B%89.png\"],\n[\"煌\", \"http://prts.wiki/images/3/30/%E5%A4%B4%E5%83%8F_%E7%85%8C.png\"],\n[\"灰喉\", \"http://prts.wiki/images/3/3b/%E5%A4%B4%E5%83%8F_%E7%81%B0%E5%96%89.png\"],\n[\"安比尔\", \"http://prts.wiki/images/f/ff/%E5%A4%B4%E5%83%8F_%E5%AE%89%E6%AF%94%E5%B0%94.png\"],\n[\"布洛卡\", \"http://prts.wiki/images/0/04/%E5%A4%B4%E5%83%8F_%E5%B8%83%E6%B4%9B%E5%8D%A1.png\"],\n[\"苇草\", \"http://prts.wiki/images/7/7a/%E5%A4%B4%E5%83%8F_%E8%8B%87%E8%8D%89.png\"],\n[\"莫斯提马\", \"http://prts.wiki/images/0/0b/%E5%A4%B4%E5%83%8F_%E8%8E%AB%E6%96%AF%E6%8F%90%E9%A9%AC.png\"],\n[\"槐琥\", \"http://prts.wiki/images/e/ed/%E5%A4%B4%E5%83%8F_%E6%A7%90%E7%90%A5.png\"],\n[\"拜松\", \"http://prts.wiki/images/b/b2/%E5%A4%B4%E5%83%8F_%E6%8B%9C%E6%9D%BE.png\"],\n[\"梅\", \"http://prts.wiki/images/a/ac/%E5%A4%B4%E5%83%8F_%E6%A2%85.png\"],\n[\"微风\", \"http://prts.wiki/images/a/ad/%E5%A4%B4%E5%83%8F_%E5%BE%AE%E9%A3%8E.png\"],\n[\"伊桑\", \"http://prts.wiki/images/c/c1/%E5%A4%B4%E5%83%8F_%E4%BC%8A%E6%A1%91.png\"],\n[\"麦哲伦\", \"http://prts.wiki/images/4/4d/%E5%A4%B4%E5%83%8F_%E9%BA%A6%E5%93%B2%E4%BC%A6.png\"],\n[\"送葬人\", \"http://prts.wiki/images/d/da/%E5%A4%B4%E5%83%8F_%E9%80%81%E8%91%AC%E4%BA%BA.png\"],\n[\"炎客\", \"http://prts.wiki/images/d/d6/%E5%A4%B4%E5%83%8F_%E7%82%8E%E5%AE%A2.png\"],\n[\"红云\", \"http://prts.wiki/images/a/af/%E5%A4%B4%E5%83%8F_%E7%BA%A2%E4%BA%91.png\"],\n[\"坚雷\", \"http://prts.wiki/images/a/ab/%E5%A4%B4%E5%83%8F_%E5%9D%9A%E9%9B%B7.png\"],\n[\"赫拉格\", \"http://prts.wiki/images/c/cd/%E5%A4%B4%E5%83%8F_%E8%B5%AB%E6%8B%89%E6%A0%BC.png\"],\n[\"星极\", \"http://prts.wiki/images/e/ee/%E5%A4%B4%E5%83%8F_%E6%98%9F%E6%9E%81.png\"],\n[\"桃金娘\", \"http://prts.wiki/images/9/9d/%E5%A4%B4%E5%83%8F_%E6%A1%83%E9%87%91%E5%A8%98.png\"],\n[\"黑\", \"http://prts.wiki/images/d/d4/%E5%A4%B4%E5%83%8F_%E9%BB%91.png\"],\n[\"格劳克斯\", \"http://prts.wiki/images/5/53/%E5%A4%B4%E5%83%8F_%E6%A0%BC%E5%8A%B3%E5%85%8B%E6%96%AF.png\"],\n[\"锡兰\", \"http://prts.wiki/images/3/39/%E5%A4%B4%E5%83%8F_%E9%94%A1%E5%85%B0.png\"],\n[\"苏苏洛\", \"http://prts.wiki/images/6/63/%E5%A4%B4%E5%83%8F_%E8%8B%8F%E8%8B%8F%E6%B4%9B.png\"],\n[\"陈\", \"http://prts.wiki/images/c/cf/%E5%A4%B4%E5%83%8F_%E9%99%88.png\"],\n[\"诗怀雅\", \"http://prts.wiki/images/5/50/%E5%A4%B4%E5%83%8F_%E8%AF%97%E6%80%80%E9%9B%85.png\"],\n[\"格雷伊\", \"http://prts.wiki/images/f/fe/%E5%A4%B4%E5%83%8F_%E6%A0%BC%E9%9B%B7%E4%BC%8A.png\"],\n[\"斑点\", \"http://prts.wiki/images/3/30/%E5%A4%B4%E5%83%8F_%E6%96%91%E7%82%B9.png\"],\n[\"泡普卡\", \"http://prts.wiki/images/1/16/%E5%A4%B4%E5%83%8F_%E6%B3%A1%E6%99%AE%E5%8D%A1.png\"],\n[\"斯卡蒂\", \"http://prts.wiki/images/5/53/%E5%A4%B4%E5%83%8F_%E6%96%AF%E5%8D%A1%E8%92%82.png\"],\n[\"格拉尼\", \"http://prts.wiki/images/2/29/%E5%A4%B4%E5%83%8F_%E6%A0%BC%E6%8B%89%E5%B0%BC.png\"],\n[\"夜魔\", \"http://prts.wiki/images/a/a7/%E5%A4%B4%E5%83%8F_%E5%A4%9C%E9%AD%94.png\"],\n[\"猎蜂\", \"http://prts.wiki/images/c/c2/%E5%A4%B4%E5%83%8F_%E7%8C%8E%E8%9C%82.png\"],\n[\"月见夜\", \"http://prts.wiki/images/b/b7/%E5%A4%B4%E5%83%8F_%E6%9C%88%E8%A7%81%E5%A4%9C.png\"],\n[\"空爆\", \"http://prts.wiki/images/c/cd/%E5%A4%B4%E5%83%8F_%E7%A9%BA%E7%88%86.png\"],\n[\"暴行\", \"http://prts.wiki/images/3/36/%E5%A4%B4%E5%83%8F_%E6%9A%B4%E8%A1%8C.png\"],\n[\"银灰\", \"http://prts.wiki/images/2/27/%E5%A4%B4%E5%83%8F_%E9%93%B6%E7%81%B0.png\"],\n[\"塞雷娅\", \"http://prts.wiki/images/e/ee/%E5%A4%B4%E5%83%8F_%E5%A1%9E%E9%9B%B7%E5%A8%85.png\"],\n[\"星熊\", \"http://prts.wiki/images/0/07/%E5%A4%B4%E5%83%8F_%E6%98%9F%E7%86%8A.png\"],\n[\"夜莺\", \"http://prts.wiki/images/6/64/%E5%A4%B4%E5%83%8F_%E5%A4%9C%E8%8E%BA.png\"],\n[\"闪灵\", \"http://prts.wiki/images/5/54/%E5%A4%B4%E5%83%8F_%E9%97%AA%E7%81%B5.png\"],\n[\"安洁莉娜\", \"http://prts.wiki/images/c/ca/%E5%A4%B4%E5%83%8F_%E5%AE%89%E6%B4%81%E8%8E%89%E5%A8%9C.png\"],\n[\"艾雅法拉\", \"http://prts.wiki/images/c/cc/%E5%A4%B4%E5%83%8F_%E8%89%BE%E9%9B%85%E6%B3%95%E6%8B%89.png\"],\n[\"伊芙利特\", \"http://prts.wiki/images/e/ed/%E5%A4%B4%E5%83%8F_%E4%BC%8A%E8%8A%99%E5%88%A9%E7%89%B9.png\"],\n[\"推进之王\", \"http://prts.wiki/images/b/ba/%E5%A4%B4%E5%83%8F_%E6%8E%A8%E8%BF%9B%E4%B9%8B%E7%8E%8B.png\"],\n[\"能天使\", \"http://prts.wiki/images/a/ad/%E5%A4%B4%E5%83%8F_%E8%83%BD%E5%A4%A9%E4%BD%BF.png\"],\n[\"食铁兽\", \"http://prts.wiki/images/d/dd/%E5%A4%B4%E5%83%8F_%E9%A3%9F%E9%93%81%E5%85%BD.png\"],\n[\"狮蝎\", \"http://prts.wiki/images/c/c5/%E5%A4%B4%E5%83%8F_%E7%8B%AE%E8%9D%8E.png\"],\n[\"空\", \"http://prts.wiki/images/5/58/%E5%A4%B4%E5%83%8F_%E7%A9%BA.png\"],\n[\"真理\", \"http://prts.wiki/images/e/e6/%E5%A4%B4%E5%83%8F_%E7%9C%9F%E7%90%86.png\"],\n[\"初雪\", \"http://prts.wiki/images/d/d7/%E5%A4%B4%E5%83%8F_%E5%88%9D%E9%9B%AA.png\"],\n[\"崖心\", \"http://prts.wiki/images/7/7d/%E5%A4%B4%E5%83%8F_%E5%B4%96%E5%BF%83.png\"],\n[\"守林人\", \"http://prts.wiki/images/2/27/%E5%A4%B4%E5%83%8F_%E5%AE%88%E6%9E%97%E4%BA%BA.png\"],\n[\"普罗旺斯\", \"http://prts.wiki/images/7/72/%E5%A4%B4%E5%83%8F_%E6%99%AE%E7%BD%97%E6%97%BA%E6%96%AF.png\"],\n[\"火神\", \"http://prts.wiki/images/f/f1/%E5%A4%B4%E5%83%8F_%E7%81%AB%E7%A5%9E.png\"],\n[\"可颂\", \"http://prts.wiki/images/a/ab/%E5%A4%B4%E5%83%8F_%E5%8F%AF%E9%A2%82.png\"],\n[\"雷蛇\", \"http://prts.wiki/images/f/f5/%E5%A4%B4%E5%83%8F_%E9%9B%B7%E8%9B%87.png\"],\n[\"红\", \"http://prts.wiki/images/a/ac/%E5%A4%B4%E5%83%8F_%E7%BA%A2.png\"],\n[\"临光\", \"http://prts.wiki/images/1/1a/%E5%A4%B4%E5%83%8F_%E4%B8%B4%E5%85%89.png\"],\n[\"华法琳\", \"http://prts.wiki/images/3/30/%E5%A4%B4%E5%83%8F_%E5%8D%8E%E6%B3%95%E7%90%B3.png\"],\n[\"赫默\", \"http://prts.wiki/images/3/39/%E5%A4%B4%E5%83%8F_%E8%B5%AB%E9%BB%98.png\"],\n[\"梅尔\", \"http://prts.wiki/images/0/07/%E5%A4%B4%E5%83%8F_%E6%A2%85%E5%B0%94.png\"],\n[\"天火\", \"http://prts.wiki/images/f/fa/%E5%A4%B4%E5%83%8F_%E5%A4%A9%E7%81%AB.png\"],\n[\"阿米娅\", \"http://prts.wiki/images/3/36/%E5%A4%B4%E5%83%8F_%E9%98%BF%E7%B1%B3%E5%A8%85.png\"],\n[\"陨星\", \"http://prts.wiki/images/e/ea/%E5%A4%B4%E5%83%8F_%E9%99%A8%E6%98%9F.png\"],\n[\"白金\", \"http://prts.wiki/images/3/3b/%E5%A4%B4%E5%83%8F_%E7%99%BD%E9%87%91.png\"],\n[\"蓝毒\", \"http://prts.wiki/images/6/63/%E5%A4%B4%E5%83%8F_%E8%93%9D%E6%AF%92.png\"],\n[\"幽灵鲨\", \"http://prts.wiki/images/2/28/%E5%A4%B4%E5%83%8F_%E5%B9%BD%E7%81%B5%E9%B2%A8.png\"],\n[\"拉普兰德\", \"http://prts.wiki/images/b/bf/%E5%A4%B4%E5%83%8F_%E6%8B%89%E6%99%AE%E5%85%B0%E5%BE%B7.png\"],\n[\"因陀罗\", \"http://prts.wiki/images/f/fe/%E5%A4%B4%E5%83%8F_%E5%9B%A0%E9%99%80%E7%BD%97.png\"],\n[\"芙兰卡\", \"http://prts.wiki/images/2/2b/%E5%A4%B4%E5%83%8F_%E8%8A%99%E5%85%B0%E5%8D%A1.png\"],\n[\"德克萨斯\", \"http://prts.wiki/images/5/57/%E5%A4%B4%E5%83%8F_%E5%BE%B7%E5%85%8B%E8%90%A8%E6%96%AF.png\"],\n[\"凛冬\", \"http://prts.wiki/images/c/cd/%E5%A4%B4%E5%83%8F_%E5%87%9B%E5%86%AC.png\"],\n[\"白面鸮\", \"http://prts.wiki/images/8/83/%E5%A4%B4%E5%83%8F_%E7%99%BD%E9%9D%A2%E9%B8%AE.png\"],\n[\"阿消\", \"http://prts.wiki/images/2/2f/%E5%A4%B4%E5%83%8F_%E9%98%BF%E6%B6%88.png\"],\n[\"地灵\", \"http://prts.wiki/images/5/57/%E5%A4%B4%E5%83%8F_%E5%9C%B0%E7%81%B5.png\"],\n[\"深海色\", \"http://prts.wiki/images/d/d1/%E5%A4%B4%E5%83%8F_%E6%B7%B1%E6%B5%B7%E8%89%B2.png\"],\n[\"古米\", \"http://prts.wiki/images/0/07/%E5%A4%B4%E5%83%8F_%E5%8F%A4%E7%B1%B3.png\"],\n[\"蛇屠箱\", \"http://prts.wiki/images/0/02/%E5%A4%B4%E5%83%8F_%E8%9B%87%E5%B1%A0%E7%AE%B1.png\"],\n[\"角峰\", \"http://prts.wiki/images/e/e4/%E5%A4%B4%E5%83%8F_%E8%A7%92%E5%B3%B0.png\"],\n[\"调香师\", \"http://prts.wiki/images/6/6a/%E5%A4%B4%E5%83%8F_%E8%B0%83%E9%A6%99%E5%B8%88.png\"],\n[\"嘉维尔\", \"http://prts.wiki/images/c/cc/%E5%A4%B4%E5%83%8F_%E5%98%89%E7%BB%B4%E5%B0%94.png\"],\n[\"末药\", \"http://prts.wiki/images/d/d9/%E5%A4%B4%E5%83%8F_%E6%9C%AB%E8%8D%AF.png\"],\n[\"暗索\", \"http://prts.wiki/images/d/dd/%E5%A4%B4%E5%83%8F_%E6%9A%97%E7%B4%A2.png\"],\n[\"砾\", \"http://prts.wiki/images/c/ce/%E5%A4%B4%E5%83%8F_%E7%A0%BE.png\"],\n[\"慕斯\", \"http://prts.wiki/images/f/fc/%E5%A4%B4%E5%83%8F_%E6%85%95%E6%96%AF.png\"],\n[\"艾丝黛尔\", \"http://prts.wiki/images/5/57/%E5%A4%B4%E5%83%8F_%E8%89%BE%E4%B8%9D%E9%BB%9B%E5%B0%94.png\"],\n[\"霜叶\", \"http://prts.wiki/images/2/29/%E5%A4%B4%E5%83%8F_%E9%9C%9C%E5%8F%B6.png\"],\n[\"缠丸\", \"http://prts.wiki/images/1/13/%E5%A4%B4%E5%83%8F_%E7%BC%A0%E4%B8%B8.png\"],\n[\"杜宾\", \"http://prts.wiki/images/a/a1/%E5%A4%B4%E5%83%8F_%E6%9D%9C%E5%AE%BE.png\"],\n[\"红豆\", \"http://prts.wiki/images/b/bb/%E5%A4%B4%E5%83%8F_%E7%BA%A2%E8%B1%86.png\"],\n[\"清道夫\", \"http://prts.wiki/images/6/63/%E5%A4%B4%E5%83%8F_%E6%B8%85%E9%81%93%E5%A4%AB.png\"],\n[\"讯使\", \"http://prts.wiki/images/2/27/%E5%A4%B4%E5%83%8F_%E8%AE%AF%E4%BD%BF.png\"],\n[\"白雪\", \"http://prts.wiki/images/b/b4/%E5%A4%B4%E5%83%8F_%E7%99%BD%E9%9B%AA.png\"],\n[\"流星\", \"http://prts.wiki/images/1/14/%E5%A4%B4%E5%83%8F_%E6%B5%81%E6%98%9F.png\"],\n[\"杰西卡\", \"http://prts.wiki/images/6/63/%E5%A4%B4%E5%83%8F_%E6%9D%B0%E8%A5%BF%E5%8D%A1.png\"],\n[\"远山\", \"http://prts.wiki/images/6/63/%E5%A4%B4%E5%83%8F_%E8%BF%9C%E5%B1%B1.png\"],\n[\"夜烟\", \"http://prts.wiki/images/5/55/%E5%A4%B4%E5%83%8F_%E5%A4%9C%E7%83%9F.png\"],\n[\"梓兰\", \"http://prts.wiki/images/8/83/%E5%A4%B4%E5%83%8F_%E6%A2%93%E5%85%B0.png\"],\n[\"史都华德\", \"http://prts.wiki/images/b/b3/%E5%A4%B4%E5%83%8F_%E5%8F%B2%E9%83%BD%E5%8D%8E%E5%BE%B7.png\"],\n[\"安赛尔\", \"http://prts.wiki/images/9/94/%E5%A4%B4%E5%83%8F_%E5%AE%89%E8%B5%9B%E5%B0%94.png\"],\n[\"芙蓉\", \"http://prts.wiki/images/d/d3/%E5%A4%B4%E5%83%8F_%E8%8A%99%E8%93%89.png\"],\n[\"炎熔\", \"http://prts.wiki/images/f/fb/%E5%A4%B4%E5%83%8F_%E7%82%8E%E7%86%94.png\"],\n[\"安德切尔\", \"http://prts.wiki/images/f/f6/%E5%A4%B4%E5%83%8F_%E5%AE%89%E5%BE%B7%E5%88%87%E5%B0%94.png\"],\n[\"克洛丝\", \"http://prts.wiki/images/b/b9/%E5%A4%B4%E5%83%8F_%E5%85%8B%E6%B4%9B%E4%B8%9D.png\"],\n[\"米格鲁\", \"http://prts.wiki/images/3/32/%E5%A4%B4%E5%83%8F_%E7%B1%B3%E6%A0%BC%E9%B2%81.png\"],\n[\"卡缇\", \"http://prts.wiki/images/8/87/%E5%A4%B4%E5%83%8F_%E5%8D%A1%E7%BC%87.png\"],\n[\"玫兰莎\", \"http://prts.wiki/images/4/4b/%E5%A4%B4%E5%83%8F_%E7%8E%AB%E5%85%B0%E8%8E%8E.png\"],\n[\"翎羽\", \"http://prts.wiki/images/1/1f/%E5%A4%B4%E5%83%8F_%E7%BF%8E%E7%BE%BD.png\"],\n[\"香草\", \"http://prts.wiki/images/c/c8/%E5%A4%B4%E5%83%8F_%E9%A6%99%E8%8D%89.png\"],\n[\"芬\", \"http://prts.wiki/images/4/41/%E5%A4%B4%E5%83%8F_%E8%8A%AC.png\"],\n[\"12F\", \"http://prts.wiki/images/b/b7/%E5%A4%B4%E5%83%8F_12F.png\"],\n[\"杜林\", \"http://prts.wiki/images/2/24/%E5%A4%B4%E5%83%8F_%E6%9D%9C%E6%9E%97.png\"],\n[\"巡林者\", \"http://prts.wiki/images/9/93/%E5%A4%B4%E5%83%8F_%E5%B7%A1%E6%9E%97%E8%80%85.png\"],\n[\"黑角\", \"http://prts.wiki/images/f/f1/%E5%A4%B4%E5%83%8F_%E9%BB%91%E8%A7%92.png\"],\n[\"夜刀\", \"http://prts.wiki/images/b/b2/%E5%A4%B4%E5%83%8F_%E5%A4%9C%E5%88%80.png\"],\n[\"Castle-3\", \"http://prts.wiki/images/8/82/%E5%A4%B4%E5%83%8F_Castle-3.png\"],];","import React, { useState, useEffect } from 'react';\nimport _ from 'lodash';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport './Board.css';\nimport './Lobby.css';\nimport { AVATARS } from './avatars';\nimport { rand } from './utils';\nimport { SocketIO } from 'boardgame.io/dist/types/packages/multiplayer';\n\nconst NUM_PLAYERS = 4;\n\n// const API = \"localhost:3050\";\nconst API = \"47.96.2.148:3050\";\n\n// EH: Client and server should be communicated in a good way, not in this way\ninterface ILobby {\n  player_id: string,\n  rooms: any[],\n  locked: boolean,\n}\n\ninterface IRoomOperation {\n  name?: string,\n  effect?: () => void,\n}\n\ntype Setter = (setter: (L: ILobby) => ILobby) => void;\n\nfunction LobbyAvatar(props:{avatar?: string, is_player?: boolean}) {\n  return <div className=\"lobby-avatar-container\" style={{borderColor: props.is_player?\"#389e0d\":undefined}}>\n    <img className=\"lobby-avatar\" src={props.avatar} />\n  </div>\n}\n\n// align-self\nfunction Room(props:{players: string[], playerID?: string, operation?:IRoomOperation, locked?:boolean}) {\n  return <div className=\"room\">\n    {props.players.map(p => <LobbyAvatar is_player={p==props.playerID} avatar={get_avatar(p)} />)}\n    <button className=\"room-btn\" style={{display:(props.operation == undefined || props.locked)?\"none\":undefined}} onClick={props.operation && props.operation.effect} >{props.operation && props.operation.name}</button>\n  </div>\n}\n\nfunction get_avatar(pid:string): string {\n  let len = AVATARS.length;\n  return AVATARS[Math.floor(rand(pid)*len)][1];\n}\n\nfunction fetch_rooms(setter: (setter_function: (L: ILobby) => ILobby) => void) {\n  let api = `http://${API}/rooms`;\n  fetch(api).then(res => res.json()).then(res => setter(L => ({...L, rooms:res.rooms})));\n}\n\nfunction send_post_req(api:string, data:any) {\n  return fetch(api, {\n    method: \"POST\",\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(data),\n  });\n}\n\nfunction onOperate(setter: Setter) {\n  setter(L => ({...L, locked:true}));\n  // This is not a cool way, but change this needs tons of refractors\n  setTimeout(()=>fetch_rooms(setter), 500);\n}\n\nfunction create_room(player_id: string) {\n  let api = `http://${API}/create`;\n  return send_post_req(api, {player_id, max_players: NUM_PLAYERS});\n}\n\nfunction enter_room(player_id: string, room_id: string) {\n  let api = `http://${API}/enter`;\n  return send_post_req(api, {player_id, room_id});\n}\n\nfunction leave_room(player_id: string, room_id: string) {\n  let api = `http://${API}/leave`;\n  return send_post_req(api, {player_id, room_id});\n}\n\nfunction enter_game(player_id: string, room_id: string) {\n  let api = `http://${API}/entergame`;\n  return send_post_req(api, {player_id, room_id});\n}\n\nfunction leave_lobby(player_id: string) {\n  let api = `http://${API}/leavelobby`;\n  return send_post_req(api, {player_id});\n}\n\nfunction get_room_operation(room: any, player_id: string, player_contained: boolean, setter:Setter) {\n  let player_in_room = room.players.find((x:any) => x.player_id == player_id);\n  if (player_in_room != undefined) {\n    return {name: \"退出\", effect:()=>{leave_room(player_id, room.room_id);onOperate(setter)}};\n  }\n  else {\n    if (player_contained) {\n      return undefined;\n    }\n    else {\n      return {name: \"加入\", effect:()=>{\n        enter_room(player_id, room.room_id);\n        onOperate(setter);\n      }};\n    }\n  }\n}\n\nexport function Lobby(props:{actions:any}) {\n  let [L, setL] = useState<ILobby>({\n    player_id: uuidv4(),\n    rooms: [],\n    locked: false,\n  });\n\n  useEffect(()=>{\n    // setL({...L, player_id: uuidv4()});\n    fetch_rooms(setL);\n    const interval = setInterval(()=>{\n      fetch_rooms(setL);\n      console.log(\"Fetching room from server...\");\n    }, 2500);\n    let exit_lobby = () => {\n      leave_lobby(L.player_id);\n      clearInterval(interval);\n      console.log(`Exit lobby ${L.player_id}`);\n    };\n    window.addEventListener(\"beforeunload\", exit_lobby);\n    return () => {\n      exit_lobby();\n      window.removeEventListener(\"beforeunload\", exit_lobby);\n    }\n  }, []);\n\n  useEffect(() => {\n    let player_room = L.rooms.find(room => room.players.find((p:any) => p.player_id == L.player_id) != undefined);\n    if (player_room && player_room.players.length == NUM_PLAYERS) {\n      let player_idx = player_room.players.map((p:any) => p.player_id).indexOf(L.player_id) + \"\";\n      // enter_game(L.player_id, player_room.room_id);\n      props.actions.enter_game(player_room.room_id, player_idx);\n    }\n  }, [L.rooms]);\n\n  useEffect(() => {\n    if (L.locked) {\n      setTimeout(()=>setL(L=>({...L, locked:false})), 2000);\n    }\n  }, [L.locked]);\n\n  let player_contained = L.rooms.flatMap(room => room.players.map((p:any) => p.player_id)).includes(L.player_id);\n\n  return <div className=\"board\">\n    <div className=\"lobby-player-panel\">\n      <LobbyAvatar avatar={get_avatar(L.player_id)} is_player={true} />\n      <button className=\"room-btn\" style={{display: (player_contained || L.locked)?\"none\":undefined}} onClick={() => setL({...L, player_id:uuidv4()})}>换个形象</button>\n    </div>\n    <div className=\"rooms\">\n      {/* <Room players={[\"1\",\"2\",\"3\"]} operation={{name:\"加入\"}} /> */}\n      {/* .filter(room => room.players.length < NUM_PLAYERS) */}\n      {L.rooms.map(room => <Room players={room.players.map((p:any) => p.player_id)} playerID={L.player_id} operation={get_room_operation(room, L.player_id, player_contained, setL)} locked={L.locked} />)}\n    </div>\n    <div></div>\n    <div style={{display: player_contained?\"none\":undefined}} className=\"lobby-controller\">      \n    <button className=\"lobby-btn\" onClick={()=>props.actions.changer(\"Title\")}>返回</button>\n    <button className=\"lobby-btn\" onClick={()=>{create_room(L.player_id);onOperate(setL);}} >创建房间</button>\n    <button className=\"lobby-btn\" onClick={()=>props.actions.direct_enter()} >重进</button>\n    </div>\n  </div>;\n}\n","// @ts-nocheck\nimport React, { useEffect, useState } from 'react';\nimport { Client } from 'boardgame.io/react';\nimport { Local, SocketIO } from 'boardgame.io/multiplayer';\nimport { LobbyClient } from 'boardgame.io/client'\nimport { CSPR } from './Game';\nimport { Board } from './Board';\nimport { TitleScreen } from './Title';\nimport { Lobby } from './Lobby';\nimport { Dispatcher } from './types';\n\n// const SERVER = SocketIO({server:\"47.96.2.148:8000\"});\nconst SERVER = SocketIO({server:\"localhost:8000\"});\n// const SERVER = Local();\n\ninterface IAppState {\n  scene: string,\n  game_instance: {matchID: string, playerID: string} | undefined,\n  ai_players: number,\n}\n\n// const App = Client({\n//   game: CSPR,\n//   board: Board,\n//   debug: false,\n// });\n\nconst SingleClient = Client({\n  game: CSPR,\n  board: Board,\n  debug: false,\n  // multiplayer: Local(),\n  // multiplayer: SocketIO({server: 'localhost:8000'}),\n\n  numPlayers: 1,\n});\n\n// const App = () => {\n//   return <div style={{display: \"flex\"}}>\n//     <CSPRClient playerID=\"0\" />\n//     {/* <CSPRClient playerID=\"1\" matchID=\"default\" /> */}\n//   </div>\n// };\n\nfunction introduce_gameplay() {\n  alert(\"欢迎来到《雀魂：爆炸一姬》！\\n游戏目标：在8局之后，分数全场最高\\n每盘游戏由8局组成(东1局-南4局)，每局由两个阶段组成：\\n* 扣牌阶段：将1张牌扣到任意一名玩家面前，重复7次；\\n* 翻牌阶段：洗混扣在自己面前的所有牌，然后一张一张地翻开；\\n翻到炸弹时直接出局，翻到护甲时可抵挡一次炸弹，翻到操作牌时则执行其效果，\\\"目标牌\\\"在牌堆最底层，翻开后如果达成目标，就能获得分数；\\n(额外说明：翻牌阶段，如果翻到左上角有水果的操作牌时，则要做出抉择：是将这张牌作为操作还是作为水果)\\n举例：\\n* 东1局，扣牌阶段，一姬的目标是\\\"击杀下家\\\"，因此一姬将一张炸弹扣给了下家\\n* 一姬的下家，二姐，发现别人扣给自己牌，感觉不对，于是将一张\\\"护甲\\\"扣给了自己\\n* 一姬的对家，女仆的目标是\\\"获得柠檬\\\"，因此女仆将手里一张左上角有\\\"柠檬\\\"的牌扣给了自己\\n* 就这样扣了7次之后，所有人洗混了自己面前的牌，进入翻牌阶段\");\n}\n\nconst Title = (props: {actions: any}) => {\n  return <TitleScreen \n    title = \"雀魂: 爆炸一姬\"\n    titleImg = \"https://s3.ax1x.com/2021/02/02/ym9Sln.png\"\n    operations = {[\n      {name: \"单人练习\", effect: () => props.actions.changer(\"SingleClient\")},\n      {name: \"多人运动\", effect: () => props.actions.changer(\"CSPRLobby\")},\n      {name: \"玩法教学\", effect: introduce_gameplay},\n  ]}\n  />;\n};\n\nconst CSPRLobby = (props:any) => {\n  return <Lobby {...props} />;\n}\n\nconst App = () => {\n  let [S, setS] = useState<IAppState>({\n    scene: \"Title\",\n    // in_game: false,\n  });\n\n  const scenes: Record<string, JSX.Element> = {\n    CSPRLobby,\n    Title,\n    SingleClient,\n  }\n\n  const actions: Record<string, Dispatcher> = {\n    changer: (scene: string) => setS({...S, scene}),\n    enter_game: (matchID: string, playerID: string) => {\n      // alert(`对局代码为: ${matchID}${playerID}`);\n      setS({...S, game_instance: {matchID, playerID}});\n    },\n    finish_game: () => setS({...S, game_instance:undefined}),\n    direct_enter: () => {\n      let game_data = prompt(\"输入对局代码:\")\n      let playerID = game_data[4];\n      let matchID = game_data.slice(0,4);\n      let ai_players = game_data[6];\n      setS({...S, game_instance:{matchID, playerID}});\n      if (ai_players) {\n        console.log(\"There are some ai players\");\n        setS({...S, ai_players: parseInt(ai_players)});\n      }\n    },\n  }\n\n  let Scene = scenes[S.scene] || Title;\n  if (S.game_instance != undefined) {\n    let GameInstance = Client({\n      // game: {...CSPR, seed:S.game_instance.matchID},\n      game: CSPR,\n      board: Board,\n      debug: false,\n      multiplayer: SERVER,\n      numPlayers: 4,\n      // seed: S.game_instance.matchID,\n    });\n    Scene = (props:any) => <GameInstance matchID={S.game_instance.matchID} playerID={S.game_instance.playerID} {...props} />;\n  }\n\n  return <Scene {...{S, actions}} />;\n};\n\nexport default App;","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}